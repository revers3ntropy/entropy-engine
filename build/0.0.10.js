/*! For license information please see 0.0.10.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.es=t():e.es=t()}(this||window,(function(){return(()=>{var e={768:function(e){var t;t=()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{CONFIG_FILE_NAME:()=>p,CompileResult:()=>ne,Context:()=>Z,ESArray:()=>q,ESBoolean:()=>V,ESErrorPrimitive:()=>A,ESFunction:()=>R,ESJSBinding:()=>$,ESNamespace:()=>N,ESNull:()=>P,ESNumber:()=>z,ESObject:()=>O,ESPrimitive:()=>I,ESString:()=>W,ESSymbol:()=>J,ESType:()=>G,EndIterator:()=>We,Error:()=>Me,IS_NODE_INSTANCE:()=>l,IllegalCharError:()=>$e,ImportError:()=>De,IndexError:()=>Fe,InterpretResult:()=>te,InvalidOperationError:()=>Ue,InvalidRuntimeError:()=>Le,InvalidSyntaxError:()=>Be,MissingNativeDependencyError:()=>qe,N_array:()=>he,N_binOp:()=>ie,N_break:()=>ke,N_class:()=>ge,N_continue:()=>Ee,N_destructAssign:()=>ae,N_for:()=>ue,N_functionCall:()=>fe,N_functionDefinition:()=>de,N_if:()=>ce,N_indexed:()=>ye,N_namespace:()=>we,N_number:()=>xe,N_objectLiteral:()=>_e,N_primitiveWrapper:()=>Ie,N_return:()=>ve,N_statements:()=>pe,N_string:()=>Se,N_tryCatch:()=>be,N_unaryOp:()=>se,N_undefined:()=>Ce,N_varAssign:()=>oe,N_variable:()=>Te,N_while:()=>le,N_yield:()=>me,Node:()=>re,PermissionRequiredError:()=>Ve,Position:()=>r,ReferenceError:()=>Ge,TestFailed:()=>ze,TypeError:()=>je,VERSION:()=>_,colours:()=>Y,config:()=>Ze,generateRandomSymbol:()=>Re,global:()=>o,indent:()=>Oe,init:()=>dt,initPrimitiveTypes:()=>B,isDigit:()=>Ae,libs:()=>v,now:()=>y,parse:()=>mt,parseConfig:()=>nt,refreshPerformanceNow:()=>g,run:()=>vt,runningInNode:()=>u,setGlobalContext:()=>a,sleep:()=>Pe,str:()=>Ne,strip:()=>H,wrap:()=>Q});var n={};e.r(n),e.d(n,{EndIterator:()=>We,Error:()=>Me,IllegalCharError:()=>$e,ImportError:()=>De,IndexError:()=>Fe,InvalidOperationError:()=>Ue,InvalidRuntimeError:()=>Le,InvalidSyntaxError:()=>Be,MissingNativeDependencyError:()=>qe,PermissionRequiredError:()=>Ve,ReferenceError:()=>Ge,TestFailed:()=>ze,TypeError:()=>je});class r{constructor(e,t,n,r="(unknown)"){this.idx=e,this.ln=t,this.col=n,this.file=r}advance(e=""){return this.idx++,this.col++,"\n"===e&&(this.ln++,this.col=0),this}get clone(){return new r(this.idx,this.ln,this.col,this.file)}get str(){return this.isUnknown?"unknown":`File ${this.file}, ${this.ln+1}:${this.col+1}`}get isUnknown(){return-2===this.idx}static get void(){return new r(-2,-2,-2,"(unknown)")}}const i="0123456789",s="_$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let o;const a=e=>{o=e},c=["'","`",'"'];let l="undefined"==typeof window;const u=()=>{l=!0},h=["let"],_="3.0.4f",p="esconfig.json",f=["utf8","ucs2","utf16le","latin1","ascii","base64","base64url","hex"],d={},v={},m=["class","abstract"];let y=()=>process.hrtime()[1]/Math.pow(10,6)+process.hrtime()[0]*Math.pow(10,3);function g(e=l){y=e?()=>process.hrtime()[1]/Math.pow(10,6)+process.hrtime()[0]*Math.pow(10,3):()=>{try{return null===performance||void 0===performance?void 0:performance.now()}catch(e){return process.hrtime()[1]/Math.pow(10,6)+process.hrtime()[0]*Math.pow(10,3)}}}var w;g(),function(e){e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.END_STATEMENT=2]="END_STATEMENT",e[e.IDENTIFIER=3]="IDENTIFIER",e[e.COMMA=4]="COMMA",e[e.ASSIGN=5]="ASSIGN",e[e.ADD=6]="ADD",e[e.SUB=7]="SUB",e[e.ASTRIX=8]="ASTRIX",e[e.DIV=9]="DIV",e[e.POW=10]="POW",e[e.MOD=11]="MOD",e[e.OPAREN=12]="OPAREN",e[e.CPAREN=13]="CPAREN",e[e.OBRACES=14]="OBRACES",e[e.CBRACES=15]="CBRACES",e[e.OSQUARE=16]="OSQUARE",e[e.CSQUARE=17]="CSQUARE",e[e.EQUALS=18]="EQUALS",e[e.NOT_EQUALS=19]="NOT_EQUALS",e[e.NOT=20]="NOT",e[e.GT=21]="GT",e[e.LT=22]="LT",e[e.GTE=23]="GTE",e[e.LTE=24]="LTE",e[e.AND=25]="AND",e[e.OR=26]="OR",e[e.COLON=27]="COLON",e[e.DOT=28]="DOT",e[e.EOF=29]="EOF",e[e.PIPE=30]="PIPE",e[e.AMPERSAND=31]="AMPERSAND",e[e.BITWISE_NOT=32]="BITWISE_NOT",e[e.QM=33]="QM",e[e.DOUBLE_QM=34]="DOUBLE_QM",e[e.OGENERIC=35]="OGENERIC",e[e.CGENERIC=36]="CGENERIC"}(w||(w={}));const b=w,x={[b.NUMBER]:"ESNumber",[b.STRING]:"String",[b.END_STATEMENT]:";",[b.IDENTIFIER]:"Identifier",[b.COMMA]:",",[b.OBRACES]:"{",[b.CBRACES]:"}",[b.OPAREN]:"(",[b.CPAREN]:")",[b.OSQUARE]:"[",[b.CSQUARE]:"]",[b.ASSIGN]:"=",[b.ADD]:"+",[b.SUB]:"-",[b.ASTRIX]:"*",[b.DIV]:"/",[b.POW]:"^",[b.MOD]:"%",[b.EQUALS]:"==",[b.NOT_EQUALS]:"!=",[b.NOT]:"!",[b.GT]:">",[b.LT]:"<",[b.GTE]:">=",[b.LTE]:"<=",[b.AND]:"&&",[b.OR]:"||",[b.COLON]:":",[b.DOT]:".",[b.EOF]:"End of File",[b.AMPERSAND]:"&",[b.PIPE]:"|",[b.BITWISE_NOT]:"~",[b.QM]:"?",[b.DOUBLE_QM]:"??",[b.OGENERIC]:"<|",[b.CGENERIC]:"|>"},S={"*":b.ASTRIX,"/":b.DIV,"+":b.ADD,"-":b.SUB,"(":b.OPAREN,")":b.CPAREN,"^":b.POW,"%":b.MOD,"{":b.OBRACES,"}":b.CBRACES,",":b.COMMA,"[":b.OSQUARE,"]":b.CSQUARE,";":b.END_STATEMENT,":":b.COLON,".":b.DOT,"=":b.ASSIGN,">":b.GT,"<":b.LT,"!":b.NOT,"|":b.PIPE,"&":b.AMPERSAND,"~":b.BITWISE_NOT,"?":b.QM},T={"==":b.EQUALS,"!=":b.NOT_EQUALS,">=":b.GTE,"<=":b.LTE,"+=":b.ASSIGN,"-=":b.ASSIGN,"*=":b.ASSIGN,"/=":b.ASSIGN,"&&":b.AND,"||":b.OR,"<|":b.OGENERIC,"|>":b.CGENERIC,"??":b.DOUBLE_QM},C={},k=["__add__","__subtract__","__multiply__","__divide__","__pow__","__eq__","__gt__","__lt__","__and__","__or__","__pipe__","__ampersand__","__bool__","__set__","__get__","__call__","__iter__","__next__","__iterable__"],E=["let global IIterable = interface({\n    __iterable__: true,\n    __iter__: Func,\n    len: Func,\n});","module('test', namespace {\n    func assert (value: Bool) {\n        if !value {\n            throw(TestFailed());\n        }\n    }\n})"];class I{constructor(e,t=d.any){this.__iterable__=!1,this.__null__=!1,this._=this,this.__add__=(e,t)=>new Ue("+",this),this.__subtract__=(e,t)=>new Ue("-",this),this.__multiply__=(e,t)=>new Ue("*",this),this.__divide__=(e,t)=>new Ue("/",this),this.__pow__=(e,t)=>new Ue("^",this),this.__mod__=(e,t)=>new Ue("%",this),this.__eq__=(e,t)=>new Ue("==",this),this.__gt__=(e,t)=>new Ue(">",this),this.__lt__=(e,t)=>new Ue("<",this),this.__and__=(e,t)=>new Ue("&&",this),this.__or__=(e,t)=>new Ue("||",this),this.__bool__=e=>new Ue("__bool__",this),this.__pipe__=(e,t)=>new Ue("|",this),this.__ampersand__=(e,t)=>new Ue("&",this),this.__set__=(e,t,n)=>new Ue("__set__",this,`[${Ne(t)}] = ${Ne(n)}`),this.__call__=(e,...t)=>new Ue("__call__",this),this.__generic__=(e,...t)=>new Ue("__generic__",this),this.__iter__=e=>new Ue("__iter__",this),this.__next__=e=>new Ue("__next__",this),this.__nilish__=(e,t)=>this.__null__?t:this,this.isa=(e,t)=>t.__includes__(e,this),this.is=(e,t)=>new V(t===this),this.__type_name__=()=>Ne(this.__type__),this.has_property=(e,t)=>new V(Ne(t)in this),this.describe=(e,t)=>{this.__info__.builtin||(this.__info__.description=Ne(t))},this.detail=(e,t)=>{if(this.__info__.builtin)return;const n=H(t,e);if("object"!=typeof n)return new je("object",this.__type_name__(),Ne(this));this.__info__=Object.assign(Object.assign({},this.__info__),n),this.__info__.builtin=!1},this.__type__=t||this,this.__value__=e,this.__info__={}}}class A extends I{constructor(e=new Me("Unknown","Error not specified")){super(e,d.error),this.__get__=(e,t)=>{switch(Ne(t)){case"name":return new W(this.__value__.name);case"details":return new W(this.__value__.details);case"traceback":return new q(this.__value__.traceback.map((e=>new W(`${e.position.str} : ${e.line}`))));default:return Ne(t)in this?Q(this._[Ne(t)],!0):new Fe(t.__value__,this)}},this.cast=()=>new Me("TypeError","Cannot cast type 'error'"),this.str=()=>new W(`<Error: ${this.__value__.str}>`),this.__eq__=(e,t)=>new V(t instanceof A&&this.__value__.name===t.__value__.name),this.__bool__=()=>new V(!0),this.bool=this.__bool__,this.clone=()=>new A(this.__value__),this.__includes__=()=>new Ue("type check",this,"Cannot type check against an error instance"),this.__subtype_of__=(e,t)=>Object.is(t,d.any)?new V(!0):new Ue("type check",this,"Cannot type check against an error instance"),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.keys=()=>[...Object.keys(this),"name","traceback","details"].map((e=>new W(e)))}}class P extends I{constructor(){super(void 0,d.undefined),this.__null__=!0,this.cast=()=>new Me("TypeError","Cannot cast type 'Null'"),this.str=()=>new W("nil"),this.__eq__=(e,t)=>new V(t instanceof P||void 0===t||void 0===t.__value__),this.__bool__=()=>new V,this.bool=this.__bool__,this.clone=()=>new P,this.__get__=(e,t)=>Ne(t)in this?Q(this._[Ne(t)],!0):new Fe(t.__value__,this),this.__includes__=this.__eq__,this.__subtype_of__=(e,t)=>Object.is(t,d.any)||Object.is(t,d.undefined)?new V(!0):this.__eq__(e,t),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.keys=()=>Object.keys(this).map((e=>new W(e))),this.__info__={name:"undefined",description:"Not defined, not a value.",file:"built-in",builtin:!0}}}class O extends I{constructor(e={}){super(e,d.object),this.__iterable__=!0,this.cast=(e,t)=>t===d.number?new z(this.__value__?1:0):new Me("TypeError",`Cannot cast boolean to type '${Ne(t.__type_name__())}'`),this.str=(e,t=new z)=>{let n=Ne(this.__value__,t.__value__);return"\n"===n[n.length-1]&&(n=n.substr(0,n.length-1)),new W(n)},this.keys=()=>Object.keys(this.__value__).map((e=>new W(e))),this.__eq__=(e,t)=>{if(!(t instanceof O))return new V;if(t.keys().length!==this.keys().length)return new V;for(const n of this.keys()){const r=n.__value__,i=this.__value__[r],s=t.__value__[r];if(!i){if(s)return new V;continue}if(!i.__eq__)return new V;const o=i.__eq__(e,s);if(o instanceof Me)return o;if(!o.__value__)return new V}return new V(!0)},this.__bool__=()=>new V(!0),this.bool=this.__bool__,this.__add__=(e,t)=>{if(!(t instanceof O))return new je("Object",t.__type_name__(),Ne(t));const n={};for(const t of this.keys()){const r=t.__value__;if(r in this)continue;const i=this.__get__(e,t);if(i instanceof Me)return i;n[r]=i}for(const r of t.keys()){const i=r.__value__;if(i in n)continue;const s=t.__get__(e,r);if(s instanceof Me)return s;n[i]=s}const r=new O(n);return r.__type_map__=Object.assign(Object.assign({},this.__type_map__),t.__type_map__),r},this.__subtract__=(e,t)=>{let n=[];if(t instanceof W)n=[Ne(t)];else{if(!(t instanceof q))return new je("Array | String",t.__type_name__(),Ne(t));n=H(t,e)}if(!Array.isArray(n))return new je("Array | String",t.__type_name__(),Ne(t));const r={};for(const t of this.keys()){const i=t.__value__;if(-1===n.indexOf(i)){const n=this.__get__(e,t);if(n instanceof Me)return n;r[i]=n}}return new O(r)},this.__get__=(e,t)=>{if(!(t instanceof W||t instanceof z))return new je("String | ESNumber",t.__type_name__(),Ne(t));const n=t.__value__;return n in this.__value__?this.__value__[n]:n in this?Q(this._[Ne(n)],!0):new Fe(Ne(n),this)},this.__set__=(e,t,n)=>{if("string"!=typeof t)return t instanceof W?void(this.__value__[t.__value__]=n):new je("String",t.__type_name__(),Ne(t));this.__value__[t]=n},this.has_property=(e,t)=>t instanceof W||t instanceof z?t.__value__ in this.__value__?new V(!0):new V(t.__value__ in this):new V,this.clone=()=>{const e=new O,t={},n=this.__value__;for(const e of Object.keys(n))t[e]=n[e];return e.__value__=t,e},this.__includes__=(e,t)=>{var n,r;if(!(t instanceof O))return new V;if(Object.keys(this.__value__).length<Object.keys(t.__value__).length)return new V;for(const i of Object.keys(this.__value__)){const s=null!==(n=this.__value__[i])&&void 0!==n?n:new P,o=null!==(r=t.__value__[i])&&void 0!==r?r:new P,a=s.__includes__(e,o);if(a instanceof Me)return a;if(!a.__value__)return new V}return new(0,this.constructor)(!0)},this.__subtype_of__=(e,t)=>{var n,r;if(Object.is(t,d.any)||Object.is(t,d.object))return new V(!0);if(!(t instanceof O))return new V;if(Object.keys(this.__value__).length<Object.keys(t.__value__).length)return new V;for(const i of Object.keys(this.__value__)){const s=null!==(n=this.__value__[i])&&void 0!==n?n:new P,o=null!==(r=t.__value__[i])&&void 0!==r?r:new P,a=s.__subtype_of__(e,o);if(a instanceof Me)return a;if(!a.__value__)return new V}return new(0,this.constructor)(!0)},this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.__iter__=()=>new q(Object.keys(this.__value__).map((e=>new W(e)))),this.len=()=>new z(Object.keys(this.__value__).length),this.contains=this.has_property}}class R extends I{constructor(e=(()=>{}),t=[],n="(anon)",r=new O,i=d.any,s,a=!1,c=!1,l=!1,u=[]){super(e,d.function),this.__generic_types__=[],this.cast=()=>new Me("TypeError","Cannot cast type 'function'"),this.clone=()=>new R(this.__value__,this.__args__,this.name,this.__this__,this.__returns__,this.__closure__),this.valueOf=()=>this,this.str=()=>new W(`<Func: ${this.name}>`),this.__eq__=(e,t)=>new V(t instanceof R&&this.__value__===t.__value__),this.__bool__=()=>new V(!0),this.bool=this.__bool__,this.__call__=({context:e,kwargs:t,dontTypeCheck:n},...r)=>{let i=e;return this.takeCallContextAsClosure||(i=this.__closure__,i.path=e.path),function(e,t,n=[],r={},i=!1){var s;const o=e;t.takeCallContextAsClosure||(e=t.__closure__),e.path=o.path;const a=t.__value__,c=function(e,t,n,r,i){const s=new Z;s.parent=r;const o=e.__args__.filter((e=>!e.isKwarg));if(!e.__allow_args__&&t.length>o.length)return new Me("TypeError",`Too many arguments. Expected ${o.length} but got ${t.length}`);for(let e=0;e<t.length||e<o.length;e++){let n=new P,a=d.any;if(!o[e])continue;const c=o[e];if(t[e]instanceof I&&(a=t[e].__type__,n=t[e]),c.defaultValue&&t.length<=e)s.setOwn(c.name,c.defaultValue,{forceThroughConst:!0});else{if(!i){const i=c.type.__includes__({context:r},t[e]);if(i instanceof Me)return i;if(!i.__value__)return new je(Ne(c.type),Ne(a),Ne(n))}s.setOwn(c.name,n,{forceThroughConst:!0})}}let a=s.setOwn("args",new q(t),{forceThroughConst:!0});if(a instanceof Me)return a;const c=[];for(const t of e.__args__.filter((e=>e.isKwarg))){let e=n[t.name];if(!e){if(!t.defaultValue)return new je("Any","Undefined");e=t.defaultValue}if(!i){const n=e.__type__,i=t.type.__includes__({context:r},e);if(i instanceof Me)return i;if(!i.__value__)return new je(Ne(t.type),Ne(n),Ne(e))}s.setOwn(t.name,e,{forceThroughConst:!0}),c.push(t.name)}if(!e.__allow_kwargs__)for(const t of Object.keys(n))if(-1===c.indexOf(t))return new Me("TypeError",`Kwarg '${Object.keys(n)[0]}' is not a parameter of '${e.name}'`);return a=s.setOwn("kwargs",new O(n),{forceThroughConst:!0}),a instanceof Me?a:s}(t,n,r,e,i);if(c instanceof Me)return c;const l=null!==(s=t.__this__)&&void 0!==s?s:new O,u=c.setOwn("this",l);return u instanceof Me?u:a instanceof re?function(e,t,n,r){var i,s;const o=n.interpret(t);if(o.error)return o.error;if(void 0!==o.funcReturn&&(o.val=o.funcReturn,o.funcReturn=void 0),!r){const n=e.__returns__.__includes__({context:t},o.val);if(n instanceof Me)return n;if(!1===n.__value__)return new je(Ne(e.__returns__),(null===(i=o.val)||void 0===i?void 0:i.__type_name__())||"undefined",null===(s=o.val)||void 0===s?void 0:s.str({context:t},new z).__value__,"(from function return)")}return o.val?o.val:new P}(t,c,a,i):"function"==typeof a?function(e,t,n,r,i,s){for(let e=n.length;e<r.length;e++)n.push(new P);const o=r({context:t,kwargs:i,dontTypeCheck:s},...n);return o instanceof Me||o instanceof I?o:new P}(0,c,n,a,r,i):new je("function",typeof a)}(i,this,r,t,n)},this.__get__=(e,t)=>Ne(t)in this?Q(this._[Ne(t)],!0):new Fe(t.__value__,this),this.__includes__=(e,t)=>{var n;if(!(t instanceof R))return new V;const r=t.__args__.filter((e=>!e.isKwarg)),i=this.__args__.filter((e=>!e.isKwarg));if(!this.__allow_kwargs__&&t.__allow_kwargs__)return new V;if(!this.__allow_args__&&t.__allow_args__)return new V;if(!this.__allow_args__){if(r.length!==i.length)return new V;for(let t=0;t<r.length;t++){const n=i[t].type.__subtype_of__(e,r[t].type);if(n instanceof Me)return n;if(!n.__value__)return new V}}if(!this.__allow_kwargs__){const r=t.__args__.filter((e=>e.isKwarg)),i=this.__args__.filter((e=>e.isKwarg));if(r.length!==i.length&&!this.__allow_kwargs__)return new V;for(const t of i.map((e=>e.name))){const s=r.find((e=>e.name===t));if(!s)return new V;const o=null===(n=i.find((e=>e.name===t)))||void 0===n?void 0:n.type.__subtype_of__(e,s.type);if(o instanceof Me)return o;if(!(null==o?void 0:o.__value__))return new V}}const s=this.__call__(Object.assign(Object.assign({},e),{dontTypeCheck:!0}));if(s instanceof Me)return s;const o=t.__returns__.__subtype_of__(e,s);return o instanceof Me?o:new V(o.__value__)},this.__subtype_of__=(e,t)=>{var n;if(Object.is(t,d.any)||Object.is(t,d.function))return new V(!0);if(!(t instanceof R))return new V;const r=t.__args__.filter((e=>!e.isKwarg)),i=this.__args__.filter((e=>!e.isKwarg));if(!this.__allow_args__){if(r.length!==i.length)return new V;for(let t=0;t<r.length;t++){const n=r[t].type.__subtype_of__(e,i[t].type);if(n instanceof Me)return n;if(!n.__value__)return new V}}if(!this.__allow_kwargs__){const r=t.__args__.filter((e=>e.isKwarg)),i=this.__args__.filter((e=>e.isKwarg));if(r.length!==i.length&&!this.__allow_kwargs__)return new V;for(const t of i.map((e=>e.name))){const s=r.find((e=>e.name===t));if(!s)return new V;const o=null===(n=i.find((e=>e.name===t)))||void 0===n?void 0:n.type;if(!o)return new V;const a=s.type.__subtype_of__(e,o);if(a instanceof Me)return a;if(!(null==a?void 0:a.__value__))return new V}}const s=this.__call__(Object.assign(Object.assign({},e),{dontTypeCheck:!0}));if(s instanceof Me)return s;const o=t.__call__(Object.assign(Object.assign({},e),{dontTypeCheck:!0}));if(o instanceof Me)return o;const a=o.__subtype_of__(e,s);return a instanceof Me?a:new V(a.__value__)},this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.keys=()=>Object.keys(this).map((e=>new W(e))),this.__generic__=(e,...t)=>{const n=this.clone();return e.dontTypeCheck||(n.__generic_types__=t),n},this.__args__=t,this.__gargs__=u,this.__info__.name=n,this.__this__=r,this.__returns__=i,s?this.__closure__=s:(this.__closure__=new Z,this.__closure__.parent=o),this.takeCallContextAsClosure=a,this.__info__.returnType=Ne(i),this.__info__.args=t.map((e=>({name:e.name,default_value:Ne(e.defaultValue),type:e.type.__info__.name,required:!0}))),this.__allow_args__=c,this.__allow_kwargs__=l}get name(){var e;return null!==(e=this.__info__.name)&&void 0!==e?e:"(anonymous)"}set name(e){this.__info__.name=e}}class N extends I{constructor(e,t,n=!1){super(t,d.object),this.__iterable__=!0,this.cast=()=>new Me("TypeError","Cannot cast type 'namespace'"),this.clone=()=>{const e={},t=this.__value__;for(const n of Object.keys(t))e[n]=t[n];return new N(this.name,e)},this.str=()=>{const e=Object.keys(this.__value__);return new W(`<Namespace ${Ne(this.name)}${e.length>0?": ":""}${e.slice(0,5)}${e.length>=5?"...":""}>`)},this.__eq__=(e,t)=>new V(this===t),this.__bool__=()=>new V(!0),this.bool=this.__bool__,this.__get__=(e,t)=>{if(t instanceof W&&t.__value__ in this.__value__){const e=this.__value__[t.__value__];if(e.isAccessible)return e.value}return t instanceof W?Ne(t)in this?Q(this._[Ne(t)],!0):new Fe(t.__value__,this._):new je("string",t.__type_name__())},this.__set__=(e,t,n)=>{if("string"==typeof t&&(t=new W(t)),!(t instanceof W))return new je("string",t.__type_name__(),Ne(t));const r=Ne(t);if(!this.__mutable__)return new je("mutable","immutable",`${Ne(this.name)}`);const i=this.__value__[r];return i?i.isConstant?new je("mutable","immutable",`${Ne(this.name)}[${r}]`):i.isAccessible?void(i.value=n):new je("accessible","inaccessible",`${Ne(this.name)}[${r}]`):new Me("SymbolError",`Symbol ${r} is not declared in namespace ${Ne(this.name)}.`)},this.__includes__=this.__eq__,this.__subtype_of__=(e,t)=>Object.is(t,d.any)||Object.is(t,d.object)?new V(!0):this.__eq__(e,t),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.__iter__=e=>new q(Object.keys(this.__value__).map((e=>new W(e)))),this.len=()=>new z(Object.keys(this.__value__).length),this.keys=()=>[...Object.keys(this),...Object.keys(this.__value__)].map((e=>new W(e))),this.contains=this.has_property,this.__info__.name=Ne(e),this.__mutable__=n}get name(){return new W(this.__info__.name)}set name(e){this.__info__.name=e.__value__}}function M(e,t,n,r,i,s){if("function"!=typeof t[n])return new je("Func",typeof t[n],Ne(t[n]));let o;if(e)try{o=new t[n](r,...i)}catch(e){if(!(e instanceof TypeError))return new Me(e.name,e.toString());try{o=t[n](r,...i)}catch(e){return new Me("",e.toString())}}else try{o=new t[n](...i.map((e=>H(e,r))))}catch(e){if(!(e instanceof TypeError))return new Me(e.name,e.toString());try{o=t[n](...i.map((e=>H(e,r))))}catch(e){return new Me("",e.toString())}}return o instanceof Me&&s?new A(o):Q(o)}class $ extends I{constructor(e,t="<AnonNative>",n=!1,r=!1){super(e,"function"==typeof e?d.function:d.object),this.__iterable__=!0,this.cast=()=>new Me("ESTypeError","Cannot cast native object"),this.clone=()=>new $(this.__value__),this.str=(e,t=new z)=>new W(Ne(this.__value__,t.__value__)),this.__eq__=(e,t)=>new V(this===t),this.__bool__=()=>new V(!0),this.bool=this.__bool__,this.__get__=(e,t)=>{const n=Ne(t),r=this.__value__,i=r[n];if(void 0===i)return n in this?Q(this._[n],!0):new Fe(n,this);if(i instanceof I)return i;if("function"==typeof i){const e=this.functionsTakeProps,t=new R(((t,...i)=>M(e,r,n,t,i,this.catchErrorsToPrimitive)));return t.__allow_kwargs__=!0,t.__allow_args__=!0,t}return Q(i)},this.__set__=(e,t,n)=>{const r=Ne(t);r in this?this._[Ne(r)]=n:this._.__value__[r]=H(n,e)},this.__call__=(e,...t)=>"function"!=typeof this.__value__?new je("function",typeof this.__value__,Ne(this)):M(this.functionsTakeProps,this,"__value__",e,t,this.catchErrorsToPrimitive),this.has_property=(e,t)=>new V(!(this.__get__(e,t)instanceof Me)),this.__includes__=this.__eq__,this.__subtype_of__=(e,t)=>Object.is(t,d.any)||Object.is(t,d.object)?new V(!0):this.__eq__(e,t),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.__iter__=()=>new q(Object.keys(this.__value__).map((e=>new W(e)))),this.len=()=>new z(Object.keys(this.__value__).length),this.keys=()=>[...Object.keys(this),...Object.keys(this.__value__)].map((e=>new W(e))),this.contains=this.has_property,this.__info__.name=Ne(t),this.functionsTakeProps=n,this.catchErrorsToPrimitive=r}}function B(){d.type=new G(!0,"Type"),d.undefined=new G(!0,"Null"),d.string=new G(!0,"Str"),d.array=new G(!0,"Arr"),d.number=new G(!0,"Num"),d.any=new G(!0,"Any"),d.function=new G(!0,"Func"),d.bool=new G(!0,"Bool"),d.object=new G(!0,"Obj"),d.error=new G(!0,"Err"),d.any.__info__={name:"Any",description:"Matches any other type",file:"built-in",builtin:!0},d.number.__info__={name:"Num",description:"The ES ESNumber type. Is a a double-precision 64-bit binary format IEEE 754 value, like double in Java and C#",file:"built-in",builtin:!0},d.string.__info__={name:"Str",description:"The ES String type. Holds an array of characters, and can be defined with any of ', \" and `. Can be indexed like an array.",file:"built-in",builtin:!0},d.bool.__info__={name:"Bool",description:"The ES Bool type. Exactly two instances exist, true and false.",file:"built-in",builtin:!0},d.function.__info__={name:"Func",description:"The ES Function type. Is a block of code which executes when called and takes in 0+ parameters.",file:"built-in",builtin:!0},d.array.__info__={name:"Arr",description:"The ES Array type. Defines a set of items of any type which can be accessed by an index with [].",file:"built-in",builtin:!0},d.object.__info__={name:"Obj",description:"The ES Object type. Similar to JS objects or python dictionaries.",file:"built-in",builtin:!0},d.error.__info__={name:"Err",description:"The ES Error type. Call to throw an error.",file:"built-in",builtin:!0},d.type.__info__={name:"Type",description:"The ES Type type. Call to get the type of a value at a string.",file:"built-in",builtin:!0}}function j(e,t,n,r){if(!(t instanceof G))return new je("Type",typeof t,t);if(t.__primordial__)return;const i=new R((({context:e},...i)=>{const s=new Z;if(s.parent=e,t.__extends__){const e=j(s,t.__extends__,n,r);if(e instanceof Me)return e}const o=null==t?void 0:t.__get_init__();if(!o)return;o.__this__=n,o.__closure__=s;const a=o.__call__({context:s},...i);return a instanceof Me?a:void 0}),void 0,"super",n),s=null==t?void 0:t.__get_init__();i.__allow_kwargs__=(null==s?void 0:s.__allow_kwargs__)||!1,i.__allow_args__=(null==s?void 0:s.__allow_args__)||!1,i.__args__=(null==s?void 0:s.__args__)||[];const o=e.setOwn("super",i);if(o instanceof Me)return o;const a=D(t,{context:e},[],[],!1,n);return a instanceof Me?a:void 0}function D(e,t,n,r,i=!0,s=new O){const{context:o}=t;if(e.__primordial__)return function(e,t,n){var r,i;switch(t.__name__){case"Null":return new P;case"Type":return e.length<1?new G:new W(null===(r=e[0])||void 0===r?void 0:r.__type_name__());case"Str":return e.length<1?new W:e[0].cast(n,d.string);case"Arr":if(e.length<1)return new q;const t=[];for(const r of e){const e=r.__iter__(n);if(e instanceof Me)return e;for(;;){const r=e.__next__(n);if(r instanceof Me)return r;if(r instanceof A&&"EndIterator"===(null===(i=r.__value__)||void 0===i?void 0:i.name))break;t.push(r)}}return new q(t);case"Num":return e.length<1?new z:e[0].cast(n,d.number);case"Func":return e.length<1?new R:e[0].cast(n,d.function);case"Bool":return e.length<1?new V:e[0].cast(n,d.boolean);default:return Q(e[0])}}(n,e,t);const a=e.__get_init__(),c=new Z;c.parent=null==a?void 0:a.__closure__;for(const n of e.__gargs__){let i=r.shift();if(i||(i=n.defaultValue),!i)return new Me("ArgumentError",`Not enough generic arguments provided for type ${e.__name__}`);s.__set__(t,n.name,i)}if(e.__extends__){const t=j(c,e.__extends__,s,o);if(t instanceof Me)return t}for(const n of e.__methods__){const e=n.clone();e.__this__=s,s.__set__(t,new W(n.name),e),-1!==k.indexOf(n.name)&&(s[n.name]=e.__call__)}if(i&&a){a.__this__=s,a.__closure__=c;const e=a.__call__({context:c},...n);if(e instanceof Me)return e}return s.__type__=e,s}class G extends I{constructor(e=!1,t="(anon)",n=[],r={},i,s=[],o=!1){super(void 0,null==d?void 0:d.type),this.__generic_types__=[],this.clone=()=>new G(this.__primordial__,this.__name__,this.__methods__,this.__properties__,this.__extends__,this.__gargs__,this.__abstract__),this.isa=(e,t)=>new V(t===d.type),this.cast=()=>new Ue("cast",this),this.__includes__=(e,t)=>{if(!t)return new V;const n=t.__type__;return this===d.any||n===d.any||this===n?new V(!0):n.__subtype_of__(e,this)},this.__subtype_of__=(e,t)=>{if(Object.is(t,d.any))return new V(!0);if(!(t instanceof G))return new V;if(this===d.any||this===t)return new V(!0);for(let n=0;n<t.__generic_types__.length;n++){let r=d.any;this.__generic_types__.length-1<=n&&(r=this.__generic_types__[n]);const i=t.__generic_types__[n],s=r.__subtype_of__(e,i);if(s instanceof Me)return s;if(!s.__value__)return new V}return this.__extends__?this.__extends__.__subtype_of__(e,t):new V},this.__eq__=(e,t)=>new V(t===this),this.__call__=(e,...t)=>{if(this.__abstract__)return new Me("TypeError","Cannot construct abstract class");const n=D(this,e,t||[],this.__generic_types__);if(n instanceof Me)return n;if(!this.__primordial__){if(!(n instanceof O))return new je("Obj",n.__type_name__(),Ne(n),"Constructors must return an object");let t=Object.assign({},this.__properties__),r=this.__extends__;for(;r;)t=Object.assign(Object.assign({},t),r.__properties__),r=r.__extends__;t.init=new F(d.function,d.undefined);const i=n.isa(e,new O(t));if(i instanceof Me)return i;if(!i.__value__)return new Me("TypeError","Initializer incorrectly assigned properties")}return n},this.str=()=>new W(this.__name__),this.__bool__=()=>new V(!0),this.bool=this.__bool__,this.__get__=(e,t)=>{const n=t.__value__;return n in this?Q(this._[n],!0):new Fe(Ne(t),this)},this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.keys=()=>Object.keys(this).map((e=>new W(e))),this.__get_init__=()=>{const e=this.__methods__.filter((e=>"init"===e.name));if(e)return e[0]},this.__generic__=(e,...t)=>{const n=this.clone();return e.dontTypeCheck||(n.__generic_types__=t),n},this.__primordial__=e,this.__name__=t,this.__info__.name=t,this.__extends__=i,this.__methods__=n,this.__properties__=r,this.__gargs__=s,this.__abstract__=o,d.type||(this.__type__=this)}}class F extends G{constructor(e,t){super(!1,`(${Ne(e)}) | (${Ne(t)})`),this.__call__=()=>new Ue("__call__",this),this.__includes__=(e,t)=>{const n=this.__left__.__includes__(e,t),r=this.__right__.__includes__(e,t);return n instanceof Me?n:r instanceof Me?r:new V(n.__value__||r.__value__)},this.__subtype_of__=(e,t)=>{if(Object.is(t,d.any))return new V(!0);const n=this.__eq__(e,t);if(n instanceof Me)return n;if(n.__value__)return new V(!0);const r=this.__left__.__subtype_of__(e,t),i=this.__right__.__subtype_of__(e,t);return r instanceof Me?r:i instanceof Me?i:new V(r.__value__&&i.__value__)},this.clone=()=>new F(this.__left__,this.__right__),this.__eq__=(e,t)=>{if(!(t instanceof F))return new V;const n=this.__left__.__eq__(e,t.__left__);if(n instanceof Me)return n;const r=this.__right__.__eq__(e,t.__right__);return r instanceof Me?r:new V(n.__value__&&r.__value__)},this.__generic__=()=>new Ue("__generic__",this),this.__left__=e,this.__right__=t}}class U extends G{constructor(e){super(!1,`~(${Ne(e)})`),this.__call__=()=>new Ue("__call__",this),this.__includes__=(e,t)=>{const n=this.__val__.__includes__(e,t);return n instanceof Me?n:new V(!n.__value__)},this.__subtype_of__=(e,t)=>{if(Object.is(t,d.any))return new V(!0);if(t instanceof F||t instanceof L){const n=t.__left__.__subtype_of__(e,this.__val__);if(n instanceof Me)return n;if(n.__value__)return new V;const r=t.__right__.__subtype_of__(e,this.__val__);return r instanceof Me?r:r.__value__?new V:new V(!0)}const n=this.__val__.__subtype_of__(e,t);return n instanceof Me?n:new V(!n.__value__)},this.clone=()=>new U(this.__val__),this.__eq__=(e,t)=>{if(!(t instanceof U))return new V;const n=this.__val__.__eq__(e,t.__val__);return n instanceof Me?n:new V(!0===n.__value__)},this.__generic__=()=>new Ue("__generic__",this),this.__val__=e}}class L extends G{constructor(e,t){super(!1,`(${Ne(e)}) & (${Ne(t)})`),this.__call__=()=>new Ue("__call__",this),this.__includes__=(e,t)=>{const n=this.__left__.__includes__(e,t),r=this.__right__.__includes__(e,t);return n instanceof Me?n:r instanceof Me?r:new V(n.__value__&&r.__value__)},this.__subtype_of__=(e,t)=>{if(t===d.any)return new V(!0);const n=this.__eq__(e,t);if(n instanceof Me)return n;if(n.__value__)return new V(!0);const r=this.__left__.__subtype_of__(e,t),i=this.__right__.__subtype_of__(e,t);return r instanceof Me?r:i instanceof Me?i:new V(r.__value__||i.__value__)},this.clone=()=>new L(this.__left__,this.__right__),this.__eq__=(e,t)=>{if(!(t instanceof L))return new V;const n=this.__left__.__eq__(e,t.__left__);if(n instanceof Me)return n;const r=this.__right__.__eq__(e,t.__right__);return r instanceof Me?r:new V(n.__value__&&r.__value__)},this.__generic__=()=>new Ue("__generic__",this),this.__left__=e,this.__right__=t}}class z extends I{constructor(e=0){super(e,d.number),this.cast=(e,t)=>{switch(t){case d.number:return this;case d.string:return this.str();case d.array:return new q(new Array(this.__value__));default:return new Me("TypeError",`Cannot cast to type '${Ne(t.__type_name__())}'`)}},this.str=()=>new W(this.__value__.toString()),this.__add__=(e,t)=>t instanceof z?new z(this.__value__+t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__subtract__=(e,t)=>t instanceof z?new z(this.__value__-t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__multiply__=(e,t)=>t instanceof z?new z(this.__value__*t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__divide__=(e,t)=>t instanceof z?new z(this.__value__/t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__pow__=(e,t)=>t instanceof z?new z(Math.pow(this.__value__,t.__value__)):new je("Num",t.__type_name__(),t.__value__),this.__mod__=(e,t)=>t instanceof z?new z(this.__value__%t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__eq__=(e,t)=>new V(t instanceof z&&this.__value__===t.__value__),this.__gt__=(e,t)=>t instanceof z?new V(this.__value__>t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__lt__=(e,t)=>t instanceof z?new V(this.__value__<t.__value__):new je("Num",t.__type_name__(),t.__value__),this.__bool__=()=>new V(this.__value__>0),this.bool=this.__bool__,this.clone=()=>new z(this.__value__),this.__get__=(e,t)=>Ne(t)in this?Q(this._[Ne(t)],!0):new Fe(t.__value__,this),this.__includes__=this.__eq__,this.__subtype_of__=(e,t)=>Object.is(t,d.any)||Object.is(t,d.number)?new V(!0):this.__eq__(e,t),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.keys=()=>Object.keys(this).map((e=>new W(e)))}}class V extends I{constructor(e=!1){super(Boolean(e),d.bool),this.__get__=(e,t)=>Ne(t)in this?Q(this._[Ne(t)],!0):new Fe(t.__value__,this),this.cast=(e,t)=>t===d.number?new z(this.__value__?1:0):new Me("TypeError",`Cannot cast boolean to type '${Ne(t.__type_name__())}'`),this.__eq__=(e,t)=>t instanceof V?new V(this.__value__===t.__value__):new je("Boolean",t.__type_name__(),t.__value__),this.__bool__=()=>this,this.__and__=(e,t)=>{var n;return new V(this.__value__&&!0===(null===(n=t.bool(e))||void 0===n?void 0:n.__value__))},this.__or__=(e,t)=>new V(this.__value__||!0===t.bool(e).__value__),this.str=()=>new W(this.__value__?"true":"false"),this.clone=()=>new V(this.__value__),this.bool=()=>this,this.__includes__=this.__eq__,this.__subtype_of__=(e,t)=>Object.is(t,d.any)||Object.is(t,d.boolean)?new V(!0):this.__eq__(e,t),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.keys=()=>Object.keys(this).map((e=>new W(e))),this.__info__={name:Ne(e),description:`Boolean global constant which evaluates to ${Ne(e)}, the opposite of ${Ne(!e)}`,file:"built-in",builtin:!0,helpLink:"https://en.wikipedia.org/wiki/Boolean_expression"}}}class q extends I{constructor(e=[]){super(e,d.array),this.__iterable__=!0,this.len=()=>new z(this.__value__.length),this.cast=(e,t)=>{switch(t){case d.number:return new z(this.len().__value__);case d.boolean:return this.bool();case d.string:return this.str(e);default:return new Me("TypeError",`Cannot cast 'Arr' to '${Ne(t)}'`)}},this.str=(e,t=new z)=>new W(Ne(this.__value__,t.__value__)),this.__eq__=(e,t)=>{if(!(t instanceof q))return new V;if(t.len().__value__!==this.len().__value__)return new V;for(let n=0;n<this.len().__value__;n++){const r=this.__value__[n],i=t.__value__[n];if(!r){if(i)return new V;continue}if(!r.__eq__)return new V;const s=r.__eq__(e,i);if(s instanceof Me)return s;if(!s.__value__)return new V}return new V(!0)},this.__add__=(e,t)=>{if(!t.__iterable__)return new je("IIterable",t.__type_name__(),Ne(t));const n=this.clone(),r=t.__iter__(e);if(r instanceof Me)return r;for(;;){const t=r.__next__(e);if(t instanceof Me)return t;if(t instanceof A&&"EndIterator"===t.__value__.name)break;n.add(e,t)}return n},this.__bool__=()=>new V(this.__value__.length>0),this.bool=this.__bool__,this.__get__=(e,t)=>{if(t instanceof W&&Ne(t)in this._)return Q(this._[Ne(t)],!0);if(!(t instanceof z))return new P;let n=t.__value__;for(;n<0;)n=this.__value__.length+n;return n<this.__value__.length?this.__value__[n]:new P},this.__set__=(e,t,n)=>{if(!(t instanceof z))return;let r=t.__value__;for(;r<0;)r=this.__value__.length+r;this.__value__[r]=n},this.contains=(e,t)=>{for(const n of this.__value__)if(t.__eq__(e,n))return new V(!0);return new V},this.clone=()=>new q([...this.__value__]),this.__includes__=(e,t)=>{if(!(t instanceof q)||this.len().__value__!==t.len().__value__)return new V;for(let n=0;n<this.__value__.length;n++){const r=this.__value__[n].__includes__(e,t.__value__[n]);if(r instanceof Me)return r;if(!r.__value__)return new V}return new V(!0)},this.__subtype_of__=(e,t)=>{if(!(t instanceof q)||this.len().__value__!==t.len().__value__)return new V;for(let n=0;n<this.__value__.length;n++){const r=this.__value__[n].__subtype_of__(e,t.__value__[n]);if(r instanceof Me)return r;if(!r.__value__)return new V}return new V(!0)},this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.__iter__=this.clone,this.__next__=()=>this.__value__.length>0?Q(this.__value__.shift()):new A(new We),this.keys=()=>{const e=Object.keys(this._).map((e=>new W(e)));return e.push(...Object.keys(this.__value__).map((e=>new z(parseInt(e))))),e},this.add=(e,...t)=>{this.__value__.push(...t)}}}class W extends I{constructor(e=""){super(e.toString(),d.string),this.__iterable__=!0,this.str=()=>this,this.cast=(e,t)=>{switch(t){case d.number:const e=parseFloat(this.__value__);return isNaN(e)?new Me("TypeError","This string is not a valid number"):new z(e);case d.string:return this;case d.array:return new q(this.__value__.split("").map((e=>new W(e))));default:return new Me("TypeError",`Cannot cast to type '${Ne(t.__type_name__())}'`)}},this.__add__=(e,t)=>t instanceof W?new W(this.__value__+t.__value__):new je("Str",t.__type_name__(),t.__value__),this.__multiply__=(e,t)=>t instanceof z?new W(this.__value__.repeat(t.__value__)):new je("ESNumber",t.__type_name__(),t.__value__),this.__eq__=(e,t)=>new V(t instanceof W&&this.__value__===t.__value__),this.__gt__=(e,t)=>t instanceof W?new V(this.__value__.length>t.__value__.length):new je("Str",t.__type_name__(),t.__value__),this.__lt__=(e,t)=>t instanceof W?new V(this.__value__.length<t.__value__.length):new je("Str",t.__type_name__(),t.__value__),this.__bool__=()=>new V(this.__value__.length>0),this.bool=this.__bool__,this.len=()=>new z(this.__value__.length),this.clone=()=>new W(this.__value__),this.__get__=(e,t)=>{if(t instanceof W&&this._.hasOwnProperty(Ne(t)))return Q(this._[Ne(t)],!0);if(!(t instanceof z))return new W;let n=t.__value__;for(;n<0;)n=this.__value__.length+n;return n<this.__value__.length?new W(this.__value__[n]):new W},this.__set__=(e,t,n)=>{if(!(t instanceof z))return;n instanceof W||(n=new W(Ne(n)));let r=t.__value__;for(;r<0;)r=this.__value__.length+r;const i=n.str(e,new z).__value__,s=this.__value__.substr(0,r),o=this.__value__.substr(r+i.length);this.__value__=s+i+o},this.__includes__=this.__eq__,this.__subtype_of__=(e,t)=>Object.is(t,d.any)||Object.is(t,d.string)?new V(!0):this.__eq__(e,t),this.__pipe__=(e,t)=>new F(this,t),this.__ampersand__=(e,t)=>new L(this,t),this.__iter__=()=>{const e=this.__value__.split("");return new q(e.map((e=>new W(e))))},this.keys=()=>{const e=Object.keys(this._).map((e=>new W(e)));return e.push(...Object.keys(this.__value__).map((e=>new z(parseInt(e))))),e},this.contains=(e,t)=>t instanceof W?new V(this.__value__.includes(t.__value__)):new je("Str",t.__type_name__(),t.__value__)}}class J{constructor(e,t,n={}){var r,i,s;this.clone=e=>new J(this.value.clone(e),this.identifier,{isConstant:this.isConstant,isAccessible:this.isAccessible}),this.str=()=>new W(`<Symbol: ${this.identifier}>`),this.value=e,this.identifier=t,this.isConstant=null!==(r=n.isConstant)&&void 0!==r&&r,this.isAccessible=null===(i=n.isAccessible)||void 0===i||i,this.type=null!==(s=n.type)&&void 0!==s?s:e.__type__}}function Q(e,t=!1){return e instanceof I?e:null==e?new P:e instanceof Me?new A(e):e instanceof J?e.value:"number"==typeof e?new z(e):"string"==typeof e?new W(e):"boolean"==typeof e?new V(e):"bigint"==typeof e?new z(Number(e)):"symbol"==typeof e?new W(String(e)):Array.isArray(e)?new q(e.map((e=>Q(e,t)))):new $(e,void 0,t)}function H(e,t){if(!(e instanceof I))return e;if(e instanceof q)return e.__value__.map((e=>H(e,t)),t);if(e instanceof O){const n={};for(const r in e.__value__)n[r]=H(e.__value__[r],t);return n}return e instanceof P?void 0:e instanceof R?(...n)=>{const r=e.__call__(t,...n.map((e=>Q(e))));return r instanceof Me?(console.error(r.str),r):H(r,t)}:e instanceof G?e:e.__value__}const K={red:31,yellow:33,green:32,cyan:36,blue:34,grey:2},X={};for(const e of Object.keys(K))X[e]=t=>(t||(t=""),l?`[${K[e]}m`+t+"[0m":`<span style="color: ${e}">${t}</span>`);const Y=X;class Z{constructor(){this.symbolTable={},this.initialisedAsGlobal=!1,this.deleted=!1,this.path_=""}get path(){return this.path_||!this.parent?this.path_:this.parent.path}set path(e){this.path_=e}get parent(){return this.parent_}set parent(e){e!=this?this.parent_=e:console.error(Y.red("Setting context parent to self"))}has(e){return!!e&&void 0!==this.get(e)}hasOwn(e){return this.symbolTable[e]instanceof J}get(e){const t=this.getSymbol(e);return t instanceof Me||null==t?t:t.value}getSymbolTableAsDict(){const e={};for(const t in this.symbolTable)e[t]=this.symbolTable[t];return e}getSymbol(e){let t=this.symbolTable[e];if(t&&!t.isAccessible)return new je("assessable","inaccessible",t.identifier);if(!t&&this.parent){const n=this.parent.getSymbol(e);if(n instanceof Me)return n;t=n}return t}set(e,t,n={}){let r=this;if(n.global)r=this.root;else{for(;!r.hasOwn(e)&&void 0!==r.parent;)r=r.parent;r.hasOwn(e)||(r=this)}return r.setOwn(e,t,n)}setOwn(e,t,n={}){if(t instanceof I||(t=Q(t)),n.global)return n.global=!1,void this.root.setOwn(e,t,n);if(!n.forceThroughConst){const t=this.symbolTable[e];if(null==t?void 0:t.isConstant)return new je("dynamic","constant",e)}this.symbolTable[e]=new J(t,e,n)}remove(e){return this.hasOwn(e)?(delete this.symbolTable[e],!0):this.parent?this.parent.remove(e):new Ge(e)}clear(){for(const e in this.symbolTable)this.remove(e);this.parent=void 0,this.deleted=!0}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get keys(){return Object.keys(this.symbolTable)}clone(){const e=new Z;return e.parent=this.parent,e.deleted=this.deleted,e.initialisedAsGlobal=this.initialisedAsGlobal,e.symbolTable=Object.assign(Object.assign({},e.symbolTable),this.symbolTable),e}log(){console.log("---- CONTEXT ----");for(const e in this.symbolTable){const t=this.symbolTable[e];let n=e;t.isConstant&&(n+=" (CONST)"),t.isAccessible||(n+=" (INACCESSIBLE)"),n+=": ",n+=Ne(this.symbolTable[e].value),console.log(n)}console.log("-----------------")}}function ee(e,t){var n;const r=e.type.interpret(t);if(r.error)return r.error;let i;if(e.defaultValue){const r=null===(n=e.defaultValue)||void 0===n?void 0:n.interpret(t);if(r.error)return r.error;r.val instanceof I&&(i=r.val)}return{name:e.name,type:r.val,defaultValue:i,isKwarg:e.isKwarg}}class te{constructor(e){this.val=new P,this.shouldBreak=!1,this.shouldContinue=!1,e instanceof Me?this.error=e:e&&(this.val=e)}}class ne{constructor(e){this.val="",this.hoisted="","string"==typeof e?this.val=e:e&&(this.error=e)}register(e,t){const n=e.compilePy(t);return this.hoisted+=n.hoisted,n.error?(this.error=n.error,""):n.val}}class re{constructor(e,t=!1){this.pos=e,this.isTerminal=t}interpret(e){var t;const n=y(),r=new te,i=this.interpret_(e);i instanceof Me?r.error=i:i instanceof te?(r.val=i.val,r.error=i.error,r.funcReturn=i.funcReturn,r.shouldBreak=i.shouldBreak,r.shouldContinue=i.shouldContinue):r.val=i,r.error&&r.error.pos.isUnknown&&(r.error.pos=this.pos),r.val instanceof I||(r.error=new je("Primitive","Native JS value",Ne(r.val)),r.val=new P),(t=r.val.__info__).file||(t.file=this.pos.file),re.interprets++;const s=y()-n;return re.totalTime+=s,s>re.maxTime&&(re.maxTime=s),r}}re.interprets=0,re.totalTime=0,re.maxTime=0;class ie extends re{constructor(e,t,n,r){super(e),this.left=t,this.opTok=n,this.right=r}interpret_(e){const t=this.left.interpret(e);if(t.error)return t.error;const n=this.right.interpret(e);if(n.error)return n.error;const r=t.val,i=n.val;if(void 0===r)return new je("~nil","nil",r,"N_binOp.interpret_").position(this.opTok.pos);if(void 0===i)return new je("~nil","nil",i,"N_binOp.interpret_").position(this.opTok.pos);switch(this.opTok.type){case b.LTE:{const t=r.__lt__({context:e},i),n=r.__eq__({context:e},i);return t instanceof Me?t:n instanceof Me?n:new te(t.__or__({context:e},n))}case b.GTE:{const t=r.__gt__({context:e},i),n=r.__eq__({context:e},i);return t instanceof Me?t:n instanceof Me?n:new te(t.__or__({context:e},n))}case b.NOT_EQUALS:{const t=r.__eq__({context:e},i);return t instanceof Me?t:new te(new V(!t.bool().__value__))}case b.ADD:return new te(r.__add__({context:e},i));case b.SUB:return new te(r.__subtract__({context:e},i));case b.ASTRIX:return new te(r.__multiply__({context:e},i));case b.DIV:return new te(r.__divide__({context:e},i));case b.POW:return new te(r.__pow__({context:e},i));case b.MOD:return new te(r.__mod__({context:e},i));case b.EQUALS:return new te(r.__eq__({context:e},i));case b.LT:return new te(r.__lt__({context:e},i));case b.GT:return new te(r.__gt__({context:e},i));case b.AND:return new te(r.__and__({context:e},i));case b.OR:return new te(r.__or__({context:e},i));case b.AMPERSAND:return new te(r.__ampersand__({context:e},i));case b.PIPE:return new te(r.__pipe__({context:e},i));case b.DOUBLE_QM:return new te(r.__nilish__({context:e},i));case b.IDENTIFIER:if("in"===this.opTok.value)return i.__iterable__&&"contains"in i?new te(i.contains({context:e},r)):new je("Iterable",i.__type_name__(),Ne(i));default:return new Be(`Invalid binary operator: ${this.opTok.str()}`).position(this.opTok.pos)}}compileJS(e){const t=this.left.compileJS(e);if(t.error)return t;const n=this.right.compileJS(e);return n.error?n:e.minify?new ne(`${t.val}${this.opTok.str()}${n.val}`):new ne(`${t.val} ${this.opTok.str()} ${n.val}`)}compilePy(e){const t=this.left.compilePy(e);if(t.error)return t;const n=this.right.compilePy(e);if(n.error)return n;const r={"&&":"and","||":"or","^":"**"};let i=x[this.opTok.type];return i in r&&(i=r[i]),new ne(`${t.val} ${i} ${n.val}`)}str(){return`(${this.left.str()} ${this.opTok.str()} ${this.right.str()})`}}class se extends re{constructor(e,t,n){super(e),this.a=t,this.opTok=n}interpret_(e){var t,n,r;const i=this.a.interpret(e);if(i.error)return i.error;switch(this.opTok.type){case b.SUB:case b.ADD:if(!(i.val instanceof z))return new je("ESNumber",(null===(t=i.val)||void 0===t?void 0:t.__type_name__().toString())||"undefined_",null===(n=i.val)||void 0===n?void 0:n.__value__).position(this.pos);const s=i.val.__value__;return new te(new z(this.opTok.type===b.SUB?-s:Math.abs(s)));case b.NOT:return new te(new V(!(null===(r=null==i?void 0:i.val)||void 0===r?void 0:r.bool({context:e}).__value__)));case b.BITWISE_NOT:return new te(new U(i.val));case b.QM:return new te(new F(d.undefined,i.val));default:return new Be(`Invalid unary operator: ${this.opTok.str()}`).position(this.opTok.pos)}}compileJS(e){const t=this.a.compileJS(e);return t.error?t:new ne(`${this.opTok.str()}${t.val}`)}compilePy(e){const t=this.a.compilePy(e);return t.error?t:new ne(`${this.opTok.str()}${t.val}`)}str(){return`(${this.opTok.str()}${this.a.str()})`}}class oe extends re{constructor(e,t,n,r="=",i=!1,s=!1,o=!1,a=d.any){super(e),this.value=n,this.varNameTok=t,this.isGlobal=i,this.assignType=r,this.isConstant=s,this.isDeclaration=o,this.type=a instanceof I?new Ie(a):a}interpret_(e){var t,n;if(this.isDeclaration){if(e.hasOwn(this.varNameTok.value))return new Be(`Symbol '${this.varNameTok.value}' already exists, and cannot be redeclared`).position(this.pos);if("="!==this.assignType)return new Be(`Cannot declare variable with operator '${this.assignType}'`).position(this.pos)}const r=this.value.interpret(e),i=this.type.interpret(e);if(r.error)return r.error;if(i.error)return i.error;if(!i.val)return new je("Type","nil").position(this.varNameTok.pos);if(!r.val)return new je("~nil","nil","N_varAssign.interpret_").position(this.varNameTok.pos);const s=i.val.__includes__({context:e},r.val);if(s instanceof Me)return s;if(!s.bool().__value__)return new je(Ne(i.val),Ne(null===(t=r.val)||void 0===t?void 0:t.__type_name__()),Ne(r.val)).position(this.varNameTok.pos);if(this.isDeclaration)return e.setOwn(this.varNameTok.value,r.val,{global:!1,isConstant:this.isConstant,type:i.val}),new te(r.val);if(e.has(this.varNameTok.value)){const t=e.getSymbol(this.varNameTok.value);if(t instanceof Me)return t;if(t){const i=t.type.__includes__({context:e},r.val);if(i instanceof Me)return i;if(!i.__value__)return new je(Ne(t.type),null===(n=r.val)||void 0===n?void 0:n.__type_name__(),Ne(r.val)).position(this.varNameTok.pos)}}if("="===this.assignType){let t=r.val;void 0===t&&(t=new P);const n=e.getSymbol(this.varNameTok.value);if(n instanceof Me)return n;if(!n)return new Be("Cannot declare variable without keyword").position(this.pos);const i=n.type.__includes__({context:e},r.val);if(i instanceof Me)return i;if(!i.bool().__value__)return new je(Ne(n.type),Ne(r.val.__type__),Ne(r.val));const s=e.set(this.varNameTok.value,t,{global:this.isGlobal,isConstant:this.isConstant,type:n.type});if(s instanceof Me)return s}else{const t=e.get(this.varNameTok.value);if(t instanceof Me)return t;if(null==t)return new Be(`Cannot declare variable with operator '${this.assignType}'`).position(this.pos);let n;const i=r.val;switch(this.assignType[0]){case"*":n=t.__multiply__({context:e},i);break;case"/":n=t.__divide__({context:e},i);break;case"+":n=t.__add__({context:e},i);break;case"-":n=t.__subtract__({context:e},i);break;default:return new Me("AssignError",`Cannot find assignType of ${this.assignType[0]}`).position(this.pos)}if(n instanceof Me)return n;const s=e.set(this.varNameTok.value,n,{global:this.isGlobal,isConstant:this.isConstant,type:n.__type__});if(s instanceof Me)return s;r.val=n}return"(anonymous)"!==r.val.__info__.name&&r.val.__info__.name||(r.val.__info__.name=this.varNameTok.value),r}compileJS(e){const t=this.value.compileJS(e);if(t.error)return t;let n="";this.isDeclaration&&(n=this.isGlobal?"var":this.isConstant?"const":"let");let r=this.assignType;return"="!==r&&(r+="="),e.minify?new ne(`${n} ${this.varNameTok.value}${r}${t.val}`):new ne(`${n} ${this.varNameTok.value} ${r} ${t.val}`)}compilePy(e){const t=new ne,n=this.value.compilePy(e);if(n.error)return n;t.hoisted+=n.hoisted;let r=this.assignType;return"="!==r&&(r+="="),this.isGlobal&&(t.hoisted+=`${this.varNameTok.value}=None`),e.minify?t.val=`${this.varNameTok.value}${r}${n.val}`:t.val=`${this.varNameTok.value} ${r} ${n.val}`,t}str(){let e=this.assignType;return"="!==e&&(e+="="),`(let ${this.varNameTok.value} ${e} ${this.value.str()})`}}class ae extends re{constructor(e,t,n,r,i=!1,s=!1){super(e),this.value=r,this.varNames=t,this.types=n,this.isGlobal=i,this.isConstant=s}interpret_(e){for(const t of this.varNames)if(e.hasOwn(t))return new Be(`Symbol '${t}' already exists, and cannot be redeclared`).position(this.pos);const t=this.value.interpret(e);if(t.error)return t.error;if(t.val.__type__===d.object){let n=0;for(const r of this.varNames){const i=t.val.__get__({context:e},new W(r));if(i instanceof Me)return i;const s=this.types[n].interpret(e);if(s.error)return s;const o=s.val.__includes__({context:e},i);if(o instanceof Me)return o;if(!o.bool().__value__)return new je(Ne(s.val),i.__type_name__(),Ne(i));e.setOwn(r,i,{global:this.isGlobal,isConstant:this.isConstant,type:t.val.__type__}),n++}return new te(t.val)}if(!t.val.__iterable__)return new Me("TypeError","Expected iterable in destructure assignment");const n=t.val.__iter__({context:e});if(n instanceof Me)return n;let r=0;for(const i of this.varNames){const s=n.__next__({context:e});if(s instanceof A&&s.__value__ instanceof We)return new Me("IndexError","Iterator ended unexpectedly - not enough elements to destruct");if(s instanceof Me)return s;const o=this.types[r].interpret(e);if(o.error)return o;const a=o.val.__includes__({context:e},s);if(a instanceof Me)return a;if(!a.bool().__value__)return new je(Ne(o.val),s.__type_name__(),Ne(s));e.setOwn(i,s,{global:this.isGlobal,isConstant:this.isConstant,type:t.val.__type__}),r++}return new te(t.val)}compileJS(e){const t=this.value.compileJS(e);if(t.error)return t;let n;return n=this.isGlobal?"var":this.isConstant?"const":"let",e.minify?new ne(`${n}[${this.varNames.join(",")}]=${t.val}`):new ne(`${n} [${this.varNames.join(", ")}] = ${t.val}`)}compilePy(e){const t=this.value.compileJS(e);return t.error?t:new ne(`${this.varNames.join(", ")} = ${t.val}`)}str(){return`(${this.varNames.join(", ")} = ${this.value.str()})`}}class ce extends re{constructor(e,t,n,r){super(e),this.comparison=t,this.ifFalse=r,this.ifTrue=n}interpret_(e){var t;const n=new Z;n.parent=e;let r=new te;const i=this.comparison.interpret(e);return i.error?i:((null===(t=i.val)||void 0===t?void 0:t.bool({context:e}).__value__)?r=this.ifTrue.interpret(n):this.ifFalse&&(r=this.ifFalse.interpret(n)),n.clear(),r.val=new P,r)}compileJS(e){const t=" ".repeat(e.indent),n=" ".repeat(e.indent+4);e.indent+=4;const r=this.comparison.compileJS(e);if(r.error)return r;const i=this.ifTrue.compileJS(e);if(i.error)return i;if(!this.ifFalse)return e.minify?new ne(`if(${r.val}){${i.val}\n}`):new ne(`if (${r.val}) {\n${i.val}\n}`);e.indent=n.length;const s=this.ifFalse.compileJS(e);return s.error?s:(this.ifFalse instanceof pe||(s.val=n+s.val),e.minify?new ne(`if(${r.val}){${i.val}}else{${s.val}}`):new ne(`if (${r.val}) {\n${i.val}\n${t}} else {\n${s.val}\n${t}}`))}compilePy(e){const t=new ne,n=" ".repeat(e.indent),r=" ".repeat(e.indent+4);e.indent+=4;const i=this.comparison.compilePy(e);if(i.error)return i;t.hoisted+=i.hoisted;const s=this.ifTrue.compilePy(e);if(s.error)return s;if(t.hoisted+=s.hoisted,!this.ifFalse)return new ne(`if ${i.val}:\n${r}${s.val}`);const o=this.ifFalse.compilePy(e);return o.error?o:(t.hoisted+=o.hoisted,this.ifFalse instanceof pe||(o.val=r+o.val),new ne(`if ${i.val}:\n${s.val}\n${n}else:\n${o.val}\n${n}`))}str(){var e;return`(if ${this.comparison.str()}{${this.ifTrue.str()}} else {${null===(e=this.ifFalse)||void 0===e?void 0:e.str()})`}}class le extends re{constructor(e,t,n){super(e),this.comparison=t,this.loop=n}interpret_(e){for(var t,n;;){const r=new Z;r.parent=e;const i=this.comparison.interpret(e);if(i.error)return i;if(!(null===(n=null===(t=i.val)||void 0===t?void 0:t.bool({context:e}))||void 0===n?void 0:n.__value__))break;const s=this.loop.interpret(r);if(s.error)return s;if(s.shouldBreak)break}return new te(new P)}compileJS(e){e.indent+=4;const t=this.comparison.compileJS(e);if(t.error)return t;const n=this.loop.compileJS(e);return n.error?n:e.minify?new ne(`while(${t.val}){${n.val}}`):new ne(`while (${t.val}) {\n${n.val}}`)}compilePy(e){const t=new ne,n=" ".repeat(e.indent||0),r=this.comparison.compilePy(e);if(r.error)return r;t.hoisted+=r.hoisted;const i=this.loop.compilePy(e);return i.error?i:(t.hoisted+=i.hoisted,new ne(`while ${r.val}:\n${n}${i.val}`))}str(){return"(while)"}}class ue extends re{constructor(e,t,n,r,i,s){super(e),this.body=t,this.array=n,this.identifier=r,this.isGlobalId=i,this.isConstId=s}interpret_(e){const t=this.array.interpret(e);if(t.error)return t;if(e.has(this.identifier.value)&&this.isGlobalId)return new Be("Cannot declare global variable which exists in the current scope").position(this.identifier.pos);const n=t.val.__iter__({context:e});if(n instanceof Me)return n;for(;;){const t=n.__next__({context:e});if(t instanceof Me)return t;if(t instanceof A&&t.__value__ instanceof We)break;const r=new Z;r.parent=e,r.set(this.identifier.value,t,{global:this.isGlobalId,isConstant:this.isConstId,type:t.__type__});const i=this.body.interpret(r);if(i.error||void 0!==i.funcReturn)return i;if(i.shouldBreak){i.shouldBreak=!1;break}i.shouldContinue&&(i.shouldContinue=!1)}return new te(new P)}compileJS(e){const t=" ".repeat(e.indent);e.indent+=4;const n=this.array.compileJS(e);if(n.error)return n;const r=this.body.compileJS(e);if(r.error)return r;let i="let";return this.isGlobalId?i="var":this.isConstId&&(i="const"),e.minify?new ne(`for(${i} ${this.identifier.value} of ${n.val}){${r.val}\n${t}}`):new ne(`for (${i} ${this.identifier.value} of ${n.val}) {\n${r.val}\n${t}}`)}compilePy(e){const t=new ne;e.indent+=4;const n=t.register(this.array,e);if(t.error)return t;const r=t.register(this.body,e);return t.error||(this.isGlobalId&&(t.hoisted+=`${this.identifier.value}=None`),t.val=`for ${this.identifier.value} in ${n}:\n${r}`),t}str(){return"(for)"}}class he extends re{constructor(e,t,n=!1){super(e),this.items=t,this.shouldClone=n}interpret_(e){const t=new te,n=[];for(const t of this.items){const r=t.interpret(e);if(r.error||void 0!==r.funcReturn)return r;if(!r.val)continue;let i=r.val;this.shouldClone&&(i=i.clone({context:e})),n.push(i)}return t.val=new q(n),t}compileJS(e){const t=new ne("[");for(const n of this.items){const r=n.compileJS(e);if(r.error)return r;t.val+=r.val+","}return t.val+="]",t}compilePy(e){const t=new ne("[");for(const n of this.items){const r=t.register(n,e);if(t.error)return t;t.val+=r+","}return t.val+="]",t}str(){let e="([";for(const t of this.items)e+=t.str()+",";return e+="])",e}}class _e extends re{constructor(e,t){super(e),this.properties=t}interpret_(e){const t={};for(const[n,r]of this.properties){const i=r.interpret(e);if(i.error)return i.error;const s=n.interpret(e);if(s.error)return s.error;s.val&&i.val&&(t[s.val.__value__]=i.val)}return new te(new O(t))}compileJS(e){const t=new ne("{");for(const[n,r]of this.properties){const i=r.compileJS(e);if(i.error)return i;const s=n.compileJS(e);if(s.error)return s;s.val&&i.val&&(t.val+=`[${s.val}]: ${i.val},`)}return t.val+="}",t}compilePy(e){const t=new ne("{");for(const[n,r]of this.properties){const i=t.register(r,e);if(t.error)return t;const s=t.register(n,e);if(t.error)return t;s&&i&&(t.val+=`${s}: ${i},`)}return t.val+="}",t}str(){let e="({";for(const[t,n]of this.properties)t.str()&&n.str()&&(e+=`[${t.str()}]: ${n.str()},`);return e+="})",e}}class pe extends re{constructor(e,t,n=!1){super(e),this.items=t,this.topLevel=n}interpret_(e){if(this.topLevel){const t=new te,n=[];for(const t of this.items){const r=t.interpret(e);if(r.error||r.funcReturn||r.shouldBreak||r.shouldContinue)return r;if(!r.val)continue;const i=r.val.clone({context:e});n.push(i)}return t.val=new q(n),t}{let t;for(const n of this.items){const r=n.interpret(e);if(r.error||r.funcReturn||r.shouldBreak||r.shouldContinue)return r;t=r.val}return new te(t||new P)}}compileJS(e){const t=new ne,n=" ".repeat(e.indent);t.val+=n;for(const r of this.items){const i=r.compileJS(e);if(i.error)return i;t.val+=i.val+";",e.minify||(t.val+="\n"+n)}return t}compilePy(e){const t=new ne,n=" ".repeat(e.indent);t.val+=n;for(const r of this.items){const i=t.register(r,e);if(t.error)return t;t.val+=i,t.val+="\n"+n}return t}str(){let e="(";for(const t of this.items)e+=t.str()+";";return e+")"}}class fe extends re{constructor(e,t,n=[],r=[],i={},s="__call__",o=!1){super(e),this.arguments=n,this.to=t,this.indefiniteKwargs=r,this.definiteKwargs=i,this.functionType=s,this.optionallyChained=o}interpret_(e){const{val:t,error:n}=this.to.interpret(e);if(n)return n;if(!t)return new je("any","undefined",void 0,"On function call").position(this.pos);let r=[];const i={};for(const t of this.arguments){const n=t.interpret(e);if(n.error)return n.error;n.val&&r.push(n.val)}for(const t of this.indefiniteKwargs){const n=t.interpret(e);if(n.error)return n.error;const s=n.val;if(s instanceof q){r=[...r,...s.__value__];continue}if(!(s instanceof N||s instanceof $||s instanceof O))return new je("Namespace",Ne(s.__type_name__()));const o=s.__value__;for(const e of Object.keys(o))i[e]=o[e]}for(const t of Object.keys(this.definiteKwargs)){const n=this.definiteKwargs[t].interpret(e);if(n.error)return n.error;i[t]=n.val}const s=t[this.functionType]({context:e,kwargs:i},...r);if(s instanceof Me){if("InvalidOperationError"===s.name&&this.optionallyChained)return new te(new P);s.traceback.push({position:this.pos,line:`${t.__info__.name||"<AnonFunction>"}(${r.map(Ne).join(", ")})`})}return new te(s)}compileJS(e){const t=new ne,n=this.to.compileJS(e);if(n.error)return n;t.val=n.val+"(";for(const n of this.arguments){const r=n.compileJS(e);if(r.error)return r;t.val+=r.val,n!==this.arguments[this.arguments.length-1]&&(t.val+=",",e.minify||(t.val+=" "))}return t.val+=")",t}compilePy(e){const t=new ne,n=t.register(this.to,e);if(t.error)return t;t.val=n+"(";for(const n of this.arguments){const r=t.register(n,e);if(t.error)return t;t.val+=r,n!==this.arguments[this.arguments.length-1]&&(t.val+=",",e.minify||(t.val+=" "))}return t.val+=")",t}str(){let e="("+this.to.str()+"(";for(const t of this.arguments)e+=t.str(),t!==this.arguments[this.arguments.length-1]&&(e+=",");return e+"))"}}class de extends re{constructor(e,t,n,r,i="(anon)",s=new O,o=""){super(e),this.isDeclaration=!1,this.allowArgs=!1,this.allowKwargs=!1,this.arguments=n,this.body=t,this.name=i,this.this_=s,this.returnType=r,this.description=o}interpret_(e){const t=[];for(const n of this.arguments){const r=ee(n,e);if(r instanceof Me)return r;t.push(r)}const n=this.returnType.interpret(e);if(n.error)return n.error;const r=new R(this.body,t,this.name,this.this_,n.val,e);if(r.__allow_kwargs__=this.allowKwargs,r.__allow_args__=this.allowArgs,this.isDeclaration){if(e.hasOwn(this.name))return new Be(`Cannot redeclare symbol '${this.name}'`);e.setOwn(this.name,r,{isConstant:!0,type:d.function})}return new te(r)}compileJS(e){const t=new ne("function(");for(const n of this.arguments)t.val+=n.name+",",e.minify||(t.val+=" ");e.minify?t.val+="){":t.val+=") {\n";const n=" ".repeat(e.indent);e.indent+=4;const r=this.body.compileJS(e);return r.error?r:(t.val+=`${r.val}\n${n}}`,t)}compilePy(e){const t=new ne,n=Re(e.symbols);t.hoisted=`def ${n}(`;for(const n of this.arguments)t.hoisted+=n.name+",",e.minify||(t.hoisted+=" ");const r=" ".repeat(e.indent);e.indent+=4;const i=this.body.compilePy(e);return i.error?i:(t.hoisted+=`):\n${r}${i.val}`,t.hoisted=i.hoisted+t.hoisted,t.val=n,t)}str(){return"(func(){})"}}class ve extends re{constructor(e,t){super(e),this.value=t}interpret_(e){const t=new te;if(void 0===this.value)return t.funcReturn=new P,t;const n=this.value.interpret(e);return n.error?n.error:(t.funcReturn=n.val,t)}compileJS(e){var t;const n=null===(t=this.value)||void 0===t?void 0:t.compileJS(e);return(null==n?void 0:n.error)?n:new ne(`return(${null==n?void 0:n.val})`)}compilePy(e){const t=new ne;if(!this.value)return new ne("return");const n=t.register(this.value,e);return t.error?t:new ne(`return ${n}`)}str(){var e;return"(return "+(null===(e=this.value)||void 0===e?void 0:e.str())||0}}class me extends re{constructor(e,t){super(e),this.value=t}interpret_(e){var t;const n=new te;if(void 0===this.value)return n.funcReturn=new P,n;const r=this.value.interpret(e);return r.error?r.error:((null===(t=r.val)||void 0===t?void 0:t.bool({context:e}).__value__)&&(n.funcReturn=r.val),n)}compileJS(e){var t;const n=null===(t=this.value)||void 0===t?void 0:t.compileJS(e);return n&&n.val?new ne(`if(_=${n.val}){return(_))`):new ne("")}compilePy(e){if(!this.value)return new ne("");const t=(new ne).register(this.value,e);return new ne(t?`if _ := ${t}: return _`:"")}str(){var e;return"(yield "+(null===(e=this.value)||void 0===e?void 0:e.str())||0}}class ye extends re{constructor(e,t,n,r=!1){super(e),this.base=t,this.index=n,this.isOptionallyChained=r}interpret_(e){var t;const n=this.base.interpret(e);if(n.error)return n;const r=this.index.interpret(e);if(r.error)return r;const i=r.val,s=n.val;if(!s||!i)return new te(new P);if(this.value){if(this.isOptionallyChained)return new Be("Cannot assign to optionally chained property accessor").position(this.pos);const n=this.value.interpret(e);if(n.error)return n;const r=Q(s.__get__({context:e},i));let o;const a=n.val;if(null!==(t=this.assignType)&&void 0!==t||(this.assignType="="),!a)return new je("~nil","nil").position(this.pos);switch(this.assignType[0]){case"*":o=r.__multiply__({context:e},a);break;case"/":o=r.__divide__({context:e},a);break;case"+":o=r.__add__({context:e},a);break;case"-":o=r.__subtract__({context:e},a);break;case"=":o=a;break;default:return new Me("AssignError",`Cannot find assignType of ${this.assignType[0]}`).position(this.pos)}if(o instanceof Me)return o;if(!s.__set__)return new je("mutable","immutable",s.__value__).position(this.pos);const c=s.__set__({context:e},i,null!=o?o:new P);if(c instanceof Me)return c}let o=s.__get__({context:e},i);return this.isOptionallyChained&&o instanceof Me&&(o=new P),new te(o)}compileJS(e){const t=this.base.compileJS(e);if(t.error)return t;const n=this.index.compileJS(e);if(n.error)return n;if(!this.value)return new ne(`${t.val}[${n.val}]`);const r=this.value.compileJS(e);return r.error?r:new ne(`${t.val}[${n.val}]${this.assignType||"="}${r.val}`)}compilePy(e){const t=new ne,n=t.register(this.base,e);if(t.error)return t;const r=t.register(this.index,e);if(t.error)return t;if(!this.value)return t.val=`${n}[${r}]`,t;const i=t.register(this.value,e);return t.error||(t.val=`${n}[${r}] ${this.assignType||"="} ${i}`),t}str(){const e=this.base.str(),t=this.index.str();if(!this.value)return`(${e}[${t}])`;const n=this.value.str();return`(${e}[${t}]${this.assignType||"="}${n})`}}class ge extends re{constructor(e,t,n,r,i,s,o,a,c="(anon)",l=!1,u=!1){super(e),this.name=c,this.methods=t,this.properties=n,this.staticMethods=r,this.staticProperties=i,this.genericParams=s,this.init=a,this.extends_=o,this.isDeclaration=l,this.abstract=u}interpret_(e){var t,n,r;const i={},s=[],o=new Z;o.parent=e;for(const e of this.methods){const n=e.interpret(o);if(n.error)return n.error;if(!(n.val instanceof R))return new je("Function",(null===(t=n.val)||void 0===t?void 0:t.__type_name__())||"undefined","method on "+this.name).position(this.pos);s.push(n.val)}for(const e of Object.keys(this.properties)){const t=this.properties[e].interpret(o);if(t.error)return t.error;i[e]=t.val}let a,c=d.object;if(this.extends_){const e=this.extends_.interpret(o);if(e.error)return e.error;if(!(e.val instanceof G))return new je("Type",(null===(n=e.val)||void 0===n?void 0:n.__type_name__())||"undefined","method on "+this.name).position(this.pos);c=e.val}if(this.init){const e=this.init.interpret(o);if(e.error)return e.error;if(!(e.val instanceof R))return new je("Function",(null===(r=e.val)||void 0===r?void 0:r.__type_name__())||"undefined","method on "+this.name).position(this.pos);a=e.val}a&&s.push(a);const l=[];for(const t of this.genericParams){const n=ee(t,e);if(n instanceof Me)return n;l.push(n)}const u=new G(!1,this.name,s,i,c,l,this.abstract);if(this.isDeclaration){if(e.hasOwn(this.name))return new Be(`Cannot redeclare symbol '${this.name}'`);e.setOwn(this.name,u,{isConstant:!0,type:d.type})}return new te(u)}compileJS(){return new ne("function(){return{};}")}compilePy(){return new ne(`class ${this.name}: pass`)}str(){return"class"}}class we extends re{constructor(e,t,n,r=!1,i=!1){super(e),this.name=n,this.statements=t,this.mutable=r,this.isDeclaration=i}interpret_(e){const t=new Z;t.parent=e;const n=this.statements.interpret(t);if(n.error)return n;const r=t.getSymbolTableAsDict();if(this.isDeclaration&&this.name instanceof Te){const n=new N(new W(this.name.a.value),r,this.mutable);return e.hasOwn(this.name.a.value)?new Be(`Cannot redeclare symbol '${this.name}'`):(e.setOwn(this.name.a.value,n),t.clear(),new te(n))}t.clear();const i=new N(new W("(anon)"),r,this.mutable);return new te(i)}compileJS(e){const t=this.statements.compileJS(e);return t.error?t:new ne(`(() => {${t.val}})()`)}compilePy(){const e=new ne;return e.error||(e.val="'namespace'"),e}str(){return"(namespace {})"}}class be extends re{constructor(e,t,n){super(e,!0),this.body=t,this.catchBlock=n}interpret_(e){const t=this.body.interpret(e);if(!t.error)return new te;const n=new Z;n.parent=e,n.setOwn("err",new A(t.error),{isConstant:!0});const r=this.catchBlock.interpret(n);return r.error?r.error:(n.clear(),new te)}compileJS(e){const t=this.body.compileJS(e);if(t.error)return t;const n=this.catchBlock.compileJS(e);return n.error?n:new ne(`try{${t.val}}catch(err){${n.val}}`)}compilePy(e){const t=new ne,n=t.register(this.body,e);if(t.error)return t;const r=t.register(this.catchBlock,e);if(t.error)return t;const i=" ".repeat(e.indent),s=" ".repeat(e.indent+1);return t.val=`try:\n${s}${n}\n${i}except:\n${s}${r}`,t}str(){return"(try {} catch {})"}}class xe extends re{constructor(e,t){super(e,!0),this.a=t}interpret_(){const e=this.a.value,t=new te;return t.val=new z(e),t}compileJS(){return new ne(this.a.value.toString())}compilePy(){return new ne(this.a.value.toString())}str(){return"("+this.a.value.toString()+")"}}class Se extends re{constructor(e,t){super(e,!0),this.a=t}interpret_(){const e=this.a.value;return new te(new W(e))}compileJS(){return new ne(`'${this.a.value}'`)}compilePy(){return new ne(`'${this.a.value}'`)}str(){return"("+this.a.value.toString()+")"}}class Te extends re{constructor(e){super(e.pos,!0),this.a=e}interpret_(e){if(!e.has(this.a.value))return new Ge(this.a.value).position(this.a.pos);const t=new te,n=e.getSymbol(this.a.value);return n?n instanceof Me?n:(t.val=n.value,t):new Ge(`No access to undeclared variable ${this.a.value}`).position(this.pos)}compileJS(){let e=this.a.value.toString();return"import"===e&&(e="import_"),new ne(e)}compilePy(){let e=this.a.value.toString();return"import"===e&&(e="import_"),new ne(e)}str(){return"("+this.a.value.toString()+")"}}class Ce extends re{constructor(e=r.void){super(e,!0)}interpret_(){const e=new te;return e.val=new P,e}compileJS(){return new ne("undefined")}compilePy(){return new ne("None")}str(){return"(nil)"}}class ke extends re{constructor(e){super(e,!0)}interpret_(){const e=new te;return e.shouldBreak=!0,e}compileJS(){return new ne("break")}compilePy(){return new ne("break")}str(){return"(break)"}}class Ee extends re{constructor(e){super(e,!0)}interpret_(){const e=new te;return e.shouldContinue=!0,e}compileJS(){return new ne("continue")}compilePy(){return new ne("continue")}str(){return"(continue)"}}class Ie extends re{constructor(e,t=r.void){super(t,!0),this.value=e}interpret_(){return new te(this.value)}compileJS(){return new ne(JSON.stringify(this.value.__value__))}compilePy(){return new ne(JSON.stringify(this.value.__value__))}str(){return"(primitive)"}}function Ae(e){return(i+"._").includes(e)}const Pe=e=>new Promise((t=>{setTimeout(t,e)}));function Oe(e,{depth:t=1,by:n=4,indentStart:r=!0}={}){const i=" ".repeat(t*n);return(r?i:"")+e.replace(/\n/g,"\n"+i)}function Re(e,t=10,n=s){const r=()=>{let e="";for(let r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e};let i=r();for(;-1!==e.indexOf(i);)i=r();return i}function Ne(e,t=0){if("number"!=typeof t&&(t=0),"string"==typeof e)return t>0?`'${e}'`:e;if(t>5)return"...";let n="";if(void 0===e)return"undefined";if(e instanceof I)return e.str({context:o},new z(t)).__value__;if(e instanceof re)return`<RunTimeNode: ${e.constructor.name}>`;switch(typeof e){case"object":if(null===e)return"nil";if(Array.isArray(e)){n+="[";for(const r of e)try{n+=Ne(r,t+1)+", "}catch(e){n+="<large property>, "}e.length&&(n=n.substring(0,n.length-2)),n+="]"}else{if(Object.keys(e).length<1)return Oe("{}",{indentStart:!1});n+="{\n";let r=0;for(const i of Object.keys(e))n+=Oe(`${i}: ${Ne(e[i],t+1)||"nil"}`),r<Object.keys(e).length-1&&(n+=",\n"),r++;n+="\n}"}return n;case"bigint":case"number":case"boolean":n=`${e}`;break;case"function":n=`<NativeFunction ${e.name}>`}return Oe(n,{depth:t>0?1:0,indentStart:!1})}class Me{constructor(e,t){this.pos=r.void,this.traceback=[],this.name=e,this.details=t}get colouredStr(){let e="";if(this.traceback.length){e=Y.yellow("Error Traceback (most recent call last):\n");for(const t of[...this.traceback].reverse())e+=`    ${Y.cyan(t.position.str)}:\n        ${t.line}\n`}return e+=`${Y.red(this.name)}: ${this.details} \n at ${Y.cyan(this.pos.str)}`,e}get str(){return`${this.name}: ${this.details} \n at ${this.pos.str}`}position(e){return this.pos=e,this}}class $e extends Me{constructor(e="<unknown>"){super("IllegalCharError",`'${e}'`)}}class Be extends Me{constructor(e=""){super("InvalidSyntaxError",e)}}class je extends Me{constructor(e,t,n="",r=""){super("TypeError",`Expected type '${e}', got type '${t}' ${void 0===n?"":` on value '${n}'`} ${r||""}`)}}class De extends Me{constructor(e,t=""){super("ImportError",`Could not import ${e}: ${t}`)}}class Ge extends Me{constructor(e){super("ReferenceError",`${e} is not defined`)}}class Fe extends Me{constructor(e,t){var n;super("IndexError",`'${e}' is not a property of '${(null===(n=null==t?void 0:t.__info__)||void 0===n?void 0:n.name)||Ne(t)}'`)}}class Ue extends Me{constructor(e,t,n="",i=r.void){var s;super("InvalidOperationError",`Cannot perform '${e}' on value ${(null===(s=null==t?void 0:t.__info__)||void 0===s?void 0:s.name)||Ne(t)}: ${n}`),this.pos=i}}class Le extends Me{constructor(){super("InvalidRuntimeError","Required runtime of "+(l?"browser":"node"))}}class ze extends Me{constructor(e){super("TestFailed",e)}}class Ve extends Me{constructor(e){super("PermissionRequiredError",e)}}class qe extends Me{constructor(e){super("MissingNativeDependencyError",`Missing required native dependency '${e}'. This is probably an issue with the EntropyScript provider, not your code.`)}}class We extends Me{constructor(){super("EndIterator","")}}const Je=[b.STRING,b.NUMBER,b.IDENTIFIER];class Qe{constructor(e,t,n){this.type=t,this.value=n,this.pos=e}matches(e,t){return this.type===e&&this.value===t}str(){var e;return Je.includes(this.type)?(null===(e=this.value)||void 0===e?void 0:e.toString())||"":x[this.type]}}class He{constructor(e,t){this.text=e,this.position=new r(-1,0,-1,t),this.advance()}advance(){this.position.advance(this.currentChar),this.currentChar=this.text[this.position.idx]}generate(){if(!this.text)return[new Qe(this.position,b.EOF,void 0)];const e=[];for(;void 0!==this.currentChar;)if(" \t\n".includes(this.currentChar))this.advance();else if(i.includes(this.currentChar))e.push(this.makeESNumber());else if(this.currentChar==="//"[0]&&this.text[this.position.idx+1]==="//"[1])this.singleLineComment();else if(this.currentChar==="/*"[0]&&this.text[this.position.idx+1]==="/*"[1])this.multiLineComment();else if(s.includes(this.currentChar))e.push(this.makeIdentifier());else if(-1!==c.indexOf(this.currentChar))e.push(this.makeString());else{const t=this.currentChar,n=this.unknownChar();if(!n){const e=this.position.clone,t=this.currentChar;this.advance();const n=new $e(t);return n.pos=e,n}n.type===b.ASSIGN&&(n.value=t),e.push(n)}return e.push(new Qe(this.position,b.EOF,void 0)),e}makeESNumber(){const e=this.position.clone;let t="",n=0;for(;void 0!==this.currentChar&&Ae(this.currentChar);){if("."===this.currentChar){if(1===n||!i.includes(this.text[this.position.idx+1]))break;n++,t+="."}else"_"!==this.currentChar&&(t+=this.currentChar);this.advance()}return new Qe(e,b.NUMBER,parseFloat(t))}makeString(){const e=this.position.clone;let t="";const n=this.currentChar;for(this.advance();this.currentChar!==n&&void 0!==this.currentChar;)"\\"!==this.currentChar||(this.advance(),"n"!==this.currentChar)?(t+=this.currentChar,this.advance()):(t+="\n",this.advance());return this.advance(),new Qe(e,b.STRING,t)}makeIdentifier(){let e="";const t=this.position.clone;for(;void 0!==this.currentChar&&(s+i).includes(this.currentChar);)e+=this.currentChar,this.advance();const n=b.IDENTIFIER;return new Qe(t,n,e)}unknownChar(){if(void 0!==this.currentChar){for(const e in C)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]&&e[2]===this.text[this.position.idx+2]){const t=this.position.clone;return this.advance(),this.advance(),this.advance(),new Qe(t,C[e],void 0)}for(const e in T)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]){const t=this.position.clone;return this.advance(),this.advance(),new Qe(t,T[e],void 0)}if(this.currentChar in S){const e=this.position.clone,t=S[this.currentChar];return this.advance(),new Qe(e,t,void 0)}}}singleLineComment(){for(this.advance();"\n"!==this.currentChar&&void 0!==this.currentChar;)this.advance();this.advance()}multiLineComment(){for(this.advance();this.currentChar!=="*/"[0]||this.text[this.position.idx+1]!=="*/"[1];)this.advance();this.advance(),this.advance()}}class Ke{constructor(){this.advanceCount=0,this.lastRegisteredAdvanceCount=0,this.reverseCount=0}registerAdvance(){this.advanceCount=1,this.lastRegisteredAdvanceCount++}register(e){return this.lastRegisteredAdvanceCount=e.advanceCount,this.advanceCount+=e.advanceCount,e.error&&(this.error=e.error),e.node||new Ce}tryRegister(e){if(!e.error)return this.register(e);this.reverseCount+=e.advanceCount}success(e){return this.node=e,this}failure(e,t){return this.error=e,t&&(this.error.pos=t),this}}class Xe{constructor(e){this.parse=()=>{var e,t,n,r,i;if(1===this.tokens.length&&this.tokens[0].type===b.EOF)return new Ke;const s=this.statements({topLevel:!0});return s.error||(null===(e=this.currentToken)||void 0===e?void 0:e.type)===w.EOF||this.currentToken?s.error||(null===(n=this.currentToken)||void 0===n?void 0:n.type)===w.EOF?s:s.failure(new Be(`Unexpected token of type '${null===(r=this.currentToken)||void 0===r?void 0:r.str()}'`),null===(i=this.currentToken)||void 0===i?void 0:i.pos):s.failure(new Be("Expected EOF"),null===(t=this.tokens[this.tokens.length-1])||void 0===t?void 0:t.pos)},this.advance=e=>(e&&e.registerAdvance(),this.tokenIdx++,this.currentToken),this.reverse=(e=1)=>(this.tokenIdx-=e,this.currentToken),this.consume=(e,t,n)=>{if(this.currentToken.type!==t)return e.failure(new Be(null!=n?n:`Expected '${x[t]}' but got '${this.currentToken.str()}'`),this.currentToken.pos);this.advance(e)},this.clearEndStatements=e=>{for(;this.currentToken.type===b.END_STATEMENT;)this.advance(e)},this.statements=e=>{const t=new Ke,n=this.currentToken.pos,r=[];this.clearEndStatements(t);const i=t.register(this.statement(e));if(t.error)return t;if(!i)return t;r.push(i);let s=!0;for(;;){let n=0;for(;this.currentToken.type===b.END_STATEMENT;)this.advance(t),n++;if(0===n&&(s=!1),!s)break;const i=t.tryRegister(this.statement(e));if(t.error)return t;i?r.push(i):this.reverse(t.reverseCount)}this.clearEndStatements(t);const o=new pe(n,r,e.topLevel);return t.success(o)},this.statement=e=>{const t=new Ke,n=this.currentToken.pos;if(this.currentToken.matches(b.IDENTIFIER,"return")&&e.returns)return this.returnStatement(t);if(this.currentToken.matches(b.IDENTIFIER,"yield")&&e.returns)return this.returnStatement(t,!0);if(this.currentToken.matches(b.IDENTIFIER,"break")&&e.continueBreak)return this.advance(t),t.success(new ke(n));if(this.currentToken.matches(b.IDENTIFIER,"continue")&&e.continueBreak)return this.advance(t),t.success(new Ee(n));if(this.currentToken.matches(b.IDENTIFIER,"try"))return this.tryCatch(e);if(this.currentToken.matches(b.IDENTIFIER,"for"))return this.forExpr(e);if(this.currentToken.matches(b.IDENTIFIER,"if"))return this.ifExpr(e);const r=t.register(this.expr());if(t.error)return t;if(this.currentToken.type!==b.ASSIGN)return t.success(r);const i=this.currentToken.pos,s=this.currentToken.value;this.advance(t);const o=t.register(this.expr());return t.error?t:r instanceof Te?t.success(new oe(i,r.a,o,s)):r instanceof ye?r.isOptionallyChained?t.failure(new Be("Cannot assign to optionally chained property accessor"),i):(r.assignType=s,r.value=o,t.success(r)):t.failure(new Be("Cannot assign to this value. Expected identifier or index."),i)},this.returnStatement=(e,t=!1)=>{const n=this.currentToken.pos;this.advance(e);let r=new Ce(this.currentToken.pos);if(this.currentToken.type!==b.END_STATEMENT){const t=e.register(this.expr());if(!t)return e.failure(new Be("Expected end of statement"),this.currentToken.pos);r=t}return t?e.success(new me(n,r)):e.success(new ve(n,r))},this.atom=()=>{var e;const t=new Ke,n=this.currentToken,r=null===(e=this.currentToken)||void 0===e?void 0:e.pos;switch(n.type){case b.NUMBER:return this.advance(t),t.success(new xe(r,n));case b.STRING:return this.advance(t),t.success(new Se(r,n));case b.OPAREN:this.advance(t);const e=t.register(this.expr());return t.error?t:(this.consume(t,b.CPAREN),t.error?t:t.success(e));case b.OSQUARE:const i=t.register(this.array());return t.error?t:t.success(i);case b.OBRACES:const s=t.register(this.obLiteral());return t.error?t:t.success(s);case b.IDENTIFIER:return this.advance(),t.success(new Te(n));default:return t.failure(new Be(`Expected identifier, number, array, object literal, string or brackets but got ${this.currentToken.str()}`),this.currentToken.pos)}},this.compound=e=>{const t=new Ke;if(e||(e=t.register(this.atom())),t.error)return t;if(this.currentToken.type===b.OGENERIC){const n=t.register(this.makeGenericCall(e));return t.error?t:this.compound(n)}let n=!1;if(this.currentToken.type===b.QM&&(this.advance(t),n=!0),this.currentToken.type===b.OPAREN){const r=t.register(this.makeFunctionCall(e,n));return t.error?t:this.compound(r)}if(this.currentToken.type===b.OSQUARE){const r=t.register(this.makeIndex(e,n));return t.error?t:this.compound(r)}if(this.currentToken.type===b.DOT){this.advance(t);const r=this.currentToken;return this.consume(t,b.IDENTIFIER),this.compound(new ye(this.currentToken.pos,e,new Se(this.currentToken.pos,r),n))}return t.success(e)},this.unaryOp=()=>{const e=new Ke;if(-1!==[b.NOT,b.QM,b.BITWISE_NOT].indexOf(this.currentToken.type)){const t=this.currentToken;this.advance(e);const n=e.register(this.unaryOp());return e.error?e:e.success(new se(t.pos,n,t))}return this.compound()},this.power=()=>this.binOp(this.unaryOp,[b.POW,b.MOD,b.AMPERSAND,b.PIPE,b.DOUBLE_QM],this.factor),this.factor=()=>{const e=new Ke,t=this.currentToken;if(t.type===b.ADD||t.type===b.SUB){this.advance(e);const n=e.register(this.factor());return e.error?e:e.success(new se(t.pos,n,t))}return this.power()},this.term=()=>this.binOp(this.factor,[b.ASTRIX,b.DIV]),this.arithmeticExpr=()=>this.binOp(this.term,[b.ADD,b.SUB]),this.comparisonExpr=()=>{const e=new Ke,t=e.register(this.binOp(this.arithmeticExpr,[b.EQUALS,b.NOT_EQUALS,b.GT,b.GTE,b.LTE,b.LT]));return e.error?e:e.success(t)},this.expr=()=>{const e=new Ke;if(this.clearEndStatements(e),this.currentToken.type===b.IDENTIFIER){if(-1!==h.indexOf(this.currentToken.value))return this.initiateVar(e);if("func"===this.currentToken.value)return this.funcExpr();if(m.includes(this.currentToken.value))return this.classExpr();if("namespace"===this.currentToken.value)return this.namespace()}return this.binOp((()=>this.binOp(this.comparisonExpr,[b.AND,b.OR])),[[b.IDENTIFIER,"in"]])},this.binOp=(e,t,n=e)=>{const r=new Ke;let i=r.register(e());if(r.error)return r;const s=this;for(;-1!==t.indexOf(s.currentToken.type)||t.filter((e=>"number"!=typeof e&&e[0]===s.currentToken.type&&e[1]===s.currentToken.value)).length>0;){const e=this.currentToken;this.advance(r);const t=r.register(n());if(r.error)return r;i=new ie(i.pos,i,e,t)}return r.success(i)},this.arguments=(e,t=!0,n=b.COMMA)=>{const r=[],i=[],s={};for(;;){if(this.currentToken.type===b.ASTRIX){if(this.advance(e),!t)return{error:new Be("Kwargs not allowed here"),args:r,indefiniteKwargs:i,definiteKwargs:s};if(this.currentToken.type===b.ASTRIX)this.advance(e),i.push(e.register(this.expr()));else{const t=this.currentToken;if(this.consume(e,b.IDENTIFIER),e.error)return{error:e.error,args:r,indefiniteKwargs:i,definiteKwargs:s};if(this.currentToken.matches(b.ASSIGN,"=")){if(this.advance(e),s[t.value]=e.register(this.expr()),e.error)return{error:e.error,args:r,indefiniteKwargs:i,definiteKwargs:s}}else s[t.value]=new Te(t)}}else if(r.push(e.register(this.expr())),e.error)return{error:e.error,args:r,indefiniteKwargs:i,definiteKwargs:s};if(this.currentToken.type!==n)break;this.advance(e)}return{args:r,indefiniteKwargs:i,definiteKwargs:s}},this.makeFunctionCall=(e,t=!1)=>{const n=new Ke,r=this.currentToken.pos;if(this.currentToken.type!==b.OPAREN)return n.failure(new Be("Expected '('"),r);if(this.advance(n),this.currentToken.type===b.CPAREN)return this.advance(n),n.success(new fe(r,e,[],[],{},"__call__",t));const{args:i,definiteKwargs:s,indefiniteKwargs:o,error:a}=this.arguments(n);return a?n.failure(a):this.currentToken.type!==b.CPAREN?n.failure(new Be("Expected ',' or ')'"),this.currentToken.pos):(this.advance(n),n.success(new fe(r,e,i,o,s,"__call__",t)))},this.makeGenericCall=e=>{const t=new Ke,n=this.currentToken.pos;if(this.consume(t,b.OGENERIC),t.error)return t;if(this.currentToken.type===b.CGENERIC){this.advance(t);const r=new fe(n,e);return r.functionType="__generic__",t.success(r)}const{args:r,definiteKwargs:i,indefiniteKwargs:s,error:o}=this.arguments(t,!1);return o?t.failure(o):this.currentToken.type!==b.CGENERIC?t.failure(new Be("Expected ',' or '|>'"),this.currentToken.pos):(this.advance(t),t.success(new fe(n,e,r,s,i,"__generic__")))},this.makeIndex=(e,t=!1)=>{const n=new Ke,r=this.currentToken.pos,i=e;if(this.consume(n,b.OSQUARE),n.error)return n;if(this.currentToken.type===b.CSQUARE)return n.failure(new Be("Cannot index without expression"),r);const s=n.register(this.expr());return n.error?n.failure(new Be("Invalid index"),this.currentToken.pos):this.currentToken.type!==b.CSQUARE?n.failure(new Be("Expected ']'"),this.currentToken.pos):(this.advance(n),n.success(new ye(r,i,s,t)))},this.typeExpr=()=>this.expr(),this.destructuring=(e,t,n)=>{const r=new Ke;if(this.advance(r),r.error)return r;const i=[],s=[];if(this.currentToken.type===b.CSQUARE){if(this.consume(r,b.CSQUARE),!this.currentToken.matches(b.ASSIGN,"="))return r.failure(new Be("Expected '='"),this.currentToken.pos);this.consume(r,b.ASSIGN);const i=r.register(this.expr());return r.error?r:r.success(new ae(e,[],[],i,n,t))}for(;;){if(this.currentToken.type!==b.IDENTIFIER)return r.failure(new Be("Expected identifier"),this.currentToken.pos);if(i.push(this.currentToken),this.advance(r),this.currentToken.type===b.COLON){this.consume(r,b.COLON);const e=r.register(this.typeExpr());if(r.error)return r;s.push(e)}else s.push(new Ie(d.any));if(this.currentToken.type===b.CSQUARE){this.consume(r,b.CSQUARE);break}if(this.consume(r,b.COMMA),r.error)return r}if(!this.currentToken.matches(b.ASSIGN,"="))return r.failure(new Be("Expected '='"),this.currentToken.pos);this.consume(r,b.ASSIGN);const o=r.register(this.expr());return r.error?r:r.success(new ae(e,i.map((e=>e.value)),s,o,n,t))},this.initiateVar=e=>{const t=this.currentToken.pos;let n=!0,r=!1;if(!this.currentToken.matches(b.IDENTIFIER,"let"))return e.failure(new Be("Expected 'let"),t);if(this.advance(e),e.error)return e;if(this.currentToken.matches(b.IDENTIFIER,"global")&&(r=!0,this.advance(e),e.error))return e;if(this.currentToken.matches(b.IDENTIFIER,"var")&&(n=!1,this.advance(e),e.error))return e;if(this.currentToken.type===b.OSQUARE)return this.destructuring(t,n,r);if(this.currentToken.type!==w.IDENTIFIER)return e.failure(new Be("Expected Identifier, '[' or '{'"),this.currentToken.pos);const i=this.currentToken;this.advance(e);let s=d.any;if(this.currentToken.type===b.COLON&&(this.consume(e,b.COLON),s=e.register(this.typeExpr())),this.currentToken.type!==b.ASSIGN)return n?e.failure(new Be("Cannot initialise constant to undefined"),t):e.success(new oe(t,i,new Ce(this.currentToken.pos),"=",r,n,!0,s));const o=this.currentToken.value;this.advance(e);const a=e.register(this.expr());return e.error?e:((a instanceof ge||a instanceof de)&&(a.name=i.value),a instanceof we&&(a.name=new Te(i.value),a.mutable=!n),e.success(new oe(t,i,a,o,r,n,!0,s)))},this.scope=e=>{const t=new Ke;if(this.consume(t,b.OBRACES),t.error)return t;if(this.clearEndStatements(t),this.currentToken.type===b.CBRACES)return this.advance(t),t.success(new Ce(this.currentToken.pos));const n=t.register(this.statements(e));return t.error?t:(this.consume(t,b.CBRACES),t.error?t:t.success(n))},this.addEndStatement=e=>{this.tokens.splice(this.tokenIdx,0,new Qe(this.currentToken.pos,b.END_STATEMENT,void 0)),this.reverse(),this.advance(e)},this.ifExpr=e=>{const t=new Ke,n=this.currentToken.pos;let r;if(!this.currentToken.matches(b.IDENTIFIER,"if"))return t.failure(new Be("Expected 'if'"),this.currentToken.pos);this.advance(t);const i=t.register(this.expr());if(t.error)return t;const s=t.register(this.scope(e));if(t.error)return t;if(this.clearEndStatements(t),this.currentToken.matches(b.IDENTIFIER,"else"))if(this.advance(t),this.currentToken.type==b.OBRACES){if(r=t.register(this.scope(e)),t.error)return t}else if(r=t.register(this.statement(e)),t.error)return t;return this.addEndStatement(t),t.success(new ce(n,i,s,r))},this.parameter=e=>{let t,n=new Ie(d.any),r=!1;if(this.currentToken.type===b.ASTRIX&&(r=!0,this.consume(e,b.ASTRIX)),e.error)return e.error;if(this.currentToken.type!==b.IDENTIFIER){const e=new Be("Expected identifier");return e.pos=this.currentToken.pos,e}const i=this.currentToken.value;if(this.advance(e),this.currentToken.type===b.COLON){if(this.consume(e,b.COLON),e.error)return e.error;if(n=e.register(this.typeExpr()),e.error)return e.error}if(this.currentToken.matches(b.ASSIGN,"=")){if(this.consume(e,b.ASSIGN),e.error)return e.error;if(t=e.register(this.expr()),e.error)return e.error}return{name:i,type:n,defaultValue:t,isKwarg:r}},this.funcCore=()=>{const e=new Ke,t=this.currentToken.pos;let n,r=new Ie(d.any),i=[],s=!1,o=!1;if(this.consume(e,b.OPAREN),this.currentToken.type===b.CPAREN)this.advance(e);else{const t=this.parameters(e);if(e.error)return e;t&&(i=t.args,o=t.allowKwargs,s=t.allowArgs)}if(this.currentToken.type===b.COLON&&(this.advance(e),r=e.register(this.typeExpr()),e.error))return e;if(this.currentToken.type!==b.OBRACES){if(n=new ve(this.currentToken.pos,e.register(this.expr())),e.error)return e}else{if(this.consume(e,b.OBRACES),e.error)return e;if(n=this.currentToken.type!==b.CBRACES?e.register(this.statements({continueBreak:!1,returns:!0})):new Ce(this.currentToken.pos),this.consume(e,b.CBRACES),e.error)return e}const a=new de(t,n,i,r);return a.allowKwargs=o,a.allowArgs=s,e.success(a)},this.funcExpr=()=>{const e=new Ke;let t;if(!this.currentToken.matches(b.IDENTIFIER,"func"))return e.failure(new Be("Expected 'func'"),this.currentToken.pos);this.advance(e),this.currentToken.type===b.IDENTIFIER&&(t=this.currentToken.value,this.advance(e));const n=e.register(this.funcCore());if(e.error)return e;if(void 0!==t){if(!(n instanceof de))throw console.error("expected function"),"expected function";n.name=t,n.isDeclaration=!0}return e.success(n)},this.classExpr=e=>{const t=new Ke,n=this.currentToken.pos,r=[];let i,s,o=new Ie(d.object),a=!1;const c={},l={};let u=[];if(this.currentToken.matches(b.IDENTIFIER,"abstract")&&(this.advance(t),a=!0),!this.currentToken.matches(b.IDENTIFIER,"class"))return t.failure(new Be("Expected 'class'"),this.currentToken.pos);if(this.advance(t),this.currentToken.type===b.IDENTIFIER&&"extends"!==this.currentToken.value&&(s=this.currentToken.value,e=s,this.advance(t)),this.currentToken.type===b.OGENERIC){this.advance(t);const e=this.parameters(t,!1,!1,b.CGENERIC);if(t.error)return t;if(e&&(u=e.args),t.error)return t}if(this.currentToken.matches(b.IDENTIFIER,"extends")&&(this.advance(t),o=t.register(this.expr()),t.error))return t;if(this.consume(t,b.OBRACES),t.error)return t;if(this.currentToken.type===b.CBRACES)return this.advance(t),t.success(new ge(n,[],{},[],{},u,o,void 0,e,void 0!==s,a));for(;this.currentToken.type===b.IDENTIFIER;){let e=!1;"static"===this.currentToken.value&&(e=!0);const n=this.currentToken.value;if(this.advance(t),this.currentToken.type===b.OPAREN){const s=t.register(this.funcCore());if(t.error)return t;if(!(s instanceof de))return t.failure(new Be(`Tried to get function, but got ${s} instead`),this.currentToken.pos);s.name=n,"init"===n?i=s:e||r.push(s),e?l[n]=new Ie(d.function):c[n]=new Ie(d.function)}else if(this.currentToken.type!==b.COLON){if(this.consume(t,b.END_STATEMENT),t.error)return t;e?l[n]=new Ie(d.any):c[n]=new Ie(d.any)}else{this.consume(t,b.COLON);const r=t.register(this.typeExpr());if(t.error)return t;if(e?l[n]=r:c[n]=r,this.consume(t,b.END_STATEMENT),t.error)return t}}return this.consume(t,b.CBRACES),t.success(new ge(n,r,c,[],l,u,o,i,e,void 0!==s,a))},this.forExpr=e=>{const t=new Ke,n=this.currentToken.pos;let r=!0;if(!this.currentToken.matches(b.IDENTIFIER,"for"))return t.failure(new Be("Expected 'for'"),this.currentToken.pos);if(this.advance(t),this.currentToken.matches(b.IDENTIFIER,"var")?(r=!1,this.advance(t)):this.currentToken.matches(b.IDENTIFIER,"let")&&this.advance(t),t.error)return t;if(e=Object.assign(Object.assign({},e),{continueBreak:!0}),this.currentToken.type===b.IDENTIFIER){const i=this.currentToken;if(this.advance(t),this.currentToken.matches(b.ASSIGN,"=")){this.advance(t);const s=t.register(this.expr());if(t.error)return t;const o=t.register(this.scope(e));return t.error?t:(this.addEndStatement(t),t.error?t:t.success(new ue(n,o,s,i,!1,r)))}}for(;!this.currentToken.matches(b.IDENTIFIER,"for");)this.reverse();this.advance(t);const i=t.register(this.expr());if(t.error)return t;const s=t.register(this.scope(Object.assign(Object.assign({},e),{continueBreak:!0})));return t.error?t:(this.addEndStatement(t),t.error?t:t.success(new le(n,i,s)))},this.array=()=>{const e=new Ke,t=[],n=this.currentToken.pos;if(this.currentToken.type!==b.OSQUARE)return e.failure(new Be("Expected '["),n);if(this.advance(e),this.currentToken.type===b.CSQUARE)return this.advance(e),e.success(new he(n,[]));if(t.push(e.register(this.expr())),e.error)return e.failure(new Be("Unexpected token"),this.currentToken.pos);for(;this.currentToken.type===b.COMMA;)if(this.advance(e),t.push(e.register(this.expr())),e.error)return e;return this.currentToken.type!==b.CSQUARE?e.failure(new Be("Expected ',' or ']'"),this.currentToken.pos):(this.advance(e),e.success(new he(n,t)))},this.obLiteral=()=>{const e=new Ke,t=[],n=this.currentToken.pos;if(this.currentToken.type!==b.OBRACES)return e.failure(new Be("Expected '{"),n);if(this.advance(e),this.currentToken.type===b.CBRACES)return this.advance(e),e.success(new _e(n,[]));for(;;){let n,r,i;if(this.currentToken.type===b.IDENTIFIER)n="id",r=new Se(this.currentToken.pos,this.currentToken),this.advance(e);else if(this.currentToken.type===b.STRING)n="string",r=new Se(this.currentToken.pos,this.currentToken),this.advance(e);else{if(this.currentToken.type!==b.OSQUARE)break;if(n="value",this.advance(e),r=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==b.CSQUARE)return e.failure(new Be(`Expected ']', got '${this.currentToken.str()}'`),this.currentToken.pos);this.advance(e)}if(this.currentToken.type===b.COLON){if(this.advance(e),i=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==b.COMMA&&this.currentToken.type!==b.CBRACES)return e.failure(new Be(`Expected ',' or '}', got '${this.currentToken.str()}'`),this.currentToken.pos);this.currentToken.type===b.COMMA&&this.advance(e)}else{if(this.currentToken.type!==b.COMMA&&this.currentToken.type!==b.CBRACES)return e.failure(new Be(`Expected ',' or '}', got '${this.currentToken.str()}'`),this.currentToken.pos);if("id"!==n)return e.failure(new Be("You must specify a value when initialising an object literal with a key that is not an identifier.\n                        Try using `key: value` syntax."),this.currentToken.pos);this.reverse(),i=new Te(this.currentToken),this.advance(e),this.currentToken.type===b.COMMA&&this.advance(e)}if(t.push([r,i]),e.error)return e}return this.currentToken.type!==b.CBRACES?e.failure(new Be("Expected identifier, ',' or '}'"),this.currentToken.pos):(this.advance(e),e.success(new _e(n,t)))},this.namespace=()=>{const e=new Ke,t=this.currentToken.pos;let n;if(this.consume(e,b.IDENTIFIER),e.error)return e;if(this.currentToken.type!==b.OBRACES&&(n=e.register(this.expr()),e.error))return e;if(this.consume(e,b.OBRACES),e.error)return e;if(this.currentToken.type===b.CBRACES)return this.advance(e),e.success(new we(t,new Ce,n,!1,!!n));const r=e.register(this.statements({returns:!1,continueBreak:!1}));return e.error?e:(this.consume(e,b.CBRACES),e.error?e:e.success(new we(t,r,n,!1,!!n)))},this.tryCatch=e=>{const t=new Ke;if(this.consume(t,b.IDENTIFIER),t.error)return t;if(this.consume(t,b.OBRACES),t.error)return t;if(this.currentToken.type===b.CBRACES)return t.failure(new Be("No empty try block"),this.currentToken.pos);const n=t.register(this.statements(e));if(t.error)return t;if(this.consume(t,b.CBRACES),t.error)return t;if("catch"!==this.currentToken.value)return t.success(new be(this.currentToken.pos,n,new Ce));if(this.consume(t,b.IDENTIFIER),t.error)return t;if(this.consume(t,b.OBRACES),t.error)return t;if(this.currentToken.type===b.CBRACES)return t.success(new be(this.currentToken.pos,n,new Ce));const r=t.register(this.statements(e));return t.error?t:(this.consume(t,b.CBRACES),t.error?t:(this.addEndStatement(t),t.error?t:t.success(new be(this.currentToken.pos,n,r))))},this.tokens=e,this.tokenIdx=-1,this.advance()}get nextToken(){if(this.tokens.length-1>=this.tokenIdx+1)return this.tokens[this.tokenIdx+1]}get currentToken(){return this.tokens[this.tokenIdx]}parameters(e,t=!0,n=!0,r=b.CPAREN){var i;let s=!1,o=!1,a=!1,c=!1;const l=[];for(;;){const r=this.currentToken.pos;if(this.currentToken.type===b.ASTRIX&&(null===(i=this.nextToken)||void 0===i?void 0:i.type)!==b.IDENTIFIER){if(this.advance(e),this.currentToken.type===b.ASTRIX){if(!n)return void e.failure(new Be("'**' parameter not permitted here"));c=!0,this.advance(e);break}if(!n)return void e.failure(new Be("'*' parameter not permitted here"));if(a=!0,this.currentToken.type!==b.COMMA)break;if(this.advance(e),e.error)return;if(this.currentToken.type===b.ASTRIX){if(this.advance(e),this.currentToken.type!==b.ASTRIX)return void e.failure(new Be("Cannot have ** arg followed by *, try switching them around"),this.currentToken.pos);if(!n)return void e.failure(new Be("'**' parameter not permitted here"));if(c=!0,this.advance(e),e.error)return;break}}const u=this.parameter(e);if(u instanceof Me)return void e.failure(u);if(!t&&u.isKwarg)return void e.failure(new Be("Kwarg parameter not permitted here"));if(l.filter((e=>e.name===u.name)).length)return void e.failure(new Be("Cannot have two parameters with the same name"),r);if(s&&!u.defaultValue)return void e.failure(new Be("Must use default parameter here"),this.currentToken.pos);if(o&&!u.isKwarg)return void e.failure(new Be("Must use kwarg here"),this.currentToken.pos);if(u.defaultValue&&(s=!0),u.isKwarg&&(o=!0),l.push(u),this.currentToken.type!==b.COMMA)break;this.advance(e)}if(this.currentToken.type===r)return this.advance(e),{args:l,allowKwargs:c,allowArgs:a};e.failure(new Be("Expected ',' or ')'"),this.currentToken.pos)}}const Ye=Symbol("AllowAny"),Ze={permissions:{networking:!1,imports:!0,accessDOM:!1,useSTD:!0,fileSystem:!1},modules:{[Ye]:"y"}};function et(e){let t="[";for(const n of e)t+=n+"][";return t.substring(0,t.length-1)}function tt(e,t,n=[]){if(!e[Ye]){const r=Object.keys(t).filter((t=>!(t in e)));for(const e of r)console.error("Cannot parse config",` - unknown property config${et([...n,e])}`)}for(const r of Object.keys(t)){if(typeof e[r]!=typeof t[r]&&!e[Ye])return void console.error("Cannot parse config",` - config${et([...n,r])} should be of type '${typeof e[r]}'`);"object"!=typeof e[r]?e[r]=t[r]:tt(e[r],t[r],[...n,r])}}function nt(e){tt(Ze,e)}const rt=()=>{if(!Ze.permissions.accessDOM)return new Ve("No access to DOM");if(l)return new Le;const e=window;return void 0===e?new je("Object","undefined","window","Window is undefined! ES expected to be in a browser."):"$"in e?{$:new $(e.$,"jquery"),window:new $(e,"window"),document:new $(e.document,"document")}:{window:new $(e,"window"),document:new $(e.document,"document")}},it={ascii:()=>({asciiToChar:e=>{if("number"!=typeof e)throw new TypeError("number");return String.fromCharCode(e)},charToAscii:e=>{if("number"!=typeof e)throw new TypeError("number");return Ne(e).charCodeAt(0)}}),json:()=>({parse:e=>JSON.parse(Ne(e)),stringify:JSON.stringify}),time:()=>({now:y,date:Date}),regex:()=>RegExp,promise:()=>Promise,math:()=>Math},st={};function ot(e){return e in it||e in st}function at(e,t){st[e]=t}function ct(e){if(e in st)return st[e];if(e in it){const t=it[e](v);if(t instanceof Me)return t;const n=new $(t,e);return st[e]=n,n}}class lt extends O{constructor(){super(...arguments),this.__includes__=(e,t)=>{for(const n of Object.keys(this.__value__)){const r=this.__value__[n];let i=new P;if(t.has_property(e,new W(n)).__value__){const r=t.__get__(e,new W(n));if(r instanceof Me)return r;i=r}const s=r.__includes__(e,i);if(s instanceof Me)return s;if(!s.__value__)return new V}return new V(!0)},this.__subtype_of__=(e,t)=>{if(Object.is(t,d.any)||Object.is(t,d.object))return new V(!0);if(!(t instanceof O))return new V;for(const n of Object.keys(this.__value__)){if(!(n in t.__value__))return new V;const r=this.__value__[n];let i=new P;if(t.has_property(e,new W(n))){const r=t.__get__(e,new W(n));if(r instanceof Me)return r;i=r}const s=r.__subtype_of__(e,i);if(s instanceof Me)return s;if(!s.__value__)return new V}return new V(!0)},this.__set__=(e,t)=>new je("Mutable","Immutable",Ne(t)),this.str=(e,t=new z)=>{let n=Ne(this.__value__,t.__value__);return"\n"===n[n.length-1]&&(n=n.substr(0,n.length-1)),new W("interface "+n)}}}const ut={range:[(e,t,n,r)=>{if(!(t instanceof z))return new q;const i=t.__value__;if(n instanceof P)try{return new q([...Array(i).keys()].map((e=>new z(e))))}catch(e){return new Me("RangeError",`Cannot make range of length '${Ne(i)}'`)}let s=1;if(!(n instanceof z))return new je("number",n.__type_name__(),Ne(n));const o=n.__value__;if(!(r instanceof P)){if(!(r instanceof z))return new je("number",r.__type_name__(),Ne(r));s=r.__value__}const a=[];let c=i;for(;c<o;)a.push(new z(c)),c+=s;return new q(a)},{args:[{name:"min",type:"Num"},{name:"max",type:"Num"},{name:"step",type:"Num"}],description:"Generates an array of integers given N. Starts at 0 and goes to N-1. Can be used like for i in range(10) ..., similarly to python.",returns:"array of numbers from 0 to N-1",returnType:"Arr[Num] | RangeError"}],log:[(e,...t)=>{console.log(...t.map((e=>Ne(e))))},{args:[{name:"...values",type:"any[]"}],description:"Uses console.log to log all values",returnType:"nil",allow_args:!0}],parse_num:[(e,t)=>{try{const e=parseFloat(Ne(t));return isNaN(e)?new Me("TypeError",`Cannot convert '${Ne(t)}' to a number.`):new z(e)}catch(e){return new Me("TypeError",`Cannot convert '${Ne(t)}' to a number.`)}},{args:[{name:"num",type:"Any"}],description:"Converts a string of digits into a number. Works with decimals and integers. Calls .str() on value before using native JS 'parseFloat' function. Returns TypeError if the string can't be converted into a number.",returnType:"number | TypeError"}],help:[(e,...t)=>{var n;if("NoParam"in(null!==(n=e.kwargs)&&void 0!==n?n:{}))return new W("Visit https://entropygames.io/entropy-script for help\nTry 'help(object)' for help about a particular object.");let r="";for(const e of t){if(!(e instanceof I))return void console.log("Invalid arg not primitive: "+Ne(e));const t=e.__info__;if(r+=`${Y.yellow(`Help on '${t.name||"(anonymous)"}'`)}:`,r+="\n",r+=`    ${Y.yellow("Value")}: ${Oe(Oe(Ne(e)))}`,r+=`    ${Y.yellow("Type")}: '${Ne(e.__type_name__())}'`,r+=`    ${Y.yellow("Location")}: ${t.file||Y.yellow("(unknown)")}`,r+=`        ${Y.green(t.description)||"No description."}`,r+=`    ${t.helpLink?Y.cyan(t.helpLink+"\n\n"):""}`,t.args&&e instanceof R){const e=t.args.length,n=t.args.filter((e=>e.required)).length;r+=e==n?Y.yellow(`    Arguments (${e}): \n`):Y.yellow(`    Arguments (${n}-${e}): \n`);for(const[e,n]of t.args.entries())r+="object"!=typeof n?`        ${e+1}. INVALID ARG INFO`:`        ${e+1}. ${n.name}${!1===n.required?Y.yellow(" (optional) "):" "}{${n.type}} ${n.description||""}\n`;r+="\n\n",t.returns&&(r+=`    Returns: ${t.returns}\n\n`),t.returnType&&(r+=`    Return Type: ${t.returnType}\n\n`)}if(t.contents&&(e instanceof O||e instanceof N)){r+="    Properties: \n      ";for(const e of t.contents)r+=e.name+"\n      "}}return new W(r)},{description:"Logs documentation about a value",returns:"value passed in",allow_args:!0,allow_kwargs:!0,returnType:"Str"}],delete:[({context:e},t)=>{const n=Ne(t),r=e.remove(n);if(r instanceof Me)return r},{name:"delete",args:[{name:"identifier",type:"Str"}],description:"Deletes a variable from the current context"}],__path__:[({context:e})=>new W(e.path),{name:"__path__",args:[],description:"Returns the current path",returnType:"Str"}],__symbols__:[(e,t)=>{let{context:n}=e;if(t.bool(e).__value__){let e=n.keys;for(;n.parent;)e=n.parent.keys,n=n.parent;return Q(e)}return Q(n.keys)},{name:"__symbols__",args:[{name:"recursive",type:"Bool",description:"if true, returns the names of all symbols available in the current scope, if false, just the symbols declared in the current scope."}],returns:"The names of all symbols in the current context",returnType:"Arr<|Str|>"}],using:[(e,t,n)=>{if(!(t instanceof N||t instanceof $||t instanceof O))return new je("Namespace",Ne(t.__type_name__()));let{context:r}=e;const i=!(n&&!n.bool(e).__value__),s=H(t,e);i?r=r.root:r.parent&&(r=r.parent);for(const e of Object.keys(s)){const t=r.setOwn(e,Q(s[e]));if(t)return t}},{name:"using",args:[{name:"module",type:"Obj"},{name:"global",type:"Bool"}],description:"Adds contents of a namespace to the current or global context",returnType:"nil"}],sleep:[({context:e},t,n)=>{if(!(t instanceof z))return new je("number",Ne(t.__type_name__()),Ne(t));Pe(t.__value__).then((()=>{const t=n.__call__({context:e});t instanceof Me&&console.log(t.str)}))},{name:"sleep",args:[{name:"time",type:"Num"},{name:"callback",type:"Func"}],description:"Waits n milliseconds and then executes the callback"}],throw:[(e,t,n)=>t instanceof A?t.__value__:new Me(Ne(t),Ne(n)),{name:"throw",args:[{name:"name",type:"Str"},{name:"details",type:"Str"}]}],typeof:[({context:e},t)=>{if(!(t instanceof W))return new je("Str",t.__type_name__(),Ne(t));const n=Ne(t);if(!e.has(n))return new Ge(n);const r=e.getSymbol(n);return r?r instanceof Me?r:r.type:new Ge(n)},{name:"typeof",args:[{name:"identifier",type:"Str"}]}],interface:[(e,t)=>t instanceof O?new lt(t.__value__):new je("Obj",t.__type_name__(),Ne(t)),{name:"throw",args:[{name:"value",type:"Obj"}]}]},ht={},_t=(e,t,n)=>{if(!Ze.permissions.fileSystem)return new Ve("No access to file system");if(!("path"in v))return new qe("path");if(!("fs"in v))return new qe("fs");const{path:r,fs:i}=v,s=Ne(t);let o=Ne(n);return-1===f.indexOf(o)&&(o="utf-8"),i.existsSync(s)?new O({str:new R((({context:e})=>new W(i.readFileSync(r.join(e.path,s),o).toString())),[],"str",void 0,d.string),write:new R((({context:e},t)=>{i.writeFileSync(e.path+s,Ne(t))}),[{name:"path",type:d.string}]),append:new R((({context:e},t)=>{i.appendFileSync(e.path+s,Ne(t))}),[{name:"path",type:d.string}])}):new De(s)},pt=(e,...t)=>{if(!("node-fetch"in v))return new qe("node-fetch");if(!Ze.permissions.networking)return new Ve("Networking not allowed but is required for 'fetch'");const n=v["node-fetch"].default;return new $(n(...t.map((t=>H(t,e)))))},ft=(e,t)=>{if(!Ze.permissions.imports)return new Ve("Imports not allowed");let n=Ne(t);if(Ze.permissions.useSTD&&ot(n))return ct(n);if(!("path"in v))return new qe("path");if(!("fs"in v))return new qe("fs");const{path:r,fs:i}=v;n=r.join(e.context.path,n);try{if(!i.existsSync(n)){if(!i.existsSync("./particles/"+n))return new Me("ImportError",`Can't find file '${n}' to import.`);if(!i.existsSync("particles/"+n+"/main.es"))return new Me("ImportError",`Module '${n}' has no entry point. Requires 'main.es'.`);n="particles/"+n+"/main.es"}const e=r.dirname(n),t=i.readFileSync(n,"utf-8"),s=new Z;s.parent=o,s.path=e,s.set("__main__",new V,{isConstant:!0,forceThroughConst:!0,global:!0});const a=new N(new W(n),{}),c=vt(t,{env:s,fileName:n,currentDir:e});return a.__value__=s.getSymbolTableAsDict(),c.error?c.error:a}catch(e){return new Me("ImportError",e.toString())}};function dt({print:e=console.log,input:t=(()=>{}),node:r,context:i=new Z,path:s="",libs:c={}}={}){var h,_,p,f,m;return p=this,m=function*(){a(i),B();for(const e of Object.keys(c)){if(!Array.isArray(c[e])||2!==c[e].length)throw`lib ${e} is not of type [any, boolean]`;const[t,n]=c[e];if("boolean"!=typeof n)throw`lib ${e} is not of type [any, boolean]`;n&&at(e,new $(t)),v[e]=t}var p,f;p=e,f=t,ut.import=[(e,t)=>{if(l)return new Le;if(!Ze.permissions.imports)return new Ve("Imports not allowed");if(!(t instanceof W))return new je("Str",t.__type_name__(),Ne(t));const n=Ne(t);return Ze.permissions.useSTD&&ot(n)?ct(n):new De(n,"Module not found. Try adding it to the pre-loaded modules.")},{description:"Loads a module. Cannot be used asynchronously, so add any modules to pre-load in the esconfig.json file.",args:[{name:"path",type:"Str"}]}],ut.print=[(e,...t)=>{let n="";for(const e of t)n+=Ne(e);p(n)},{allow_args:!0}],ut.input=[({context:e},t,n)=>{f(t.__value__,(t=>{const r=null==n?void 0:n.__value__;if(r instanceof R){const n=r.__call__({context:e},new W(t));n instanceof Me&&console.log(n.str)}else"function"==typeof r&&r(t);return new W("'input()' does not return anything. Pass in a function as the second argument, which will take the user input as an argument.")}))},{args:[{name:"msg",type:"Str"},{name:"callback",type:"Func"}]}],ut.module=[(e,t,n)=>t instanceof W?n instanceof R||n instanceof G||n instanceof O||n instanceof $||n instanceof N?void at(Ne(t),n):new je("Obj | Func",t.__type_name__(),Ne(t)):new je("Str",t.__type_name__(),Ne(t)),{args:[{name:"msg",type:"Str"},{name:"module",type:"namespace"}]}];for(const e in ut){const[t,n]=ut[e],r=null!==(_=null===(h=n.args)||void 0===h?void 0:h.length)&&void 0!==_?_:t.length-1,s=new Array(r).fill({name:"unknown",type:d.any,defaultValue:new P}),o=new R(t,n.allow_args?[]:s,e,void 0,void 0,i,!0,n.allow_args,n.allow_kwargs);n.allow_args&&(o.__allow_args__=!0),o.__info__=n,o.__info__.name=e,o.__info__.builtin=!0,o.__info__.file="builtin",i.set(e,o,{global:!0,isConstant:!0,type:d.function})}!function(e){const t={false:new V(!1),true:new V(!0),nil:new P,inf:new z(1/0),__main__:new V(!0),Any:d.any,Num:d.number,Str:d.string,Bool:d.bool,Func:d.function,Arr:d.array,Obj:d.object,Type:d.type,Err:d.error,Null:d.undefined};for(const e of Object.keys(n))t[e]=new $(n[e],e,!1,!0);for(const n in t){const r=t[n];e.set(n,r,{global:!0,isConstant:!0})}}(i);const m=void(l||(it.dom=rt));if(m)return m;i.initialisedAsGlobal=!0,s&&(i.path=s),(null!=r?r:l)&&(u(),yield g(!0),function(e){e.set("import",new R(ft,[{name:"path",type:d.string}],"import",void 0,d.object),{forceThroughConst:!0,isConstant:!0}),e.set("open",new R(_t,[{name:"path",type:d.string},{name:"encoding",type:d.string}],"open",void 0,d.object),{forceThroughConst:!0,isConstant:!0}),e.set("fetch",new R(pt,void 0,"fetch",void 0,void 0,void 0,void 0,!0,!0),{forceThroughConst:!0,isConstant:!0})}(i));const y=yield function(e){return t=this,r=function*(){for(const t of Object.keys(e)){let n=e[t];"string"!=typeof n&&at(t,new $(n)),n in ht&&at(t,ht[n]),".es"!==n.substring(n.length-3)&&(n+=".es");try{const e=yield(yield fetch(n)).text(),r=new Z;r.parent=o,r.set("__main__",new V,{isConstant:!0,forceThroughConst:!0,global:!0});const i=n.split("/"),s=i.pop(),a=i.join("/"),c=new N(new W(s),{});ht[n]=c;const l=vt(e,{env:r,fileName:t,currentDir:a});if(c.__value__=r.getSymbolTableAsDict(),l.error)return l.error;at(t,c)}catch(e){return new Me("ImportError",e.toString())}}},new((n=void 0)||(n=Promise))((function(e,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function o(e){try{a(r.throw(e))}catch(e){i(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(s,o)}a((r=r.apply(t,[])).next())}));var t,n,r}(Ze.modules);if(y instanceof Me)return y;for(const e of E)vt(e,{fileName:"std",env:o});return o},new((f=void 0)||(f=Promise))((function(e,t){function n(e){try{i(m.next(e))}catch(e){t(e)}}function r(e){try{i(m.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof f?i:new f((function(e){e(i)}))).then(n,r)}i((m=m.apply(p,[])).next())}))}function vt(e,{env:t=o,measurePerformance:n=!1,fileName:r="(unknown)",currentDir:i=""}={}){i&&(t.path=i),re.maxTime=0,re.totalTime=0,re.interprets=0;const s={total:0,lexerTotal:0,parserTotal:0,interpretTotal:0,nodeMax:0,nodeAvg:0,nodeTotal:0,interprets:0};let a=y();if(!t.root.initialisedAsGlobal){const e=new te;return e.error=new Me("UninitialisedError","Global context has not been initialised with global values"),e}const c=new He(e,r).generate();if(c instanceof Me){const e=new te;return e.error=c,e}s.lexerTotal=y()-a,a=y();const l=new Xe(c).parse();if(l.error){const e=new te;return e.error=l.error,e}if(s.parserTotal=y()-a,a=y(),!l.node){const e=new te;return e.val=new q([]),e}const u=l.node.interpret(t);return s.interpretTotal=y()-a,s.total=y()-a,s.nodeMax=re.maxTime,s.nodeTotal=re.totalTime,s.nodeAvg=re.totalTime/re.interprets,s.interprets=re.interprets,n&&console.log(s),Object.assign(Object.assign({},u),{timeData:s})}function mt(e,{fileName:t="(unknown)",currentDir:n=""}={}){const r=new He(e,t).generate();if(r instanceof Me)return{error:r};const i=new Xe(r).parse();return i.error?{error:i.error}:i.node?{compileToJavaScript:e=>{if(!i.node)throw"res.node still undefined";const t=`// Generated by EntropyScript->JavaScript compiler v${_}\n`,n="Array.prototype.contains = function (element) {\n\treturn this.indexOf(element) !== -1;\n};\n\nfunction parseNum (str) {\n\treturn parseFloat(str);\n}\n\nconst print = console.log;\n\nESNumber.prototype[Symbol.iterator] = function () {\n\treturn {\n\t\tcurrent: 0,\n\t\tlast: this,\n\t\tnext() {\n\t\t\tif (this.current <= this.last) {\n\t\t\t\treturn {\n\t\t\t\t\tdone: false,\n\t\t\t\t\tvalue: this.current++\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn { done: true };\n\t\t\t}\n\t\t}\n\t};\n};\n\nconst __private__ = {\n\tbims: {\n\t\tmath: Math,\n\t\ttime: {\n\t\t\tdate: Date,\n\t\t\tnow: Date.now,\n\t\t},\n\t},\n};\n\nif (typeof performance !== 'undefined') {\n\t__private__.bims.time.now = performance.now;\n}\n\nfunction import_ (path) {\n\tif (__private__.bims.hasOwnProperty(path)) {\n\t\treturn __private__.bims[path];\n\t}\n}\n\nfunction range (minP, maxP, stepP) {\n\tif (typeof minP !== 'number') {\n\t\treturn [];\n\t}\n\n\tconst min = minP.__value__;\n\n\tif (typeof maxP === 'undefined') {\n\t\ttry {\n\t\t\treturn [...Array(min).keys()];\n\t\t} catch (e) {\n\t\t\tthrow `RangeError: Cannot make range of length '${min}'`;\n\t\t}\n\t}\n\n\tlet step = 1;\n\n\tif (typeof maxP !== 'number') {\n\t\tthrow 'TypeError: Expected number';\n\t}\n\n\tlet max = maxP.__value__;\n\n\tif (typeof stepP !== 'undefined') {\n\t\tif (typeof stepP !== 'number') {\n\t\t\tthrow 'TypeError: Expected number';\n\t\t}\n\t\tstep = stepP.__value__;\n\t}\n\n\tlet arr = [];\n\n\tlet i = min;\n\twhile (i < max) {\n\t\tarr.push(i);\n\t\ti += step;\n\t}\n\n\treturn arr;\n}".toString().replace(/(\r\n|\n|\r|\t| )+/gm," ")+"\n",r=i.node.compileJS(e);return r.error?r:(e.minify&&(r.val=r.val.replace(/(\r\n|\n|\r|\t| )+/gm," ")),new ne(t+n+r.val))},compileToPython:e=>{if(!i.node)throw"res.node still undefined";const t=`# Generated by EntropyScript->Python compiler v${_}\n\n`,n="\n###############################\n# START OF ENTROPY SCRIPT STD #\n###############################\nimport time\n\nlog = print\nparseNum = float\n\ndef help(thing):\n    return 'Help is not available in ES compiled Python'\n\n\ndef GENERATE_PRIVATE():\n    return {\n        'modules': {\n            'ascii': {\n\n            },\n            'time': {\n                'now': lambda: time.time_ns() / (10 ** 6)\n            }\n        }\n    }\n\nPRIVATE = GENERATE_PRIVATE()\n\ndef import_ (path):\n    if path in PRIVATE['modules']:\n        return PRIVATE['modules'][path]\n\n\n#############################\n# END OF ENTROPY SCRIPT STD #\n#############################".toString()+"\n",r=i.node.compilePy(e);return r.error?r:new ne(t+n+r.hoisted+"\n"+r.val)},interpret:(e=o)=>{if(!i.node)throw"res.node still undefined";if(n&&(e.path=n),!e.root.initialisedAsGlobal){const e=new te;return e.error=new Me("Uninitialised","Global context has not been initialised with global values"),e}return i.node.interpret(e)}}:{error:new Me("Error","no output")}}return t})(),e.exports=t()},842:function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=21)}([function(e,t){var r={};e.exports=r,function(){r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r._warnedOnce={},r._decomp=null,r.extend=function(e,t){var n,i;"boolean"==typeof t?(n=2,i=t):(n=1,i=!0);for(var s=n;s<arguments.length;s++){var o=arguments[s];if(o)for(var a in o)i&&o[a]&&o[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=o[a]:(e[a]=e[a]||{},r.extend(e[a],i,o[a])):e[a]=o[a]}return e},r.clone=function(e,t){return r.extend({},t,e)},r.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},r.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}for(var i in e)t.push(e[i]);return t},r.get=function(e,t,n,r){t=t.split(".").slice(n,r);for(var i=0;i<t.length;i+=1)e=e[t[i]];return e},r.set=function(e,t,n,i,s){var o=t.split(".").slice(i,s);return r.get(e,t,0,-1)[o[o.length-1]]=n,n},r.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(r.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}return e},r.choose=function(e){return e[Math.floor(r.random()*e.length)]},r.isElement=function(e){return"undefined"!=typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"==typeof e},r.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},r.isString=function(e){return"[object String]"===toString.call(e)},r.clamp=function(e,t,n){return e<t?t:e>n?n:e},r.sign=function(e){return e<0?-1:1},r.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-r._nowStartTime},r.random=function(t,n){return n=void 0!==n?n:1,(t=void 0!==t?t:0)+e()*(n-t)};var e=function(){return r._seed=(9301*r._seed+49297)%233280,r._seed/233280};r.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warnOnce=function(){var e=Array.prototype.slice.call(arguments).join(" ");r._warnedOnce[e]||(r.warn(e),r._warnedOnce[e]=!0)},r.deprecated=function(e,t,n){e[t]=r.chain((function(){r.warnOnce("🔅 deprecated 🔅",n)}),e[t])},r.nextId=function(){return r._nextId++},r.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},r.map=function(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n},r.topologicalSort=function(e){var t=[],n=[],i=[];for(var s in e)n[s]||i[s]||r._topologicalSort(s,n,i,e,t);return t},r._topologicalSort=function(e,t,n,i,s){var o=i[e]||[];n[e]=!0;for(var a=0;a<o.length;a+=1){var c=o[a];n[c]||t[c]||r._topologicalSort(c,t,n,i,s)}n[e]=!1,t[e]=!0,s.push(e)},r.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var r=function(){for(var t,n=new Array(arguments.length),r=0,i=arguments.length;r<i;r++)n[r]=arguments[r];for(r=0;r<e.length;r+=1){var s=e[r].apply(t,n);void 0!==s&&(t=s)}return t};return r._chained=e,r},r.chainPathBefore=function(e,t,n){return r.set(e,t,r.chain(n,r.get(e,t)))},r.chainPathAfter=function(e,t,n){return r.set(e,t,r.chain(r.get(e,t),n))},r.setDecomp=function(e){r._decomp=e},r.getDecomp=function(){var e=r._decomp;try{e||"undefined"==typeof window||(e=window.decomp),e||void 0===n.g||(e=n.g.decomp)}catch(t){e=null}return e}}()},function(e,t){var n={};e.exports=n,n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var r=0;r<t.length;r++){var i=t[r];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var n=e.max.x-e.min.x,r=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+r}},function(e,t){var n={};e.exports=n,n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t,n){var r=Math.cos(t),i=Math.sin(t);n||(n={});var s=e.x*r-e.y*i;return n.y=e.x*i+e.y*r,n.x=s,n},n.rotateAbout=function(e,t,n,r){var i=Math.cos(t),s=Math.sin(t);r||(r={});var o=n.x+((e.x-n.x)*i-(e.y-n.y)*s);return r.y=n.y+((e.x-n.x)*s+(e.y-n.y)*i),r.x=o,r},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},n.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},n.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]},function(e,t,n){var r={};e.exports=r;var i=n(2),s=n(0);r.create=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],s={x:i.x,y:i.y,index:r,body:t,isInternal:!1};n.push(s)}return n},r.fromPath=function(e,t){var n=[];return e.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,(function(e,t,r){n.push({x:parseFloat(t),y:parseFloat(r)})})),r.create(n,t)},r.centre=function(e){for(var t,n,s,o=r.area(e,!0),a={x:0,y:0},c=0;c<e.length;c++)s=(c+1)%e.length,t=i.cross(e[c],e[s]),n=i.mult(i.add(e[c],e[s]),t),a=i.add(a,n);return i.div(a,6*o)},r.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return i.div(t,e.length)},r.area=function(e,t){for(var n=0,r=e.length-1,i=0;i<e.length;i++)n+=(e[r].x-e[i].x)*(e[r].y+e[i].y),r=i;return t?n/2:Math.abs(n)/2},r.inertia=function(e,t){for(var n,r,s=0,o=0,a=e,c=0;c<a.length;c++)r=(c+1)%a.length,s+=(n=Math.abs(i.cross(a[r],a[c])))*(i.dot(a[r],a[r])+i.dot(a[r],a[c])+i.dot(a[c],a[c])),o+=n;return t/6*(s/o)},r.translate=function(e,t,n){n=void 0!==n?n:1;var r,i=e.length,s=t.x*n,o=t.y*n;for(r=0;r<i;r++)e[r].x+=s,e[r].y+=o;return e},r.rotate=function(e,t,n){if(0!==t){var r,i,s,o,a=Math.cos(t),c=Math.sin(t),l=n.x,u=n.y,h=e.length;for(o=0;o<h;o++)i=(r=e[o]).x-l,s=r.y-u,r.x=l+(i*a-s*c),r.y=u+(i*c+s*a);return e}},r.contains=function(e,t){for(var n,r=t.x,i=t.y,s=e.length,o=e[s-1],a=0;a<s;a++){if(n=e[a],(r-o.x)*(n.y-o.y)+(i-o.y)*(o.x-n.x)>0)return!1;o=n}return!0},r.scale=function(e,t,n,s){if(1===t&&1===n)return e;var o,a;s=s||r.centre(e);for(var c=0;c<e.length;c++)o=e[c],a=i.sub(o,s),e[c].x=s.x+a.x*t,e[c].y=s.y+a.y*n;return e},r.chamfer=function(e,t,n,r,o){t="number"==typeof t?[t]:t||[8],n=void 0!==n?n:-1,r=r||2,o=o||14;for(var a=[],c=0;c<e.length;c++){var l=e[c-1>=0?c-1:e.length-1],u=e[c],h=e[(c+1)%e.length],_=t[c<t.length?c:t.length-1];if(0!==_){var p=i.normalise({x:u.y-l.y,y:l.x-u.x}),f=i.normalise({x:h.y-u.y,y:u.x-h.x}),d=Math.sqrt(2*Math.pow(_,2)),v=i.mult(s.clone(p),_),m=i.normalise(i.mult(i.add(p,f),.5)),y=i.sub(u,i.mult(m,d)),g=n;-1===n&&(g=1.75*Math.pow(_,.32)),(g=s.clamp(g,r,o))%2==1&&(g+=1);for(var w=Math.acos(i.dot(p,f))/g,b=0;b<g;b++)a.push(i.add(i.rotate(v,w*b),y))}else a.push(u)}return a},r.clockwiseSort=function(e){var t=r.mean(e);return e.sort((function(e,n){return i.angle(t,e)-i.angle(t,n)})),e},r.isConvex=function(e){var t,n,r,i,s=0,o=e.length;if(o<3)return null;for(t=0;t<o;t++)if(r=(t+2)%o,i=(e[n=(t+1)%o].x-e[t].x)*(e[r].y-e[n].y),(i-=(e[n].y-e[t].y)*(e[r].x-e[n].x))<0?s|=1:i>0&&(s|=2),3===s)return!1;return 0!==s||null},r.hull=function(e){var t,n,r=[],s=[];for((e=e.slice(0)).sort((function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y})),n=0;n<e.length;n+=1){for(t=e[n];s.length>=2&&i.cross3(s[s.length-2],s[s.length-1],t)<=0;)s.pop();s.push(t)}for(n=e.length-1;n>=0;n-=1){for(t=e[n];r.length>=2&&i.cross3(r[r.length-2],r[r.length-1],t)<=0;)r.pop();r.push(t)}return r.pop(),s.pop(),r.concat(s)}},function(e,t,n){var r={};e.exports=r;var i=n(0);r.on=function(e,t,n){for(var r,i=t.split(" "),s=0;s<i.length;s++)r=i[s],e.events=e.events||{},e.events[r]=e.events[r]||[],e.events[r].push(n);return n},r.off=function(e,t,n){if(t){"function"==typeof t&&(n=t,t=i.keys(e.events).join(" "));for(var r=t.split(" "),s=0;s<r.length;s++){var o=e.events[r[s]],a=[];if(n&&o)for(var c=0;c<o.length;c++)o[c]!==n&&a.push(o[c]);e.events[r[s]]=a}}else e.events={}},r.trigger=function(e,t,n){var r,s,o,a,c=e.events;if(c&&i.keys(c).length>0){n||(n={}),r=t.split(" ");for(var l=0;l<r.length;l++)if(o=c[s=r[l]]){(a=i.clone(n,!1)).name=s,a.source=e;for(var u=0;u<o.length;u++)o[u].apply(e,[a])}}}},function(e,t,n){var r={};e.exports=r;var i=n(4),s=n(0),o=n(1),a=n(6);r.create=function(e){return s.extend({id:s.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},e)},r.setModified=function(e,t,n,i){if(e.isModified=t,t&&e.cache&&(e.cache.allBodies=null,e.cache.allConstraints=null,e.cache.allComposites=null),n&&e.parent&&r.setModified(e.parent,t,n,i),i)for(var s=0;s<e.composites.length;s++){var o=e.composites[s];r.setModified(o,t,n,i)}},r.add=function(e,t){var n=[].concat(t);i.trigger(e,"beforeAdd",{object:t});for(var o=0;o<n.length;o++){var a=n[o];switch(a.type){case"body":if(a.parent!==a){s.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}r.addBody(e,a);break;case"constraint":r.addConstraint(e,a);break;case"composite":r.addComposite(e,a);break;case"mouseConstraint":r.addConstraint(e,a.constraint)}}return i.trigger(e,"afterAdd",{object:t}),e},r.remove=function(e,t,n){var s=[].concat(t);i.trigger(e,"beforeRemove",{object:t});for(var o=0;o<s.length;o++){var a=s[o];switch(a.type){case"body":r.removeBody(e,a,n);break;case"constraint":r.removeConstraint(e,a,n);break;case"composite":r.removeComposite(e,a,n);break;case"mouseConstraint":r.removeConstraint(e,a.constraint)}}return i.trigger(e,"afterRemove",{object:t}),e},r.addComposite=function(e,t){return e.composites.push(t),t.parent=e,r.setModified(e,!0,!0,!1),e},r.removeComposite=function(e,t,n){var i=s.indexOf(e.composites,t);if(-1!==i&&r.removeCompositeAt(e,i),n)for(var o=0;o<e.composites.length;o++)r.removeComposite(e.composites[o],t,!0);return e},r.removeCompositeAt=function(e,t){return e.composites.splice(t,1),r.setModified(e,!0,!0,!1),e},r.addBody=function(e,t){return e.bodies.push(t),r.setModified(e,!0,!0,!1),e},r.removeBody=function(e,t,n){var i=s.indexOf(e.bodies,t);if(-1!==i&&r.removeBodyAt(e,i),n)for(var o=0;o<e.composites.length;o++)r.removeBody(e.composites[o],t,!0);return e},r.removeBodyAt=function(e,t){return e.bodies.splice(t,1),r.setModified(e,!0,!0,!1),e},r.addConstraint=function(e,t){return e.constraints.push(t),r.setModified(e,!0,!0,!1),e},r.removeConstraint=function(e,t,n){var i=s.indexOf(e.constraints,t);if(-1!==i&&r.removeConstraintAt(e,i),n)for(var o=0;o<e.composites.length;o++)r.removeConstraint(e.composites[o],t,!0);return e},r.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),r.setModified(e,!0,!0,!1),e},r.clear=function(e,t,n){if(n)for(var i=0;i<e.composites.length;i++)r.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter((function(e){return e.isStatic})):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,r.setModified(e,!0,!0,!1),e},r.allBodies=function(e){if(e.cache&&e.cache.allBodies)return e.cache.allBodies;for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(r.allBodies(e.composites[n]));return e.cache&&(e.cache.allBodies=t),t},r.allConstraints=function(e){if(e.cache&&e.cache.allConstraints)return e.cache.allConstraints;for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(r.allConstraints(e.composites[n]));return e.cache&&(e.cache.allConstraints=t),t},r.allComposites=function(e){if(e.cache&&e.cache.allComposites)return e.cache.allComposites;for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(r.allComposites(e.composites[n]));return e.cache&&(e.cache.allComposites=t),t},r.get=function(e,t,n){var i,s;switch(n){case"body":i=r.allBodies(e);break;case"constraint":i=r.allConstraints(e);break;case"composite":i=r.allComposites(e).concat(e)}return i?0===(s=i.filter((function(e){return e.id.toString()===t.toString()}))).length?null:s[0]:null},r.move=function(e,t,n){return r.remove(e,t),r.add(n,t),e},r.rebase=function(e){for(var t=r.allBodies(e).concat(r.allConstraints(e)).concat(r.allComposites(e)),n=0;n<t.length;n++)t[n].id=s.nextId();return e},r.translate=function(e,t,n){for(var i=n?r.allBodies(e):e.bodies,s=0;s<i.length;s++)a.translate(i[s],t);return e},r.rotate=function(e,t,n,i){for(var s=Math.cos(t),o=Math.sin(t),c=i?r.allBodies(e):e.bodies,l=0;l<c.length;l++){var u=c[l],h=u.position.x-n.x,_=u.position.y-n.y;a.setPosition(u,{x:n.x+(h*s-_*o),y:n.y+(h*o+_*s)}),a.rotate(u,t)}return e},r.scale=function(e,t,n,i,s){for(var o=s?r.allBodies(e):e.bodies,c=0;c<o.length;c++){var l=o[c],u=l.position.x-i.x,h=l.position.y-i.y;a.setPosition(l,{x:i.x+u*t,y:i.y+h*n}),a.scale(l,t,n)}return e},r.bounds=function(e){for(var t=r.allBodies(e),n=[],i=0;i<t.length;i+=1){var s=t[i];n.push(s.bounds.min,s.bounds.max)}return o.create(n)}},function(e,t,n){var r={};e.exports=r;var i=n(3),s=n(2),o=n(7),a=(n(16),n(0)),c=n(1),l=n(11);!function(){r._inertiaScale=4,r._nextCollidingGroupId=1,r._nextNonCollidingGroupId=-1,r._nextCategory=1,r.create=function(t){var n={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},r=a.extend(n,t);return e(r,t),r},r.nextGroup=function(e){return e?r._nextNonCollidingGroupId--:r._nextCollidingGroupId++},r.nextCategory=function(){return r._nextCategory=r._nextCategory<<1,r._nextCategory};var e=function(e,t){t=t||{},r.set(e,{bounds:e.bounds||c.create(e.vertices),positionPrev:e.positionPrev||s.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),i.rotate(e.vertices,e.angle,e.position),l.rotate(e.axes,e.angle),c.update(e.bounds,e.vertices,e.velocity),r.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),o=e.isStatic?"#555":"#ccc",u=e.isStatic&&null===e.render.fillStyle?1:0;e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||o,e.render.lineWidth=e.render.lineWidth||u,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};r.set=function(e,t,n){var i;for(i in"string"==typeof t&&(i=t,(t={})[i]=n),t)if(Object.prototype.hasOwnProperty.call(t,i))switch(n=t[i],i){case"isStatic":r.setStatic(e,n);break;case"isSleeping":o.set(e,n);break;case"mass":r.setMass(e,n);break;case"density":r.setDensity(e,n);break;case"inertia":r.setInertia(e,n);break;case"vertices":r.setVertices(e,n);break;case"position":r.setPosition(e,n);break;case"angle":r.setAngle(e,n);break;case"velocity":r.setVelocity(e,n);break;case"angularVelocity":r.setAngularVelocity(e,n);break;case"parts":r.setParts(e,n);break;case"centre":r.setCentre(e,n);break;default:e[i]=n}},r.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var r=e.parts[n];r.isStatic=t,t?(r._original={restitution:r.restitution,friction:r.friction,mass:r.mass,inertia:r.inertia,density:r.density,inverseMass:r.inverseMass,inverseInertia:r.inverseInertia},r.restitution=0,r.friction=1,r.mass=r.inertia=r.density=1/0,r.inverseMass=r.inverseInertia=0,r.positionPrev.x=r.position.x,r.positionPrev.y=r.position.y,r.anglePrev=r.angle,r.angularVelocity=0,r.speed=0,r.angularSpeed=0,r.motion=0):r._original&&(r.restitution=r._original.restitution,r.friction=r._original.friction,r.mass=r._original.mass,r.inertia=r._original.inertia,r.density=r._original.density,r.inverseMass=r._original.inverseMass,r.inverseInertia=r._original.inverseInertia,r._original=null)}},r.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},r.setDensity=function(e,t){r.setMass(e,t*e.area),e.density=t},r.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},r.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=i.create(t,e),e.axes=l.fromVertices(e.vertices),e.area=i.area(e.vertices),r.setMass(e,e.density*e.area);var n=i.centre(e.vertices);i.translate(e.vertices,n,-1),r.setInertia(e,r._inertiaScale*i.inertia(e.vertices,e.mass)),i.translate(e.vertices,e.position),c.update(e.bounds,e.vertices,e.velocity)},r.setParts=function(e,t,n){var s;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,s=0;s<t.length;s++){var o=t[s];o!==e&&(o.parent=e,e.parts.push(o))}if(1!==e.parts.length){if(n=void 0===n||n){var a=[];for(s=0;s<t.length;s++)a=a.concat(t[s].vertices);i.clockwiseSort(a);var c=i.hull(a),l=i.centre(c);r.setVertices(e,c),i.translate(e.vertices,l)}var u=r._totalProperties(e);e.area=u.area,e.parent=e,e.position.x=u.centre.x,e.position.y=u.centre.y,e.positionPrev.x=u.centre.x,e.positionPrev.y=u.centre.y,r.setMass(e,u.mass),r.setInertia(e,u.inertia),r.setPosition(e,u.centre)}},r.setCentre=function(e,t,n){n?(e.positionPrev.x+=t.x,e.positionPrev.y+=t.y,e.position.x+=t.x,e.position.y+=t.y):(e.positionPrev.x=t.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=t.y-(e.position.y-e.positionPrev.y),e.position.x=t.x,e.position.y=t.y)},r.setPosition=function(e,t){var n=s.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var r=0;r<e.parts.length;r++){var o=e.parts[r];o.position.x+=n.x,o.position.y+=n.y,i.translate(o.vertices,n),c.update(o.bounds,o.vertices,e.velocity)}},r.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var r=0;r<e.parts.length;r++){var o=e.parts[r];o.angle+=n,i.rotate(o.vertices,n,e.position),l.rotate(o.axes,n),c.update(o.bounds,o.vertices,e.velocity),r>0&&s.rotateAbout(o.position,n,e.position,o.position)}},r.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=s.magnitude(e.velocity)},r.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},r.translate=function(e,t){r.setPosition(e,s.add(e.position,t))},r.rotate=function(e,t,n){if(n){var i=Math.cos(t),s=Math.sin(t),o=e.position.x-n.x,a=e.position.y-n.y;r.setPosition(e,{x:n.x+(o*i-a*s),y:n.y+(o*s+a*i)}),r.setAngle(e,e.angle+t)}else r.setAngle(e,e.angle+t)},r.scale=function(e,t,n,s){var o=0,a=0;s=s||e.position;for(var u=0;u<e.parts.length;u++){var h=e.parts[u];i.scale(h.vertices,t,n,s),h.axes=l.fromVertices(h.vertices),h.area=i.area(h.vertices),r.setMass(h,e.density*h.area),i.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),r.setInertia(h,r._inertiaScale*i.inertia(h.vertices,h.mass)),i.translate(h.vertices,{x:h.position.x,y:h.position.y}),u>0&&(o+=h.area,a+=h.inertia),h.position.x=s.x+(h.position.x-s.x)*t,h.position.y=s.y+(h.position.y-s.y)*n,c.update(h.bounds,h.vertices,e.velocity)}e.parts.length>1&&(e.area=o,e.isStatic||(r.setMass(e,e.density*o),r.setInertia(e,a))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},r.update=function(e,t,n,r){var o=Math.pow(t*n*e.timeScale,2),a=1-e.frictionAir*n*e.timeScale,u=e.position.x-e.positionPrev.x,h=e.position.y-e.positionPrev.y;e.velocity.x=u*a*r+e.force.x/e.mass*o,e.velocity.y=h*a*r+e.force.y/e.mass*o,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*a*r+e.torque/e.inertia*o,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=s.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var _=0;_<e.parts.length;_++){var p=e.parts[_];i.translate(p.vertices,e.velocity),_>0&&(p.position.x+=e.velocity.x,p.position.y+=e.velocity.y),0!==e.angularVelocity&&(i.rotate(p.vertices,e.angularVelocity,e.position),l.rotate(p.axes,e.angularVelocity),_>0&&s.rotateAbout(p.position,e.angularVelocity,e.position,p.position)),c.update(p.bounds,p.vertices,e.velocity)}},r.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var r=t.x-e.position.x,i=t.y-e.position.y;e.torque+=r*n.y-i*n.x},r._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var r=e.parts[n],i=r.mass!==1/0?r.mass:1;t.mass+=i,t.area+=r.area,t.inertia+=r.inertia,t.centre=s.add(t.centre,s.mult(r.position,i))}return t.centre=s.div(t.centre,t.mass),t}}()},function(e,t,n){var r={};e.exports=r;var i=n(4);r._motionWakeThreshold=.18,r._motionSleepThreshold=.08,r._minBias=.9,r.update=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var s=e[i],o=s.speed*s.speed+s.angularSpeed*s.angularSpeed;if(0===s.force.x&&0===s.force.y){var a=Math.min(s.motion,o),c=Math.max(s.motion,o);s.motion=r._minBias*a+(1-r._minBias)*c,s.sleepThreshold>0&&s.motion<r._motionSleepThreshold*n?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold&&r.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}else r.set(s,!1)}},r.afterCollisions=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var s=e[i];if(s.isActive){var o=s.collision,a=o.bodyA.parent,c=o.bodyB.parent;if(!(a.isSleeping&&c.isSleeping||a.isStatic||c.isStatic)&&(a.isSleeping||c.isSleeping)){var l=a.isSleeping&&!a.isStatic?a:c,u=l===a?c:a;!l.isStatic&&u.motion>r._motionWakeThreshold*n&&r.set(l,!1)}}}},r.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||i.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&i.trigger(e,"sleepEnd"))}},function(e,t,n){var r={};e.exports=r;var i,s,o,a=n(3),c=n(9);i=[],s={overlap:0,axis:null},o={overlap:0,axis:null},r.create=function(e,t){return{pair:null,collided:!1,bodyA:e,bodyB:t,parentA:e.parent,parentB:t.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},r.collides=function(e,t,n){if(r._overlapAxes(s,e.vertices,t.vertices,e.axes),s.overlap<=0)return null;if(r._overlapAxes(o,t.vertices,e.vertices,t.axes),o.overlap<=0)return null;var i,l,u=n&&n.table[c.id(e,t)];u?i=u.collision:((i=r.create(e,t)).collided=!0,i.bodyA=e.id<t.id?e:t,i.bodyB=e.id<t.id?t:e,i.parentA=i.bodyA.parent,i.parentB=i.bodyB.parent),e=i.bodyA,t=i.bodyB,l=s.overlap<o.overlap?s:o;var h=i.normal,_=i.supports,p=l.axis,f=p.x,d=p.y;f*(t.position.x-e.position.x)+d*(t.position.y-e.position.y)<0?(h.x=f,h.y=d):(h.x=-f,h.y=-d),i.tangent.x=-h.y,i.tangent.y=h.x,i.depth=l.overlap,i.penetration.x=h.x*i.depth,i.penetration.y=h.y*i.depth;var v=r._findSupports(e,t,h,1),m=0;if(a.contains(e.vertices,v[0])&&(_[m++]=v[0]),a.contains(e.vertices,v[1])&&(_[m++]=v[1]),m<2){var y=r._findSupports(t,e,h,-1);a.contains(t.vertices,y[0])&&(_[m++]=y[0]),m<2&&a.contains(t.vertices,y[1])&&(_[m++]=y[1])}return 0===m&&(_[m++]=v[0]),_.length=m,i},r._overlapAxes=function(e,t,n,r){var i,s,o,a,c,l,u=t.length,h=n.length,_=t[0].x,p=t[0].y,f=n[0].x,d=n[0].y,v=r.length,m=Number.MAX_VALUE,y=0;for(c=0;c<v;c++){var g=r[c],w=g.x,b=g.y,x=_*w+p*b,S=f*w+d*b,T=x,C=S;for(l=1;l<u;l+=1)(a=t[l].x*w+t[l].y*b)>T?T=a:a<x&&(x=a);for(l=1;l<h;l+=1)(a=n[l].x*w+n[l].y*b)>C?C=a:a<S&&(S=a);if((i=(s=T-S)<(o=C-x)?s:o)<m&&(m=i,y=c,i<=0))break}e.axis=r[y],e.overlap=m},r._projectToAxis=function(e,t,n){for(var r=t[0].x*n.x+t[0].y*n.y,i=r,s=1;s<t.length;s+=1){var o=t[s].x*n.x+t[s].y*n.y;o>i?i=o:o<r&&(r=o)}e.min=r,e.max=i},r._findSupports=function(e,t,n,r){var s,o,a,c,l,u=t.vertices,h=u.length,_=e.position.x,p=e.position.y,f=n.x*r,d=n.y*r,v=Number.MAX_VALUE;for(l=0;l<h;l+=1)(c=f*(_-(o=u[l]).x)+d*(p-o.y))<v&&(v=c,s=o);return v=f*(_-(a=u[(h+s.index-1)%h]).x)+d*(p-a.y),f*(_-(o=u[(s.index+1)%h]).x)+d*(p-o.y)<v?(i[0]=s,i[1]=o,i):(i[0]=s,i[1]=a,i)}},function(e,t,n){var r={};e.exports=r;var i=n(17);r.create=function(e,t){var n=e.bodyA,i=e.bodyB,s={id:r.id(n,i),bodyA:n,bodyB:i,collision:e,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:n.isSensor||i.isSensor,timeCreated:t,timeUpdated:t,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return r.update(s,e,t),s},r.update=function(e,t,n){var r=e.contacts,s=t.supports,o=e.activeContacts,a=t.parentA,c=t.parentB,l=a.vertices.length;e.isActive=!0,e.timeUpdated=n,e.collision=t,e.separation=t.depth,e.inverseMass=a.inverseMass+c.inverseMass,e.friction=a.friction<c.friction?a.friction:c.friction,e.frictionStatic=a.frictionStatic>c.frictionStatic?a.frictionStatic:c.frictionStatic,e.restitution=a.restitution>c.restitution?a.restitution:c.restitution,e.slop=a.slop>c.slop?a.slop:c.slop,t.pair=e,o.length=0;for(var u=0;u<s.length;u++){var h=s[u],_=h.body===a?h.index:l+h.index,p=r[_];p?o.push(p):o.push(r[_]=i.create(h))}},r.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},r.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}},function(e,t,n){var r={};e.exports=r;var i=n(3),s=n(2),o=n(7),a=n(1),c=n(11),l=n(0);r._warming=.4,r._torqueDampen=1,r._minLength=1e-6,r.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?s.add(t.bodyA.position,t.pointA):t.pointA,r=t.bodyB?s.add(t.bodyB.position,t.pointB):t.pointB,i=s.magnitude(s.sub(n,r));t.length=void 0!==t.length?t.length:i,t.id=t.id||l.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var o={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(o.type="pin",o.anchors=!1):t.stiffness<.9&&(o.type="spring"),t.render=l.extend(o,t.render),t},r.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],r=n.constraintImpulse;n.isStatic||0===r.x&&0===r.y&&0===r.angle||(n.position.x+=r.x,n.position.y+=r.y,n.angle+=r.angle)}},r.solveAll=function(e,t){for(var n=0;n<e.length;n+=1){var i=e[n],s=!i.bodyA||i.bodyA&&i.bodyA.isStatic,o=!i.bodyB||i.bodyB&&i.bodyB.isStatic;(s||o)&&r.solve(e[n],t)}for(n=0;n<e.length;n+=1)s=!(i=e[n]).bodyA||i.bodyA&&i.bodyA.isStatic,o=!i.bodyB||i.bodyB&&i.bodyB.isStatic,s||o||r.solve(e[n],t)},r.solve=function(e,t){var n=e.bodyA,i=e.bodyB,o=e.pointA,a=e.pointB;if(n||i){n&&!n.isStatic&&(s.rotate(o,n.angle-e.angleA,o),e.angleA=n.angle),i&&!i.isStatic&&(s.rotate(a,i.angle-e.angleB,a),e.angleB=i.angle);var c=o,l=a;if(n&&(c=s.add(n.position,o)),i&&(l=s.add(i.position,a)),c&&l){var u=s.sub(c,l),h=s.magnitude(u);h<r._minLength&&(h=r._minLength);var _,p,f,d,v,m=(h-e.length)/h,y=e.stiffness<1?e.stiffness*t:e.stiffness,g=s.mult(u,m*y),w=(n?n.inverseMass:0)+(i?i.inverseMass:0),b=w+((n?n.inverseInertia:0)+(i?i.inverseInertia:0));if(e.damping){var x=s.create();f=s.div(u,h),v=s.sub(i&&s.sub(i.position,i.positionPrev)||x,n&&s.sub(n.position,n.positionPrev)||x),d=s.dot(f,v)}n&&!n.isStatic&&(p=n.inverseMass/w,n.constraintImpulse.x-=g.x*p,n.constraintImpulse.y-=g.y*p,n.position.x-=g.x*p,n.position.y-=g.y*p,e.damping&&(n.positionPrev.x-=e.damping*f.x*d*p,n.positionPrev.y-=e.damping*f.y*d*p),_=s.cross(o,g)/b*r._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=_,n.angle-=_),i&&!i.isStatic&&(p=i.inverseMass/w,i.constraintImpulse.x+=g.x*p,i.constraintImpulse.y+=g.y*p,i.position.x+=g.x*p,i.position.y+=g.y*p,e.damping&&(i.positionPrev.x+=e.damping*f.x*d*p,i.positionPrev.y+=e.damping*f.y*d*p),_=s.cross(a,g)/b*r._torqueDampen*i.inverseInertia*(1-e.angularStiffness),i.constraintImpulse.angle+=_,i.angle+=_)}}},r.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],l=n.constraintImpulse;if(!(n.isStatic||0===l.x&&0===l.y&&0===l.angle)){o.set(n,!1);for(var u=0;u<n.parts.length;u++){var h=n.parts[u];i.translate(h.vertices,l),u>0&&(h.position.x+=l.x,h.position.y+=l.y),0!==l.angle&&(i.rotate(h.vertices,l.angle,n.position),c.rotate(h.axes,l.angle),u>0&&s.rotateAbout(h.position,l.angle,n.position,h.position)),a.update(h.bounds,h.vertices,n.velocity)}l.angle*=r._warming,l.x*=r._warming,l.y*=r._warming}}},r.pointAWorld=function(e){return{x:(e.bodyA?e.bodyA.position.x:0)+e.pointA.x,y:(e.bodyA?e.bodyA.position.y:0)+e.pointA.y}},r.pointBWorld=function(e){return{x:(e.bodyB?e.bodyB.position.x:0)+e.pointB.x,y:(e.bodyB?e.bodyB.position.y:0)+e.pointB.y}}},function(e,t,n){var r={};e.exports=r;var i=n(2),s=n(0);r.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var r=(n+1)%e.length,o=i.normalise({x:e[r].y-e[n].y,y:e[n].x-e[r].x}),a=0===o.y?1/0:o.x/o.y;t[a=a.toFixed(3).toString()]=o}return s.values(t)},r.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),r=Math.sin(t),i=0;i<e.length;i++){var s,o=e[i];s=o.x*n-o.y*r,o.y=o.x*r+o.y*n,o.x=s}}},function(e,t,n){var r={};e.exports=r;var i=n(3),s=n(0),o=n(6),a=n(1),c=n(2);r.rectangle=function(e,t,n,r,a){a=a||{};var c={label:"Rectangle Body",position:{x:e,y:t},vertices:i.fromPath("L 0 0 L "+n+" 0 L "+n+" "+r+" L 0 "+r)};if(a.chamfer){var l=a.chamfer;c.vertices=i.chamfer(c.vertices,l.radius,l.quality,l.qualityMin,l.qualityMax),delete a.chamfer}return o.create(s.extend({},c,a))},r.trapezoid=function(e,t,n,r,a,c){c=c||{};var l,u=n*(a*=.5),h=u+(1-2*a)*n,_=h+u;l=a<.5?"L 0 0 L "+u+" "+-r+" L "+h+" "+-r+" L "+_+" 0":"L 0 0 L "+h+" "+-r+" L "+_+" 0";var p={label:"Trapezoid Body",position:{x:e,y:t},vertices:i.fromPath(l)};if(c.chamfer){var f=c.chamfer;p.vertices=i.chamfer(p.vertices,f.radius,f.quality,f.qualityMin,f.qualityMax),delete c.chamfer}return o.create(s.extend({},p,c))},r.circle=function(e,t,n,i,o){i=i||{};var a={label:"Circle Body",circleRadius:n};o=o||25;var c=Math.ceil(Math.max(10,Math.min(o,n)));return c%2==1&&(c+=1),r.polygon(e,t,c,n,s.extend({},a,i))},r.polygon=function(e,t,n,a,c){if(c=c||{},n<3)return r.circle(e,t,a,c);for(var l=2*Math.PI/n,u="",h=.5*l,_=0;_<n;_+=1){var p=h+_*l,f=Math.cos(p)*a,d=Math.sin(p)*a;u+="L "+f.toFixed(3)+" "+d.toFixed(3)+" "}var v={label:"Polygon Body",position:{x:e,y:t},vertices:i.fromPath(u)};if(c.chamfer){var m=c.chamfer;v.vertices=i.chamfer(v.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete c.chamfer}return o.create(s.extend({},v,c))},r.fromVertices=function(e,t,n,r,l,u,h,_){var p,f,d,v,m,y,g,w,b,x,S=s.getDecomp();for(p=Boolean(S&&S.quickDecomp),r=r||{},d=[],l=void 0!==l&&l,u=void 0!==u?u:.01,h=void 0!==h?h:10,_=void 0!==_?_:.01,s.isArray(n[0])||(n=[n]),b=0;b<n.length;b+=1)if(m=n[b],!(v=i.isConvex(m))&&!p&&s.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),v||!p)m=v?i.clockwiseSort(m):i.hull(m),d.push({position:{x:e,y:t},vertices:m});else{var T=m.map((function(e){return[e.x,e.y]}));S.makeCCW(T),!1!==u&&S.removeCollinearPoints(T,u),!1!==_&&S.removeDuplicatePoints&&S.removeDuplicatePoints(T,_);var C=S.quickDecomp(T);for(y=0;y<C.length;y++){var k=C[y].map((function(e){return{x:e[0],y:e[1]}}));h>0&&i.area(k)<h||d.push({position:i.centre(k),vertices:k})}}for(y=0;y<d.length;y++)d[y]=o.create(s.extend(d[y],r));if(l)for(y=0;y<d.length;y++){var E=d[y];for(g=y+1;g<d.length;g++){var I=d[g];if(a.overlaps(E.bounds,I.bounds)){var A=E.vertices,P=I.vertices;for(w=0;w<E.vertices.length;w++)for(x=0;x<I.vertices.length;x++){var O=c.magnitudeSquared(c.sub(A[(w+1)%A.length],P[x])),R=c.magnitudeSquared(c.sub(A[w],P[(x+1)%P.length]));O<5&&R<5&&(A[w].isInternal=!0,P[x].isInternal=!0)}}}}return d.length>1?(f=o.create(s.extend({parts:d.slice(0)},r)),o.setPosition(f,{x:e,y:t}),f):d[0]}},function(e,t,n){var r={};e.exports=r;var i=n(0);r.create=function(e){var t={};return e||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=parseInt(t.element.getAttribute("data-pixel-ratio"),10)||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},r.setElement(t,t.element),t},r.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},r.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},r.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},r.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},r._getRelativeMousePosition=function(e,t,n){var r,i,s=t.getBoundingClientRect(),o=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:o.scrollLeft,c=void 0!==window.pageYOffset?window.pageYOffset:o.scrollTop,l=e.changedTouches;return l?(r=l[0].pageX-s.left-a,i=l[0].pageY-s.top-c):(r=e.pageX-s.left-a,i=e.pageY-s.top-c),{x:r/(t.clientWidth/(t.width||t.clientWidth)*n),y:i/(t.clientHeight/(t.height||t.clientHeight)*n)}}},function(e,t,n){var r={};e.exports=r;var i=n(0),s=n(8);r.create=function(e){return i.extend({bodies:[],pairs:null},e)},r.setBodies=function(e,t){e.bodies=t.slice(0)},r.clear=function(e){e.bodies=[]},r.collisions=function(e){var t,n,i=[],o=e.pairs,a=e.bodies,c=a.length,l=r.canCollide,u=s.collides;for(a.sort(r._compareBoundsX),t=0;t<c;t++){var h=a[t],_=h.bounds,p=h.bounds.max.x,f=h.bounds.max.y,d=h.bounds.min.y,v=h.isStatic||h.isSleeping,m=h.parts.length,y=1===m;for(n=t+1;n<c;n++){var g=a[n];if((E=g.bounds).min.x>p)break;if(!(f<E.min.y||d>E.max.y)&&(!v||!g.isStatic&&!g.isSleeping)&&l(h.collisionFilter,g.collisionFilter)){var w=g.parts.length;if(y&&1===w)(C=u(h,g,o))&&i.push(C);else for(var b=w>1?1:0,x=m>1?1:0;x<m;x++)for(var S=h.parts[x],T=(_=S.bounds,b);T<w;T++){var C,k=g.parts[T],E=k.bounds;_.min.x>E.max.x||_.max.x<E.min.x||_.max.y<E.min.y||_.min.y>E.max.y||(C=u(S,k,o))&&i.push(C)}}}}return i},r.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!=(e.mask&t.category)&&0!=(t.mask&e.category)},r._compareBoundsX=function(e,t){return e.bounds.min.x-t.bounds.min.x}},function(e,t,n){var r={};e.exports=r;var i=n(0);r._registry={},r.register=function(e){if(r.isPlugin(e)||i.warn("Plugin.register:",r.toString(e),"does not implement all required fields."),e.name in r._registry){var t=r._registry[e.name],n=r.versionParse(e.version).number,s=r.versionParse(t.version).number;n>s?(i.warn("Plugin.register:",r.toString(t),"was upgraded to",r.toString(e)),r._registry[e.name]=e):n<s?i.warn("Plugin.register:",r.toString(t),"can not be downgraded to",r.toString(e)):e!==t&&i.warn("Plugin.register:",r.toString(e),"is already registered to different plugin object")}else r._registry[e.name]=e;return e},r.resolve=function(e){return r._registry[r.dependencyParse(e).name]},r.toString=function(e){return"string"==typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},r.isPlugin=function(e){return e&&e.name&&e.version&&e.install},r.isUsed=function(e,t){return e.used.indexOf(t)>-1},r.isFor=function(e,t){var n=e.for&&r.dependencyParse(e.for);return!e.for||t.name===n.name&&r.versionSatisfies(t.version,n.range)},r.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=r.dependencies(e),s=i.topologicalSort(n),o=[],a=0;a<s.length;a+=1)if(s[a]!==e.name){var c=r.resolve(s[a]);c?r.isUsed(e,c.name)||(r.isFor(c,e)||(i.warn("Plugin.use:",r.toString(c),"is for",c.for,"but installed on",r.toString(e)+"."),c._warned=!0),c.install?c.install(e):(i.warn("Plugin.use:",r.toString(c),"does not specify an install function."),c._warned=!0),c._warned?(o.push("🔶 "+r.toString(c)),delete c._warned):o.push("✅ "+r.toString(c)),e.used.push(c.name)):o.push("❌ "+s[a])}o.length>0&&i.info(o.join("  "))}else i.warn("Plugin.use:",r.toString(e),"does not specify any dependencies to install.")},r.dependencies=function(e,t){var n=r.dependencyParse(e),s=n.name;if(!(s in(t=t||{}))){e=r.resolve(e)||e,t[s]=i.map(e.uses||[],(function(t){r.isPlugin(t)&&r.register(t);var s=r.dependencyParse(t),o=r.resolve(t);return o&&!r.versionSatisfies(o.version,s.range)?(i.warn("Plugin.dependencies:",r.toString(o),"does not satisfy",r.toString(s),"used by",r.toString(n)+"."),o._warned=!0,e._warned=!0):o||(i.warn("Plugin.dependencies:",r.toString(t),"used by",r.toString(n),"could not be resolved."),e._warned=!0),s.name}));for(var o=0;o<t[s].length;o+=1)r.dependencies(t[s][o],t);return t}},r.dependencyParse=function(e){return i.isString(e)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(e)||i.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}):{name:e.name,range:e.range||e.version}},r.versionParse=function(e){var t=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;t.test(e)||i.warn("Plugin.versionParse:",e,"is not a valid version or range.");var n=t.exec(e),r=Number(n[4]),s=Number(n[5]),o=Number(n[6]);return{isRange:Boolean(n[1]||n[2]),version:n[3],range:e,operator:n[1]||n[2]||"",major:r,minor:s,patch:o,parts:[r,s,o],prerelease:n[7],number:1e8*r+1e4*s+o}},r.versionSatisfies=function(e,t){t=t||"*";var n=r.versionParse(t),i=r.versionParse(e);if(n.isRange){if("*"===n.operator||"*"===e)return!0;if(">"===n.operator)return i.number>n.number;if(">="===n.operator)return i.number>=n.number;if("~"===n.operator)return i.major===n.major&&i.minor===n.minor&&i.patch>=n.patch;if("^"===n.operator)return n.major>0?i.major===n.major&&i.number>=n.number:n.minor>0?i.minor===n.minor&&i.patch>=n.patch:i.patch===n.patch}return e===t||"*"===e}},function(e,t,n){var r={};e.exports=r;var i=n(0),s=n(5),o=n(1),a=n(4),c=n(2),l=n(13);!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(i.now())}),1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),r._goodFps=30,r._goodDelta=1e3/60,r.create=function(e){var t={controller:r,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},n=i.extend(t,e);return n.canvas&&(n.canvas.width=n.options.width||n.canvas.width,n.canvas.height=n.options.height||n.canvas.height),n.mouse=e.mouse,n.engine=e.engine,n.canvas=n.canvas||h(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.canvas.width,y:n.canvas.height}},n.options.showBroadphase=!1,1!==n.options.pixelRatio&&r.setPixelRatio(n,n.options.pixelRatio),i.isElement(n.element)?n.element.appendChild(n.canvas):n.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),n},r.run=function(t){!function i(s){t.frameRequestId=e(i),n(t,s),r.world(t,s),(t.options.showStats||t.options.showDebug)&&r.stats(t,t.context,s),(t.options.showPerformance||t.options.showDebug)&&r.performance(t,t.context,s)}()},r.stop=function(e){t(e.frameRequestId)},r.setPixelRatio=function(e,t){var n=e.options,r=e.canvas;"auto"===t&&(t=_(r)),n.pixelRatio=t,r.setAttribute("data-pixel-ratio",t),r.width=n.width*t,r.height=n.height*t,r.style.width=n.width+"px",r.style.height=n.height+"px"},r.lookAt=function(e,t,n,r){r=void 0===r||r,t=i.isArray(t)?t:[t],n=n||{x:0,y:0};for(var s={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},o=0;o<t.length;o+=1){var a=t[o],c=a.bounds?a.bounds.min:a.min||a.position||a,u=a.bounds?a.bounds.max:a.max||a.position||a;c&&u&&(c.x<s.min.x&&(s.min.x=c.x),u.x>s.max.x&&(s.max.x=u.x),c.y<s.min.y&&(s.min.y=c.y),u.y>s.max.y&&(s.max.y=u.y))}var h=s.max.x-s.min.x+2*n.x,_=s.max.y-s.min.y+2*n.y,p=e.canvas.height,f=e.canvas.width/p,d=h/_,v=1,m=1;d>f?m=d/f:v=f/d,e.options.hasBounds=!0,e.bounds.min.x=s.min.x,e.bounds.max.x=s.min.x+h*v,e.bounds.min.y=s.min.y,e.bounds.max.y=s.min.y+_*m,r&&(e.bounds.min.x+=.5*h-h*v*.5,e.bounds.max.x+=.5*h-h*v*.5,e.bounds.min.y+=.5*_-_*m*.5,e.bounds.max.y+=.5*_-_*m*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(l.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),l.setOffset(e.mouse,e.bounds.min))},r.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,r=t/e.options.width,i=n/e.options.height;e.context.setTransform(e.options.pixelRatio/r,0,0,e.options.pixelRatio/i,0,0),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},r.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},r.world=function(e,t){var n,u=i.now(),h=e.engine,_=h.world,p=e.canvas,d=e.context,v=e.options,m=e.timing,y=s.allBodies(_),g=s.allConstraints(_),w=v.wireframes?v.wireframeBackground:v.background,b=[],x=[],S={timestamp:h.timing.timestamp};if(a.trigger(e,"beforeRender",S),e.currentBackground!==w&&f(e,w),d.globalCompositeOperation="source-in",d.fillStyle="transparent",d.fillRect(0,0,p.width,p.height),d.globalCompositeOperation="source-over",v.hasBounds){for(n=0;n<y.length;n++){var T=y[n];o.overlaps(T.bounds,e.bounds)&&b.push(T)}for(n=0;n<g.length;n++){var C=g[n],k=C.bodyA,E=C.bodyB,I=C.pointA,A=C.pointB;k&&(I=c.add(k.position,C.pointA)),E&&(A=c.add(E.position,C.pointB)),I&&A&&(o.contains(e.bounds,I)||o.contains(e.bounds,A))&&x.push(C)}r.startViewTransform(e),e.mouse&&(l.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.options.width,y:(e.bounds.max.y-e.bounds.min.y)/e.options.height}),l.setOffset(e.mouse,e.bounds.min))}else x=g,b=y,1!==e.options.pixelRatio&&e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0);!v.wireframes||h.enableSleeping&&v.showSleeping?r.bodies(e,b,d):(v.showConvexHulls&&r.bodyConvexHulls(e,b,d),r.bodyWireframes(e,b,d)),v.showBounds&&r.bodyBounds(e,b,d),(v.showAxes||v.showAngleIndicator)&&r.bodyAxes(e,b,d),v.showPositions&&r.bodyPositions(e,b,d),v.showVelocity&&r.bodyVelocity(e,b,d),v.showIds&&r.bodyIds(e,b,d),v.showSeparations&&r.separations(e,h.pairs.list,d),v.showCollisions&&r.collisions(e,h.pairs.list,d),v.showVertexNumbers&&r.vertexNumbers(e,b,d),v.showMousePosition&&r.mousePosition(e,e.mouse,d),r.constraints(x,d),v.hasBounds&&r.endViewTransform(e),a.trigger(e,"afterRender",S),m.lastElapsed=i.now()-u},r.stats=function(e,t,n){for(var r=e.engine,i=r.world,o=s.allBodies(i),a=0,c=0,l=0;l<o.length;l+=1)a+=o[l].parts.length;var u={Part:a,Body:o.length,Cons:s.allConstraints(i).length,Comp:s.allComposites(i).length,Pair:r.pairs.list.length};for(var h in t.fillStyle="#0e0f19",t.fillRect(c,0,302.5,44),t.font="12px Arial",t.textBaseline="top",t.textAlign="right",u){var _=u[h];t.fillStyle="#aaa",t.fillText(h,c+55,8),t.fillStyle="#eee",t.fillText(_,c+55,26),c+=55}},r.performance=function(e,t){var n=e.engine,i=e.timing,s=i.deltaHistory,o=i.elapsedHistory,a=i.timestampElapsedHistory,c=i.engineDeltaHistory,l=i.engineElapsedHistory,h=n.timing.lastDelta,_=u(s),p=u(o),f=u(c),d=u(l),v=u(a)/_||0,m=1e3/_||0;t.fillStyle="#0e0f19",t.fillRect(0,50,370,34),r.status(t,10,69,60,4,s.length,Math.round(m)+" fps",m/r._goodFps,(function(e){return s[e]/_-1})),r.status(t,82,69,60,4,c.length,h.toFixed(2)+" dt",r._goodDelta/h,(function(e){return c[e]/f-1})),r.status(t,154,69,60,4,l.length,d.toFixed(2)+" ut",1-d/r._goodFps,(function(e){return l[e]/d-1})),r.status(t,226,69,60,4,o.length,p.toFixed(2)+" rt",1-p/r._goodFps,(function(e){return o[e]/p-1})),r.status(t,298,69,60,4,a.length,v.toFixed(2)+" x",v*v*v,(function(e){return(a[e]/s[e]/v||0)-1}))},r.status=function(e,t,n,r,s,o,a,c,l){e.strokeStyle="#888",e.fillStyle="#444",e.lineWidth=1,e.fillRect(t,n+7,r,1),e.beginPath(),e.moveTo(t,n+7-s*i.clamp(.4*l(0),-2,2));for(var u=0;u<r;u+=1)e.lineTo(t+u,n+7-(u<o?s*i.clamp(.4*l(u),-2,2):0));e.stroke(),e.fillStyle="hsl("+i.clamp(25+95*c,0,120)+",100%,60%)",e.fillRect(t,n-7,4,4),e.font="12px Arial",e.textBaseline="middle",e.textAlign="right",e.fillStyle="#eee",e.fillText(a,t+r,n-5)},r.constraints=function(e,t){for(var n=t,r=0;r<e.length;r++){var s=e[r];if(s.render.visible&&s.pointA&&s.pointB){var o,a,l=s.bodyA,u=s.bodyB;if(o=l?c.add(l.position,s.pointA):s.pointA,"pin"===s.render.type)n.beginPath(),n.arc(o.x,o.y,3,0,2*Math.PI),n.closePath();else{if(a=u?c.add(u.position,s.pointB):s.pointB,n.beginPath(),n.moveTo(o.x,o.y),"spring"===s.render.type)for(var h,_=c.sub(a,o),p=c.perp(c.normalise(_)),f=Math.ceil(i.clamp(s.length/5,12,20)),d=1;d<f;d+=1)h=d%2==0?1:-1,n.lineTo(o.x+_.x*(d/f)+p.x*h*4,o.y+_.y*(d/f)+p.y*h*4);n.lineTo(a.x,a.y)}s.render.lineWidth&&(n.lineWidth=s.render.lineWidth,n.strokeStyle=s.render.strokeStyle,n.stroke()),s.render.anchors&&(n.fillStyle=s.render.strokeStyle,n.beginPath(),n.arc(o.x,o.y,3,0,2*Math.PI),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},r.bodies=function(e,t,n){var r,i,s,o,a=n,c=(e.engine,e.options),l=c.showInternalEdges||!c.wireframes;for(s=0;s<t.length;s++)if((r=t[s]).render.visible)for(o=r.parts.length>1?1:0;o<r.parts.length;o++)if((i=r.parts[o]).render.visible){if(c.showSleeping&&r.isSleeping?a.globalAlpha=.5*i.render.opacity:1!==i.render.opacity&&(a.globalAlpha=i.render.opacity),i.render.sprite&&i.render.sprite.texture&&!c.wireframes){var u=i.render.sprite,h=p(e,u.texture);a.translate(i.position.x,i.position.y),a.rotate(i.angle),a.drawImage(h,h.width*-u.xOffset*u.xScale,h.height*-u.yOffset*u.yScale,h.width*u.xScale,h.height*u.yScale),a.rotate(-i.angle),a.translate(-i.position.x,-i.position.y)}else{if(i.circleRadius)a.beginPath(),a.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(i.vertices[0].x,i.vertices[0].y);for(var _=1;_<i.vertices.length;_++)!i.vertices[_-1].isInternal||l?a.lineTo(i.vertices[_].x,i.vertices[_].y):a.moveTo(i.vertices[_].x,i.vertices[_].y),i.vertices[_].isInternal&&!l&&a.moveTo(i.vertices[(_+1)%i.vertices.length].x,i.vertices[(_+1)%i.vertices.length].y);a.lineTo(i.vertices[0].x,i.vertices[0].y),a.closePath()}c.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=i.render.fillStyle,i.render.lineWidth&&(a.lineWidth=i.render.lineWidth,a.strokeStyle=i.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},r.bodyWireframes=function(e,t,n){var r,i,s,o,a,c=n,l=e.options.showInternalEdges;for(c.beginPath(),s=0;s<t.length;s++)if((r=t[s]).render.visible)for(a=r.parts.length>1?1:0;a<r.parts.length;a++){for(i=r.parts[a],c.moveTo(i.vertices[0].x,i.vertices[0].y),o=1;o<i.vertices.length;o++)!i.vertices[o-1].isInternal||l?c.lineTo(i.vertices[o].x,i.vertices[o].y):c.moveTo(i.vertices[o].x,i.vertices[o].y),i.vertices[o].isInternal&&!l&&c.moveTo(i.vertices[(o+1)%i.vertices.length].x,i.vertices[(o+1)%i.vertices.length].y);c.lineTo(i.vertices[0].x,i.vertices[0].y)}c.lineWidth=1,c.strokeStyle="#bbb",c.stroke()},r.bodyConvexHulls=function(e,t,n){var r,i,s,o=n;for(o.beginPath(),i=0;i<t.length;i++)if((r=t[i]).render.visible&&1!==r.parts.length){for(o.moveTo(r.vertices[0].x,r.vertices[0].y),s=1;s<r.vertices.length;s++)o.lineTo(r.vertices[s].x,r.vertices[s].y);o.lineTo(r.vertices[0].x,r.vertices[0].y)}o.lineWidth=1,o.strokeStyle="rgba(255,255,255,0.2)",o.stroke()},r.vertexNumbers=function(e,t,n){var r,i,s,o=n;for(r=0;r<t.length;r++){var a=t[r].parts;for(s=a.length>1?1:0;s<a.length;s++){var c=a[s];for(i=0;i<c.vertices.length;i++)o.fillStyle="rgba(255,255,255,0.2)",o.fillText(r+"_"+i,c.position.x+.8*(c.vertices[i].x-c.position.x),c.position.y+.8*(c.vertices[i].y-c.position.y))}}},r.mousePosition=function(e,t,n){var r=n;r.fillStyle="rgba(255,255,255,0.8)",r.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},r.bodyBounds=function(e,t,n){var r=n,i=(e.engine,e.options);r.beginPath();for(var s=0;s<t.length;s++)if(t[s].render.visible)for(var o=t[s].parts,a=o.length>1?1:0;a<o.length;a++){var c=o[a];r.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}i.wireframes?r.strokeStyle="rgba(255,255,255,0.08)":r.strokeStyle="rgba(0,0,0,0.1)",r.lineWidth=1,r.stroke()},r.bodyAxes=function(e,t,n){var r,i,s,o,a=n,c=(e.engine,e.options);for(a.beginPath(),i=0;i<t.length;i++){var l=t[i],u=l.parts;if(l.render.visible)if(c.showAxes)for(s=u.length>1?1:0;s<u.length;s++)for(r=u[s],o=0;o<r.axes.length;o++){var h=r.axes[o];a.moveTo(r.position.x,r.position.y),a.lineTo(r.position.x+20*h.x,r.position.y+20*h.y)}else for(s=u.length>1?1:0;s<u.length;s++)for(r=u[s],o=0;o<r.axes.length;o++)a.moveTo(r.position.x,r.position.y),a.lineTo((r.vertices[0].x+r.vertices[r.vertices.length-1].x)/2,(r.vertices[0].y+r.vertices[r.vertices.length-1].y)/2)}c.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},r.bodyPositions=function(e,t,n){var r,i,s,o,a=n,c=(e.engine,e.options);for(a.beginPath(),s=0;s<t.length;s++)if((r=t[s]).render.visible)for(o=0;o<r.parts.length;o++)i=r.parts[o],a.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1),a.closePath();for(c.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),s=0;s<t.length;s++)(r=t[s]).render.visible&&(a.arc(r.positionPrev.x,r.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},r.bodyVelocity=function(e,t,n){var r=n;r.beginPath();for(var i=0;i<t.length;i++){var s=t[i];s.render.visible&&(r.moveTo(s.position.x,s.position.y),r.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}r.lineWidth=3,r.strokeStyle="cornflowerblue",r.stroke()},r.bodyIds=function(e,t,n){var r,i,s=n;for(r=0;r<t.length;r++)if(t[r].render.visible){var o=t[r].parts;for(i=o.length>1?1:0;i<o.length;i++){var a=o[i];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(a.id,a.position.x+10,a.position.y-10)}}},r.collisions=function(e,t,n){var r,i,s,o,a=n,c=e.options;for(a.beginPath(),s=0;s<t.length;s++)if((r=t[s]).isActive)for(i=r.collision,o=0;o<r.activeContacts.length;o++){var l=r.activeContacts[o].vertex;a.rect(l.x-1.5,l.y-1.5,3.5,3.5)}for(c.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),s=0;s<t.length;s++)if((r=t[s]).isActive&&(i=r.collision,r.activeContacts.length>0)){var u=r.activeContacts[0].vertex.x,h=r.activeContacts[0].vertex.y;2===r.activeContacts.length&&(u=(r.activeContacts[0].vertex.x+r.activeContacts[1].vertex.x)/2,h=(r.activeContacts[0].vertex.y+r.activeContacts[1].vertex.y)/2),i.bodyB===i.supports[0].body||!0===i.bodyA.isStatic?a.moveTo(u-8*i.normal.x,h-8*i.normal.y):a.moveTo(u+8*i.normal.x,h+8*i.normal.y),a.lineTo(u,h)}c.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},r.separations=function(e,t,n){var r,i,s,o,a,c=n,l=e.options;for(c.beginPath(),a=0;a<t.length;a++)if((r=t[a]).isActive){s=(i=r.collision).bodyA;var u=1;(o=i.bodyB).isStatic||s.isStatic||(u=.5),o.isStatic&&(u=0),c.moveTo(o.position.x,o.position.y),c.lineTo(o.position.x-i.penetration.x*u,o.position.y-i.penetration.y*u),u=1,o.isStatic||s.isStatic||(u=.5),s.isStatic&&(u=0),c.moveTo(s.position.x,s.position.y),c.lineTo(s.position.x+i.penetration.x*u,s.position.y+i.penetration.y*u)}l.wireframes?c.strokeStyle="rgba(255,165,0,0.5)":c.strokeStyle="orange",c.stroke()},r.inspector=function(e,t){e.engine;var n,r=e.selected,i=e.render,s=i.options;if(s.hasBounds){var o=i.bounds.max.x-i.bounds.min.x,a=i.bounds.max.y-i.bounds.min.y,c=o/i.options.width,l=a/i.options.height;t.scale(1/c,1/l),t.translate(-i.bounds.min.x,-i.bounds.min.y)}for(var u=0;u<r.length;u++){var h=r[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var _=h.pointA;h.bodyA&&(_=h.pointB),t.beginPath(),t.arc(_.x,_.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),s.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=e.engine,i=e.timing,s=i.historySize,o=n.timing.timestamp;i.delta=t-i.lastTime||r._goodDelta,i.lastTime=t,i.timestampElapsed=o-i.lastTimestamp||0,i.lastTimestamp=o,i.deltaHistory.unshift(i.delta),i.deltaHistory.length=Math.min(i.deltaHistory.length,s),i.engineDeltaHistory.unshift(n.timing.lastDelta),i.engineDeltaHistory.length=Math.min(i.engineDeltaHistory.length,s),i.timestampElapsedHistory.unshift(i.timestampElapsed),i.timestampElapsedHistory.length=Math.min(i.timestampElapsedHistory.length,s),i.engineElapsedHistory.unshift(n.timing.lastElapsed),i.engineElapsedHistory.length=Math.min(i.engineElapsedHistory.length,s),i.elapsedHistory.unshift(i.lastElapsed),i.elapsedHistory.length=Math.min(i.elapsedHistory.length,s)},u=function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length||0},h=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},_=function(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},p=function(e,t){var n=e.textures[t];return n||((n=e.textures[t]=new Image).src=t,n)},f=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},function(e,t){var n={};e.exports=n,n.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}},function(e,t,n){var r={};e.exports=r;var i=n(7),s=n(19),o=n(14),a=n(20),c=n(4),l=n(5),u=n(10),h=n(0),_=n(6);r.create=function(e){e=e||{};var t=h.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},e);return t.world=e.world||l.create({label:"World"}),t.pairs=e.pairs||a.create(),t.detector=e.detector||o.create(),t.grid={buckets:[]},t.world.gravity=t.gravity,t.broadphase=t.grid,t.metrics={},t},r.update=function(e,t,n){var _=h.now();t=t||1e3/60,n=n||1;var p,f=e.world,d=e.detector,v=e.pairs,m=e.timing,y=m.timestamp;m.timestamp+=t*m.timeScale,m.lastDelta=t*m.timeScale;var g={timestamp:m.timestamp};c.trigger(e,"beforeUpdate",g);var w=l.allBodies(f),b=l.allConstraints(f);for(f.isModified&&o.setBodies(d,w),f.isModified&&l.setModified(f,!1,!1,!0),e.enableSleeping&&i.update(w,m.timeScale),r._bodiesApplyGravity(w,e.gravity),r._bodiesUpdate(w,t,m.timeScale,n,f.bounds),u.preSolveAll(w),p=0;p<e.constraintIterations;p++)u.solveAll(b,m.timeScale);u.postSolveAll(w),d.pairs=e.pairs;var x=o.collisions(d);for(a.update(v,x,y),e.enableSleeping&&i.afterCollisions(v.list,m.timeScale),v.collisionStart.length>0&&c.trigger(e,"collisionStart",{pairs:v.collisionStart}),s.preSolvePosition(v.list),p=0;p<e.positionIterations;p++)s.solvePosition(v.list,m.timeScale);for(s.postSolvePosition(w),u.preSolveAll(w),p=0;p<e.constraintIterations;p++)u.solveAll(b,m.timeScale);for(u.postSolveAll(w),s.preSolveVelocity(v.list),p=0;p<e.velocityIterations;p++)s.solveVelocity(v.list,m.timeScale);return v.collisionActive.length>0&&c.trigger(e,"collisionActive",{pairs:v.collisionActive}),v.collisionEnd.length>0&&c.trigger(e,"collisionEnd",{pairs:v.collisionEnd}),r._bodiesClearForces(w),c.trigger(e,"afterUpdate",g),e.timing.lastElapsed=h.now()-_,e},r.merge=function(e,t){if(h.extend(e,t),t.world){e.world=t.world,r.clear(e);for(var n=l.allBodies(e.world),s=0;s<n.length;s++){var o=n[s];i.set(o,!1),o.id=h.nextId()}}},r.clear=function(e){a.clear(e.pairs),o.clear(e.detector)},r._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},r._bodiesApplyGravity=function(e,t){var n=void 0!==t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var r=0;r<e.length;r++){var i=e[r];i.isStatic||i.isSleeping||(i.force.y+=i.mass*t.y*n,i.force.x+=i.mass*t.x*n)}},r._bodiesUpdate=function(e,t,n,r,i){for(var s=0;s<e.length;s++){var o=e[s];o.isStatic||o.isSleeping||_.update(o,t,n,r)}}},function(e,t,n){var r={};e.exports=r;var i=n(3),s=n(1);r._restingThresh=4,r._restingThreshTangent=6,r._positionDampen=.9,r._positionWarming=.8,r._frictionNormalMultiplier=5,r.preSolvePosition=function(e){var t,n,r,i=e.length;for(t=0;t<i;t++)(n=e[t]).isActive&&(r=n.activeContacts.length,n.collision.parentA.totalContacts+=r,n.collision.parentB.totalContacts+=r)},r.solvePosition=function(e,t){var n,i,s,o,a,c,l,u,h=r._positionDampen,_=e.length;for(n=0;n<_;n++)(i=e[n]).isActive&&!i.isSensor&&(o=(s=i.collision).parentA,a=s.parentB,c=s.normal,i.separation=c.x*(a.positionImpulse.x+s.penetration.x-o.positionImpulse.x)+c.y*(a.positionImpulse.y+s.penetration.y-o.positionImpulse.y));for(n=0;n<_;n++)(i=e[n]).isActive&&!i.isSensor&&(o=(s=i.collision).parentA,a=s.parentB,c=s.normal,u=(i.separation-i.slop)*t,(o.isStatic||a.isStatic)&&(u*=2),o.isStatic||o.isSleeping||(l=h/o.totalContacts,o.positionImpulse.x+=c.x*u*l,o.positionImpulse.y+=c.y*u*l),a.isStatic||a.isSleeping||(l=h/a.totalContacts,a.positionImpulse.x-=c.x*u*l,a.positionImpulse.y-=c.y*u*l))},r.postSolvePosition=function(e){for(var t=r._positionWarming,n=e.length,o=i.translate,a=s.update,c=0;c<n;c++){var l=e[c],u=l.positionImpulse,h=u.x,_=u.y,p=l.velocity;if(l.totalContacts=0,0!==h||0!==_){for(var f=0;f<l.parts.length;f++){var d=l.parts[f];o(d.vertices,u),a(d.bounds,d.vertices,p),d.position.x+=h,d.position.y+=_}l.positionPrev.x+=h,l.positionPrev.y+=_,h*p.x+_*p.y<0?(u.x=0,u.y=0):(u.x*=t,u.y*=t)}}},r.preSolveVelocity=function(e){var t,n,r=e.length;for(t=0;t<r;t++){var i=e[t];if(i.isActive&&!i.isSensor){var s=i.activeContacts,o=s.length,a=i.collision,c=a.parentA,l=a.parentB,u=a.normal,h=a.tangent;for(n=0;n<o;n++){var _=s[n],p=_.vertex,f=_.normalImpulse,d=_.tangentImpulse;if(0!==f||0!==d){var v=u.x*f+h.x*d,m=u.y*f+h.y*d;c.isStatic||c.isSleeping||(c.positionPrev.x+=v*c.inverseMass,c.positionPrev.y+=m*c.inverseMass,c.anglePrev+=c.inverseInertia*((p.x-c.position.x)*m-(p.y-c.position.y)*v)),l.isStatic||l.isSleeping||(l.positionPrev.x-=v*l.inverseMass,l.positionPrev.y-=m*l.inverseMass,l.anglePrev-=l.inverseInertia*((p.x-l.position.x)*m-(p.y-l.position.y)*v))}}}}},r.solveVelocity=function(e,t){var n,i,s,o,a=t*t,c=r._restingThresh*a,l=r._frictionNormalMultiplier,u=r._restingThreshTangent*a,h=Number.MAX_VALUE,_=e.length;for(s=0;s<_;s++){var p=e[s];if(p.isActive&&!p.isSensor){var f=p.collision,d=f.parentA,v=f.parentB,m=d.velocity,y=v.velocity,g=f.normal.x,w=f.normal.y,b=f.tangent.x,x=f.tangent.y,S=p.activeContacts,T=S.length,C=1/T,k=d.inverseMass+v.inverseMass,E=p.friction*p.frictionStatic*l*a;for(m.x=d.position.x-d.positionPrev.x,m.y=d.position.y-d.positionPrev.y,y.x=v.position.x-v.positionPrev.x,y.y=v.position.y-v.positionPrev.y,d.angularVelocity=d.angle-d.anglePrev,v.angularVelocity=v.angle-v.anglePrev,o=0;o<T;o++){var I=S[o],A=I.vertex,P=A.x-d.position.x,O=A.y-d.position.y,R=A.x-v.position.x,N=A.y-v.position.y,M=m.x-O*d.angularVelocity,$=m.y+P*d.angularVelocity,B=M-(y.x-N*v.angularVelocity),j=$-(y.y+R*v.angularVelocity),D=g*B+w*j,G=b*B+x*j,F=p.separation+D,U=Math.min(F,1),L=(U=F<0?0:U)*E;G>L||-G>L?(i=G>0?G:-G,(n=p.friction*(G>0?1:-1)*a)<-i?n=-i:n>i&&(n=i)):(n=G,i=h);var z=P*w-O*g,V=R*w-N*g,q=C/(k+d.inverseInertia*z*z+v.inverseInertia*V*V),W=(1+p.restitution)*D*q;if(n*=q,D*D>c&&D<0)I.normalImpulse=0;else{var J=I.normalImpulse;I.normalImpulse+=W,I.normalImpulse=Math.min(I.normalImpulse,0),W=I.normalImpulse-J}if(G*G>u)I.tangentImpulse=0;else{var Q=I.tangentImpulse;I.tangentImpulse+=n,I.tangentImpulse<-i&&(I.tangentImpulse=-i),I.tangentImpulse>i&&(I.tangentImpulse=i),n=I.tangentImpulse-Q}var H=g*W+b*n,K=w*W+x*n;d.isStatic||d.isSleeping||(d.positionPrev.x+=H*d.inverseMass,d.positionPrev.y+=K*d.inverseMass,d.anglePrev+=(P*K-O*H)*d.inverseInertia),v.isStatic||v.isSleeping||(v.positionPrev.x-=H*v.inverseMass,v.positionPrev.y-=K*v.inverseMass,v.anglePrev-=(R*K-N*H)*v.inverseInertia)}}}}},function(e,t,n){var r={};e.exports=r;var i=n(9),s=n(0);r.create=function(e){return s.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},r.update=function(e,t,n){var r,s,o,a,c=e.list,l=c.length,u=e.table,h=t.length,_=e.collisionStart,p=e.collisionEnd,f=e.collisionActive;for(_.length=0,p.length=0,f.length=0,a=0;a<l;a++)c[a].confirmedActive=!1;for(a=0;a<h;a++)(o=(r=t[a]).pair)?(o.isActive?f.push(o):_.push(o),i.update(o,r,n),o.confirmedActive=!0):(u[(o=i.create(r,n)).id]=o,_.push(o),c.push(o));var d=[];for(l=c.length,a=0;a<l;a++)(o=c[a]).confirmedActive||(i.setActive(o,!1,n),p.push(o),o.collision.bodyA.isSleeping||o.collision.bodyB.isSleeping||d.push(a));for(a=0;a<d.length;a++)o=c[s=d[a]-a],c.splice(s,1),delete u[o.id]},r.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}},function(e,t,n){var r=e.exports=n(22);r.Axes=n(11),r.Bodies=n(12),r.Body=n(6),r.Bounds=n(1),r.Collision=n(8),r.Common=n(0),r.Composite=n(5),r.Composites=n(23),r.Constraint=n(10),r.Contact=n(17),r.Detector=n(14),r.Engine=n(18),r.Events=n(4),r.Grid=n(24),r.Mouse=n(13),r.MouseConstraint=n(25),r.Pair=n(9),r.Pairs=n(20),r.Plugin=n(15),r.Query=n(26),r.Render=n(16),r.Resolver=n(19),r.Runner=n(27),r.SAT=n(28),r.Sleeping=n(7),r.Svg=n(29),r.Vector=n(2),r.Vertices=n(3),r.World=n(30),r.Engine.run=r.Runner.run,r.Common.deprecated(r.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(e,t,n){var r={};e.exports=r;var i=n(15),s=n(0);r.name="matter-js",r.version="0.18.0",r.uses=[],r.used=[],r.use=function(){i.use(r,Array.prototype.slice.call(arguments))},r.before=function(e,t){return e=e.replace(/^Matter./,""),s.chainPathBefore(r,e,t)},r.after=function(e,t){return e=e.replace(/^Matter./,""),s.chainPathAfter(r,e,t)}},function(e,t,n){var r={};e.exports=r;var i=n(5),s=n(10),o=n(0),a=n(6),c=n(12),l=o.deprecated;r.stack=function(e,t,n,r,s,o,c){for(var l,u=i.create({label:"Stack"}),h=e,_=t,p=0,f=0;f<r;f++){for(var d=0,v=0;v<n;v++){var m=c(h,_,v,f,l,p);if(m){var y=m.bounds.max.y-m.bounds.min.y,g=m.bounds.max.x-m.bounds.min.x;y>d&&(d=y),a.translate(m,{x:.5*g,y:.5*y}),h=m.bounds.max.x+s,i.addBody(u,m),l=m,p+=1}else h+=s}_+=d+o,h=e}return u},r.chain=function(e,t,n,r,a,c){for(var l=e.bodies,u=1;u<l.length;u++){var h=l[u-1],_=l[u],p=h.bounds.max.y-h.bounds.min.y,f=h.bounds.max.x-h.bounds.min.x,d=_.bounds.max.y-_.bounds.min.y,v={bodyA:h,pointA:{x:f*t,y:p*n},bodyB:_,pointB:{x:(_.bounds.max.x-_.bounds.min.x)*r,y:d*a}},m=o.extend(v,c);i.addConstraint(e,s.create(m))}return e.label+=" Chain",e},r.mesh=function(e,t,n,r,a){var c,l,u,h,_,p=e.bodies;for(c=0;c<n;c++){for(l=1;l<t;l++)u=p[l-1+c*t],h=p[l+c*t],i.addConstraint(e,s.create(o.extend({bodyA:u,bodyB:h},a)));if(c>0)for(l=0;l<t;l++)u=p[l+(c-1)*t],h=p[l+c*t],i.addConstraint(e,s.create(o.extend({bodyA:u,bodyB:h},a))),r&&l>0&&(_=p[l-1+(c-1)*t],i.addConstraint(e,s.create(o.extend({bodyA:_,bodyB:h},a)))),r&&l<t-1&&(_=p[l+1+(c-1)*t],i.addConstraint(e,s.create(o.extend({bodyA:_,bodyB:h},a))))}return e.label+=" Mesh",e},r.pyramid=function(e,t,n,i,s,o,c){return r.stack(e,t,n,i,s,o,(function(t,r,o,l,u,h){var _=Math.min(i,Math.ceil(n/2)),p=u?u.bounds.max.x-u.bounds.min.x:0;if(!(l>_||o<(l=_-l)||o>n-1-l))return 1===h&&a.translate(u,{x:(o+(n%2==1?1:-1))*p,y:0}),c(e+(u?o*p:0)+o*s,r,o,l,u,h)}))},r.newtonsCradle=function(e,t,n,r,o){for(var a=i.create({label:"Newtons Cradle"}),l=0;l<n;l++){var u=c.circle(e+l*(1.9*r),t+o,r,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=s.create({pointA:{x:e+l*(1.9*r),y:t},bodyB:u});i.addBody(a,u),i.addConstraint(a,h)}return a},l(r,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),r.car=function(e,t,n,r,o){var l=a.nextGroup(!0),u=.5*-n+20,h=.5*n-20,_=i.create({label:"Car"}),p=c.rectangle(e,t,n,r,{collisionFilter:{group:l},chamfer:{radius:.5*r},density:2e-4}),f=c.circle(e+u,t+0,o,{collisionFilter:{group:l},friction:.8}),d=c.circle(e+h,t+0,o,{collisionFilter:{group:l},friction:.8}),v=s.create({bodyB:p,pointB:{x:u,y:0},bodyA:f,stiffness:1,length:0}),m=s.create({bodyB:p,pointB:{x:h,y:0},bodyA:d,stiffness:1,length:0});return i.addBody(_,p),i.addBody(_,f),i.addBody(_,d),i.addConstraint(_,v),i.addConstraint(_,m),_},l(r,"car","Composites.car ➤ moved to car example"),r.softBody=function(e,t,n,i,s,a,l,u,h,_){h=o.extend({inertia:1/0},h),_=o.extend({stiffness:.2,render:{type:"line",anchors:!1}},_);var p=r.stack(e,t,n,i,s,a,(function(e,t){return c.circle(e,t,u,h)}));return r.mesh(p,n,i,l,_),p.label="Soft Body",p},l(r,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(e,t,n){var r={};e.exports=r;var i=n(9),s=n(0),o=s.deprecated;r.create=function(e){return s.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},e)},r.update=function(e,t,n,i){var s,o,a,c,l,u=n.world,h=e.buckets,_=!1;for(s=0;s<t.length;s++){var p=t[s];if((!p.isSleeping||i)&&(!u.bounds||!(p.bounds.max.x<u.bounds.min.x||p.bounds.min.x>u.bounds.max.x||p.bounds.max.y<u.bounds.min.y||p.bounds.min.y>u.bounds.max.y))){var f=r._getRegion(e,p);if(!p.region||f.id!==p.region.id||i){p.region&&!i||(p.region=f);var d=r._regionUnion(f,p.region);for(o=d.startCol;o<=d.endCol;o++)for(a=d.startRow;a<=d.endRow;a++){c=h[l=r._getBucketId(o,a)];var v=o>=f.startCol&&o<=f.endCol&&a>=f.startRow&&a<=f.endRow,m=o>=p.region.startCol&&o<=p.region.endCol&&a>=p.region.startRow&&a<=p.region.endRow;!v&&m&&m&&c&&r._bucketRemoveBody(e,c,p),(p.region===f||v&&!m||i)&&(c||(c=r._createBucket(h,l)),r._bucketAddBody(e,c,p))}p.region=f,_=!0}}}_&&(e.pairsList=r._createActivePairsList(e))},o(r,"update","Grid.update ➤ replaced by Matter.Detector"),r.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},o(r,"clear","Grid.clear ➤ replaced by Matter.Detector"),r._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),s=Math.min(e.startRow,t.startRow),o=Math.max(e.endRow,t.endRow);return r._createRegion(n,i,s,o)},r._getRegion=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),s=Math.floor(n.max.x/e.bucketWidth),o=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return r._createRegion(i,s,o,a)},r._createRegion=function(e,t,n,r){return{id:e+","+t+","+n+","+r,startCol:e,endCol:t,startRow:n,endRow:r}},r._getBucketId=function(e,t){return"C"+e+"R"+t},r._createBucket=function(e,t){return e[t]=[]},r._bucketAddBody=function(e,t,n){var r,s=e.pairs,o=i.id,a=t.length;for(r=0;r<a;r++){var c=t[r];if(!(n.id===c.id||n.isStatic&&c.isStatic)){var l=o(n,c),u=s[l];u?u[2]+=1:s[l]=[n,c,1]}}t.push(n)},r._bucketRemoveBody=function(e,t,n){var r,o=e.pairs,a=i.id;t.splice(s.indexOf(t,n),1);var c=t.length;for(r=0;r<c;r++){var l=o[a(n,t[r])];l&&(l[2]-=1)}},r._createActivePairsList=function(e){var t,n,r=e.pairs,i=s.keys(r),o=i.length,a=[];for(n=0;n<o;n++)(t=r[i[n]])[2]>0?a.push(t):delete r[i[n]];return a}},function(e,t,n){var r={};e.exports=r;var i=n(3),s=n(7),o=n(13),a=n(4),c=n(14),l=n(10),u=n(5),h=n(0),_=n(1);r.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=o.create(e.render.canvas):t&&t.element?n=o.create(t.element):(n=o.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var i={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:l.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},s=h.extend(i,t);return a.on(e,"beforeUpdate",(function(){var t=u.allBodies(e.world);r.update(s,t),r._triggerEvents(s)})),s},r.update=function(e,t){var n=e.mouse,r=e.constraint,o=e.body;if(0===n.button){if(r.bodyB)s.set(r.bodyB,!1),r.pointA=n.position;else for(var l=0;l<t.length;l++)if(o=t[l],_.contains(o.bounds,n.position)&&c.canCollide(o.collisionFilter,e.collisionFilter))for(var u=o.parts.length>1?1:0;u<o.parts.length;u++){var h=o.parts[u];if(i.contains(h.vertices,n.position)){r.pointA=n.position,r.bodyB=e.body=o,r.pointB={x:n.position.x-o.position.x,y:n.position.y-o.position.y},r.angleB=o.angle,s.set(o,!1),a.trigger(e,"startdrag",{mouse:n,body:o});break}}}else r.bodyB=e.body=null,r.pointB=null,o&&a.trigger(e,"enddrag",{mouse:n,body:o})},r._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&a.trigger(e,"mousemove",{mouse:t}),n.mousedown&&a.trigger(e,"mousedown",{mouse:t}),n.mouseup&&a.trigger(e,"mouseup",{mouse:t}),o.clearSourceEvents(t)}},function(e,t,n){var r={};e.exports=r;var i=n(2),s=n(8),o=n(1),a=n(12),c=n(3);r.collides=function(e,t){for(var n=[],r=t.length,i=e.bounds,a=s.collides,c=o.overlaps,l=0;l<r;l++){var u=t[l],h=u.parts.length,_=1===h?0:1;if(c(u.bounds,i))for(var p=_;p<h;p++){var f=u.parts[p];if(c(f.bounds,i)){var d=a(f,e);if(d){n.push(d);break}}}}return n},r.ray=function(e,t,n,s){s=s||1e-100;for(var o=i.angle(t,n),c=i.magnitude(i.sub(t,n)),l=.5*(n.x+t.x),u=.5*(n.y+t.y),h=a.rectangle(l,u,c,s,{angle:o}),_=r.collides(h,e),p=0;p<_.length;p+=1){var f=_[p];f.body=f.bodyB=f.bodyA}return _},r.region=function(e,t,n){for(var r=[],i=0;i<e.length;i++){var s=e[i],a=o.overlaps(s.bounds,t);(a&&!n||!a&&n)&&r.push(s)}return r},r.point=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];if(o.contains(i.bounds,t))for(var s=1===i.parts.length?0:1;s<i.parts.length;s++){var a=i.parts[s];if(o.contains(a.bounds,t)&&c.contains(a.vertices,t)){n.push(i);break}}}return n}},function(e,t,n){var r={};e.exports=r;var i,s,o,a=n(4),c=n(18),l=n(0);"undefined"!=typeof window&&(i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i||(i=function(e){o=setTimeout((function(){e(l.now())}),1e3/60)},s=function(){clearTimeout(o)}),r.create=function(e){var t=l.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},e);return t.delta=t.delta||1e3/t.fps,t.deltaMin=t.deltaMin||1e3/t.fps,t.deltaMax=t.deltaMax||1e3/(.5*t.fps),t.fps=1e3/t.delta,t},r.run=function(e,t){return void 0!==e.positionIterations&&(t=e,e=r.create()),function n(s){e.frameRequestId=i(n),s&&e.enabled&&r.tick(e,t,s)}(),e},r.tick=function(e,t,n){var r,i=t.timing,s=1,o={timestamp:i.timestamp};a.trigger(e,"beforeTick",o),e.isFixed?r=e.delta:(r=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(r),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),s=(r=(r=(r=Math.min.apply(null,e.deltaHistory))<e.deltaMin?e.deltaMin:r)>e.deltaMax?e.deltaMax:r)/e.delta,e.delta=r),0!==e.timeScalePrev&&(s*=i.timeScale/e.timeScalePrev),0===i.timeScale&&(s=0),e.timeScalePrev=i.timeScale,e.correction=s,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),a.trigger(e,"tick",o),a.trigger(e,"beforeUpdate",o),c.update(t,r,s),a.trigger(e,"afterUpdate",o),a.trigger(e,"afterTick",o)},r.stop=function(e){s(e.frameRequestId)},r.start=function(e,t){r.run(e,t)}},function(e,t,n){var r={};e.exports=r;var i=n(8),s=n(0).deprecated;r.collides=function(e,t){return i.collides(e,t)},s(r,"collides","SAT.collides ➤ replaced by Collision.collides")},function(e,t,n){var r={};e.exports=r,n(1);var i=n(0);r.pathToVertices=function(e,t){"undefined"==typeof window||"SVGPathSeg"in window||i.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,s,o,a,c,l,u,h,_,p,f,d=[],v=0,m=0,y=0;t=t||15;var g=function(e,t,n){var r=n%2==1&&n>1;if(!_||e!=_.x||t!=_.y){_&&r?(p=_.x,f=_.y):(p=0,f=0);var i={x:p+e,y:f+t};!r&&_||(_=i),d.push(i),m=p+e,y=f+t}},w=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":m=e.x,y=e.y;break;case"H":m=e.x;break;case"V":y=e.y}g(m,y,e.pathSegType)}};for(r._svgPathToAbsolute(e),o=e.getTotalLength(),l=[],n=0;n<e.pathSegList.numberOfItems;n+=1)l.push(e.pathSegList.getItem(n));for(u=l.concat();v<o;){if((c=l[e.getPathSegAtLength(v)])!=h){for(;u.length&&u[0]!=c;)w(u.shift());h=c}switch(c.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=e.getPointAtLength(v),g(a.x,a.y,0)}v+=t}for(n=0,s=u.length;n<s;++n)w(u[n]);return d},r._svgPathToAbsolute=function(e){for(var t,n,r,i,s,o,a=e.pathSegList,c=0,l=0,u=a.numberOfItems,h=0;h<u;++h){var _=a.getItem(h),p=_.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in _&&(c=_.x),"y"in _&&(l=_.y);else switch("x1"in _&&(r=c+_.x1),"x2"in _&&(s=c+_.x2),"y1"in _&&(i=l+_.y1),"y2"in _&&(o=l+_.y2),"x"in _&&(c+=_.x),"y"in _&&(l+=_.y),p){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(c,l),h);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(c,l),h);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(c),h);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(l),h);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(c,l,r,i,s,o),h);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(c,l,s,o),h);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(c,l,r,i),h);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(c,l),h);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(c,l,_.r1,_.r2,_.angle,_.largeArcFlag,_.sweepFlag),h);break;case"z":case"Z":c=t,l=n}"M"!=p&&"m"!=p||(t=c,n=l)}}},function(e,t,n){var r={};e.exports=r;var i=n(5);n(0),r.create=i.create,r.add=i.add,r.remove=i.remove,r.clear=i.clear,r.addComposite=i.addComposite,r.addBody=i.addBody,r.addConstraint=i.addConstraint}])},e.exports=r()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{Body:()=>S,Camera:()=>K,CircleCollider:()=>p,CircleRenderer:()=>G,Collider:()=>_,Entity:()=>Se,EntropyEngine:()=>$e,GUIBox:()=>z,GUICircle:()=>V,GUIElement:()=>L,GUIImage:()=>q,GUIPolygon:()=>W,GUIRect:()=>J,GUIText:()=>Q,GUITextBox:()=>H,ImageRenderer2D:()=>U,JSONifyComponent:()=>v,MeshV2:()=>ie,MeshV3:()=>se,RectCollider:()=>f,RectRenderer:()=>F,Scene:()=>Y,Script:()=>te,Systems:()=>Ce,Transform:()=>Z,TriangleV2:()=>ne,TriangleV3:()=>re,circle:()=>k,clearCanvas:()=>ke,colour:()=>s,cullString:()=>y,defaultSceneSettings:()=>X,drawCameraViewArea:()=>Oe,drawCameras:()=>Pe,entitiesFromJSON:()=>be,genCacheBust:()=>w,getMousePos:()=>oe,image:()=>P,initialiseEntropyScript:()=>_e,initialiseScenes:()=>xe,input:()=>ae,nameFromScriptURL:()=>g,polygon:()=>I,rect:()=>E,renderAll:()=>Ie,renderBackground:()=>Ee,renderDebug:()=>Re,renderSelectedOutline:()=>Ne,rgb:()=>o,rgbValToHex:()=>l,rgba:()=>c,rotateAroundPointWrapper:()=>T,roundedRect:()=>C,runFromJSON:()=>Be,scaleMeshV2:()=>m,scriptFetchHeaders:()=>b,scriptFetchInit:()=>x,scriptFromURL:()=>fe,sleep:()=>d,startAnimation:()=>Te,text:()=>A,v2:()=>t,v3:()=>e});class e{constructor(n,r=n,i=n,s=1){this.add=e=>(this.x+=(null==e?void 0:e.x)||0,this.y+=(null==e?void 0:e.y)||0,this.z+=(null==e?void 0:e.z)||0,this),this.sub=e=>(this.x-=e.x||0,this.y-=e.y||0,this.z-=e.z||0,this),this.mul=e=>(this.x*=e.x,this.y*=e.y,this.z*=e.z,this),this.scale=e=>(this.x*=e,this.y*=e,this.z*=e,this),this.div=e=>(0!==e.x&&(this.x/=e.x),0!==e.y&&(this.y/=e.y),0!==e.z&&(this.z/=e.z),this),this.distTo=e=>this.clone.sub(e).magnitude,this.diff=t=>new e(Math.abs(this.x-t.x),Math.abs(this.y-t.y),Math.abs(this.z-t.z)),this.normalise=()=>{const e=this.magnitude;return 0!==e?this.scale(1/e):console.error("Cannot normalise vector with magnitude 0"),this},this.equals=e=>e.x===this.x&&e.y===this.y&&e.z===this.z,this.isInCuboid=(e,n)=>new t(this.x,this.y).isInRect(new t(e.x,e.y),new t(n.x,n.y))&&new t(this.y,this.z).isInRect(new t(e.y,e.z),new t(n.y,n.z))&&new t(this.x,this.z).isInRect(new t(e.x,e.z),new t(n.x,n.z)),this.set=e=>(this.x=e.x,this.y=e.y,this.z=e.z,this),this.apply=e=>{this.x=e(this.x),this.y=e(this.y),this.z=e(this.z)},this.dot=e=>this.x*e.x+this.y*e.y+this.z*e.z,this.cross=e=>this.x*e.y-this.y*e.x-this.z*e.z,this.toInt=()=>(this.apply(Math.round),this),this.x=n,this.y=r,this.z=i,this.w=s}get magnitude(){let e=Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2);return 0===e?0:Math.sqrt(e)}get clone(){return new e(this.x,this.y,this.z)}get str(){return`x: ${this.x} \ny: ${this.y} \nz: ${this.z}`}get negative(){return this.clone.scale(-1)}get v2(){return new t(this.x,this.y)}get array(){return[this.x,this.y,this.z]}static get up(){return new e(0,1,0)}static get down(){return new e(0,-1,0)}static get right(){return new e(1,0,0)}static get left(){return new e(-1,0,0)}static get forward(){return new e(0,0,1)}static get back(){return new e(0,0,-1)}static get zero(){return new e(0,0,0)}static avPoint(t){let n=e.zero;for(let e of t)n.add(e);return n.scale(1/t.length)}static fromArray(t){return new e(t[0],t[1],t[2])}}class t{constructor(e,t=e){this.x=e,this.y=t}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e.x,this.y*=e.y,this}scale(e){return this.x*=e,this.y*=e,this}div(e){return 0!==e.x&&(this.x/=e.x),0!==e.y&&(this.y/=e.y),this}distTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}diff(e){return new t(Math.abs(this.x-e.x),Math.abs(this.y-e.y))}get magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}normalise(){const e=this.magnitude;return 0!==e?this.scale(1/e):console.error("Cannot normalise vector with magnitude 0"),this}get clone(){return new t(this.x,this.y)}get angle(){return-Math.atan2(-this.y,this.x)}get str(){return`x: ${this.x} \ny: ${this.y}`}equals(e){return e.x===this.x&&e.y===this.y}isInRect(e,t){return this.x>e.x&&this.x<e.x+t.x&&this.y>e.y&&this.y<e.y+t.y}set(e){return this.x=Number(e.x),this.y=Number(e.y),this}apply(e){this.x=Number(e(this.x)),this.y=Number(e(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}get negative(){return this.clone.scale(-1)}toInt(){return this.apply(Math.round),this}get v3(){return new e(this.x,this.y,0)}get array(){return[this.x,this.y]}static fromAngleMagnitude(e,n){for(;e<0;)e+=360;return e%=360,new t(Math.sin(e),Math.cos(e)).normalise().scale(n)}static fromArray(e){return new t(e[0],e[1])}static get up(){return new t(0,1)}static get down(){return new t(0,-1)}static get right(){return new t(1,0)}static get left(){return new t(-1,0)}static get zero(){return new t(0,0)}static avPoint(e){let n=t.zero;for(let t of e)n.add(t);return n.scale(1/e.length)}}var i=n(842);class s{constructor(e=0,t=e,n=e,r=1){this.red=e,this.green=t,this.blue=n,this.alpha=r,this.isColour=!0}get hex(){return`#${l(this.red)}${l(this.green)}${l(this.blue)}`}get rgb(){return`rgb(${this.red}, ${this.green}, ${this.blue})`}get rgba(){return`rgba(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`}get clone(){return new s(this.red,this.green,this.blue,this.alpha)}get json(){return{r:this.red,g:this.green,b:this.blue,a:this.alpha}}static parse(e){let t;return t=e.match(/^#([0-9a-f]{3})$/i),t&&t[1]?o(17*parseInt(t[1].charAt(0),16),17*parseInt(t[1].charAt(1),16),17*parseInt(t[1].charAt(2),16)):(t=e.match(/^#([0-9a-f]{6})$/i),t?o(parseInt(t[1].substr(0,2),16),parseInt(t[1].substr(2,2),16),parseInt(t[1].substr(4,2),16)):(t=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i),t?o(parseInt(t[1]),parseInt(t[2]),parseInt(t[3])):a[e]||o(0,0,0)))}fromJSON({r:e,g:t,b:n}){return o(e,t,n)}}function o(e=0,t=e,n=e){return new s(e,t,n)}const a={red:o(255,0,0),green:o(0,255,0),blue:o(0,0,255),white:o(255,255,255)};function c(e,t,n,r){return new s(e,t,n,r)}function l(e){let t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}o.parse=s.parse;class u{constructor(e){this.array=e.array||!1,this.type=e.type||typeof e.value||"string",this.value=e.value,this.name=e.name,this.description=e.description||"",this.default=e.default,this.assetType=e.assetType,this.array&&(this.value?Array.isArray(this.value)||(this.value=[this.value]):this.value=[])}}class h{constructor(e,t=""){this.type=e,this.subtype=t,this.public=[]}addPublic(e){if(!e.name)return void console.error("Public fields must have 'name' property");if(this.hasPublic(e.name))return void console.error("Cannot add property with existing name: "+e.name);if(void 0===e.value&&void 0===e.default)return void console.error("Public fields must have 'value' property");void 0===e.value&&(e.value=e.default);const t=new u(e);return this.public.push(t),Object.defineProperty(this,e.name,{enumerable:!0,get(){return void 0===e.overrideGet?this.getPublic(e.name):e.overrideGet()},set(t){void 0!==e.overrideSet?e.overrideSet(t):this.setPublicTypeCheck(e.name,t)}}),t}getPublic(e){for(let t of this.public)if(t.name===e)return t.value}getPublicField(e){for(let t of this.public)if(t.name===e)return t}hasPublic(e){for(let t of this.public)if(t.name===e)return!0;return!1}setPublic(e,t){for(let n of this.public)n.name===e&&(n.value=t)}setPublicTypeCheck(n,r){if(!this.hasPublic(n))return void console.log(`No public variable found  with name ${n}`);const i=typeof r,s=this.getPublicField(n);if(void 0!==s)switch(s.type){case"rgb":if("string"==typeof r){this.setPublic(n,o.parse(r));break}if(r&&(null==r?void 0:r.isColour)){this.setPublic(n,r);break}console.error(`Cannot set property '${n}' of type '${i}' to:`,r);break;case"Transform":this.setPublic(n,r);break;case"v2":if(r instanceof t){this.setPublic(n,r);break}if(Array.isArray(r)&&2===r.length){this.setPublic(n,t.fromArray(r));break}if("number"==typeof r.x&&"number"==typeof r.y){this.setPublic(n,new t(r.x,r.y));break}console.error(`Cannot set public property '${n}' of type v2 to value '${r}' of type '${i}'`);break;case"v3":if(r instanceof e){this.setPublic(n,r);break}if(Array.isArray(r)&&(3===r.length||4===r.length)){this.setPublic(n,e.fromArray(r));break}if("number"==typeof r.x&&"number"==typeof r.y&&"number"==typeof r.z){this.setPublic(n,new e(r.x,r.y,r.z,r.w));break}console.error(`Cannot set public property '${n}' of type v3 to value '${r}' of type '${i}'`);break;default:if(i!==s.type)return void console.error(`Tried to set public variable '${n}' of type '${s.type}' to '${r}' of type '${i}'`);this.setPublic(n,r)}else console.log(`No public variable found  with name ${n}`)}}class _ extends h{constructor(e,n,r,i){super("Collider",e),this.offset=t.zero,this.solid=!0,this.addPublic({name:"solid",value:n,description:"If the collider should interact with other colliders or not",default:!0,type:"boolean"}),this.addPublic({name:"offset",value:r,type:"v2",description:"Offsets the renderer from the transform of the entity",default:t.zero}),this.MatterBody=i}}class p extends _{constructor({radius:e=1,solid:n=!0,offset:r=new t(0,0)}={}){super("CircleCollider",n,r,i.Bodies.circle(0,0,e,{})),this.radius=0,this.addPublic({name:"radius",value:e,default:1})}overlapsPoint(e,t){const n=i.Bodies.circle(e.position.x,e.position.y,this.radius*e.scale.x,{angle:e.rotation.z});return i.Query.point([n],i.Vector.create(t.x,t.y)).length>0}json(){return{type:"CircleCollider",radius:this.radius,solid:this.solid,offset:this.offset.array}}}class f extends _{constructor({width:e=1,height:n=1,solid:r=!0,offset:s=new t(0,0)}={}){super("RectCollider",r,s,i.Bodies.rectangle(0,0,e,n,{})),this.width=0,this.height=0,this.addPublic({name:"height",value:n}),this.addPublic({name:"width",value:e})}overlapsPoint(e,t){const n=i.Bodies.rectangle(e.position.x,e.position.y,this.width*e.scale.x,this.height*e.scale.y,{angle:e.rotation.z});return i.Query.point([n],i.Vector.create(t.x,t.y)).length>0}json(){return{type:"RectCollider",height:this.height,width:this.width,solid:this.solid,offset:this.offset.array}}}function d(e){return new Promise((t=>setTimeout(t,e)))}function v(n,r){let i={};for(const r in n){if(-1!==["type","subtype","hasSubType","public"].indexOf(r))continue;let s=n[r];s instanceof t||s instanceof e?s=s.array:s.isColour&&(s=s.json),i[r]=s}return i.type=r||n.subtype,i}function m(e,n){const r=e.map((e=>e.clone));let i=t.avPoint(r);for(let e of r){const t=e.clone.sub(i);t.mul(n);const r=i.clone.add(t);e.set(r)}return r}function y(e,t){if(t>=e.length)return e;let n="";for(let r=0;r<t;r++)n+=e[r]||"";return n.length<e.length&&(n+="..."),n}function g(e){let t=e.substring(e.lastIndexOf("/")+1);return t.substring(0,t.length-3)}function w(){return Math.ceil(1e4*Math.random())}const b=new Headers;b.append("pragma","no-cache"),b.append("cache-control","no-cache");const x={method:"GET",headers:b};class S extends h{constructor({velocity:t=e.zero,mass:n=1,friction:r=.1,airResistance:i=.1,bounciness:s=.2}={}){super("Body"),this.velocity=e.zero,this.mass=0,this.friction=0,this.airResistance=0,this.bounciness=0,this.addPublic({name:"velocity",value:t,description:"The speed and direction of the object at the first frame",type:"v3"}),this.addPublic({name:"mass",value:n,description:"The mass of the object affects collisions, forces and more."}),this.addPublic({name:"friction",value:r,description:"When colliding, this is applied to the velocity. Higher values slow it down more."}),this.addPublic({name:"airResistance",value:i,description:"Velocity is scaled by this every Update. Larger values give higher resistance and more slowing"}),this.addPublic({name:"bounciness",value:s,description:"When dynamically colliding, the velocity is reversed and multiplied by this. Higher values give a higher bounce."})}json(){return v(this,"Body")}applyForce(e){return this.velocity.add(e.clone.scale(1/this.mass)),this.velocity}}function T(e,t,n,r){e.translate(t.x,t.y),e.rotate(n*Math.PI/180),e.translate(-t.x,-t.y),r(),e.translate(t.x,t.y),e.rotate(-n*Math.PI/180),e.translate(-t.x,-t.y)}function C(e,n,r,i,s,o,a=0){T(e,i.clone.add(new t(n/2,r/2)),a,(()=>{e.beginPath(),e.moveTo(i.x+o,i.y),e.lineTo(i.x+n-o,i.y),e.quadraticCurveTo(i.x+n,i.y,i.x+n,i.y+o),e.lineTo(i.x+n,i.y+r-o),e.quadraticCurveTo(i.x+n,i.y+r,i.x+n-o,i.y+r),e.lineTo(i.x+o,i.y+r),e.quadraticCurveTo(i.x,i.y+r,i.x,i.y+r-o),e.lineTo(i.x,i.y+o),e.quadraticCurveTo(i.x,i.y,i.x+o,i.y),e.closePath(),e.fillStyle=s,e.fill(),e.closePath()}))}function k(e,t,n,r,i=2*Math.PI,s=0){T(e,t.clone,s,(()=>{e.beginPath(),e.arc(t.x,t.y,n,0,i),e.fillStyle=r,e.fill(),e.closePath()}))}function E(e,n,r,i,s,o=0){T(e,n.clone.add(new t(r/2,i/2)),o,(()=>{e.beginPath(),e.rect(n.x,n.y,r,i),e.fillStyle=s,e.fill(),e.closePath()}))}function I(e,n,r,i=!0,s=0){T(e,t.avPoint(n),s,(()=>{e.beginPath(),e.moveTo(n[0].x,n[0].y),e.strokeStyle=r;for(let t of n.slice(1,n.length))e.lineTo(t.x,t.y);i?(e.fillStyle=r,e.fill(),e.closePath()):e.stroke()}))}function A(e,n,r,i,s,o,a="center",c=0){const l=new t(e.measureText(n).width,r),u=o.clone.add(l.clone.scale(.5));T(e,u,c,(()=>{e.beginPath(),e.translate(u.x,u.y),e.rotate(Math.PI),e.scale(-1,1),e.translate(-u.x,-u.y),e.font=`${r}px ${i}`,e.fillStyle=s,e.textBaseline="middle",e.textAlign=a,e.fillText(n,o.x,o.y),e.translate(u.x,u.y),e.rotate(-Math.PI),e.scale(-1,1),e.translate(-u.x,-u.y),e.closePath()}))}function P(e,t,n,r,i=0){T(e,t.clone.add(n.clone.scale(.5)),i,(()=>{t=t.clone,e.beginPath();let i=new Image;i.src=r;const s=t.clone.add(n.clone.scale(.5));e.translate(s.x,s.y),e.rotate(Math.PI),e.scale(-1,1),e.translate(-s.x,-s.y),e.drawImage(i,t.x,t.y,n.x,n.y),e.translate(s.x,s.y),e.rotate(-Math.PI),e.scale(-1,1),e.translate(-s.x,-s.y),e.closePath()}))}function O(e){return new t(e.width,e.height)}function R(e,t,n){return e.sub(n).scale(t).add(n)}function N(e){const t=B(e);t.transform(1,0,0,-1,0,e.height),t.save()}function M(e,t,n,r){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex=t,e.style.height=`${r.y}px`,e.style.width=`${r.x}px`,e.width=r.x,e.height=r.y}function $(e){var n,r;const i=e.background.parentElement;if(!i)throw"no parent element of canvases";const s=new t((null===(n=i.parentElement)||void 0===n?void 0:n.clientWidth)||0,null===(r=i.parentElement)||void 0===r?void 0:r.clientHeight);M(e.input,"4",0,s),M(e.GUI,"3",0,s),M(e.render,"2",0,s),M(e.background,"1",0,s),N(e.input),N(e.GUI),N(e.render),N(e.background)}function B(e){const t=e.getContext("2d");if(!t)throw"no ctx on canvas";return t}class j extends h{constructor(e){super("Renderer",e)}Update(){}json(){return v(this)}}class D extends j{constructor(e,n){super(e),this.offset=t.zero,this.addPublic({name:"offset",value:n,type:"v2",description:"offset from entity's transforms position"})}Update(){}json(){return v(this)}}class G extends D{constructor({radius:e=1,offset:n=new t(0,0),colour:r=o()}={}){super("CircleRenderer",n),this.radius=1,this.colour=o(),this.addPublic({name:"radius",value:e,type:"number",array:!1}),this.addPublic({name:"colour",value:r,type:"rgb",overrideSet:e=>{"string"!=typeof e?this.setPublic("colour",e):this.setPublic("colour",o.parse(e))}})}draw({zoom:e,transform:t,ctx:n,position:r,center:i}){const s=this.radius*e*t.scale.x;s<=0||k(n,R(r.clone.add(this.offset),e,i),s,this.colour.rgb)}}class F extends D{constructor({height:e=1,offset:n=new t(0,0),width:r=1,colour:i=o(0,0,0)}={}){super("RectRenderer",n),this.height=1,this.width=1,this.colour=o(),this.addPublic({name:"height",value:e}),this.addPublic({name:"width",value:r}),this.addPublic({name:"colour",value:i,type:"rgb",overrideSet:e=>{"string"!=typeof e?"number"!=typeof e.r?this.setPublic("colour",e):this.setPublic("colour",c(e.r,e.g,e.b,e.a)):this.setPublic("colour",o.parse(e))}})}Start(){}draw(e){const n=this.width*e.transform.scale.x*e.zoom,r=this.height*e.transform.scale.y*e.zoom;if(r<=0||n<=0)return;let i=this.offset.clone.add(e.position);i.sub(new t(n/(2*e.zoom),r/(2*e.zoom))),E(e.ctx,R(i,e.zoom,e.center),n,r,this.colour.rgb,e.transform.rotation.z)}}class U extends D{constructor({height:e=1,offset:n=new t(0,0),width:r=1,url:i=""}={}){super("ImageRenderer2D",n),this.height=1,this.width=1,this.url="",this.addPublic({name:"height",value:e}),this.addPublic({name:"width",value:r}),this.addPublic({name:"url",value:i,type:"string",description:"The path to the image to be rendered - always start with ../projects/{yourProjectID}/assets/"})}Start(){}draw(e){if(!this.url)return;const n=this.width*e.transform.scale.x*e.zoom,r=this.height*e.transform.scale.y*e.zoom;if(r<=0||n<=0)return;let i=this.offset.clone.add(e.position);i.sub(new t(n/(2*e.zoom),r/(2*e.zoom))),P(e.ctx,R(i,e.zoom,e.center),new t(n,r),this.url,e.transform.rotation.z)}}class L extends h{constructor(e,t){super("GUIElement",e),this.hovered=!1,this.zLayer=0,this.hovered=!1,this.addPublic({name:"zLayer",value:t,description:"Determines what appears on top of what in the GUI"})}json(){return v(this)}}class z extends L{constructor({height:e=30,width:t=60,radius:n=0,innerColour:r=o(230,230,230),outerColour:i=o(90,90,90),borderThickness:s=1,zLayer:a=1}){super("GUIBox",a),this.height=0,this.width=0,this.radius=0,this.innerColour=o(),this.outerColour=o(),this.borderThickness=0,this.addPublic({name:"height",value:e,default:30}),this.addPublic({name:"width",value:t,default:60}),this.addPublic({name:"radius",value:Math.min(n,t/2,e/2),description:"Radius of the bod - maxed at (size of smaller dimension)/2",default:0,overrideSet:e=>{const t=Math.min(e,this.width/2,this.height/2);this.setPublic("radius",t)}}),this.addPublic({name:"innerColour",value:r,description:"Colour of background of box",type:"rgb"}),this.addPublic({name:"outerColour",value:i,description:"Colour of border of box",type:"rgb"}),this.addPublic({name:"borderThickness",value:s,default:1})}Start(){}draw(e,n){if(0===this.width||0===this.height)return;this.borderThickness>0&&C(e,this.width*n.scale.x,this.height*n.scale.y,n.position.v2,this.outerColour.rgba,this.radius);const r=this.borderThickness;C(e,this.width*n.scale.x-2*r,this.height*n.scale.y-2*r,n.position.v2.add(new t(r,r)),this.innerColour.rgba,this.radius-r)}touchingPoint(e,n,r){return e.isInRect(r.position.v2,new t(this.width*r.scale.x,this.height*r.scale.y))}}class V extends L{constructor({zLayer:e=1,colour:t=o(150,150,150),radius:n=1}){super("GUIRect",e),this.colour=o(),this.radius=0,this.addPublic({name:"colour",value:t,type:"rgb"}),this.addPublic({name:"radius",value:n})}draw(e,t){const n=this.radius*t.scale.x;n<=0||k(e,t.position.v2,n,this.colour.rgba)}touchingPoint(e,t,n){return e.clone.distTo(n.position.v2)<=this.radius*n.scale.x}}class q extends L{constructor({zLayer:e=1,width:t=100,height:n=100,url:r=""}){super("GUIImage",e),this.width=0,this.height=0,this.url="",this.addPublic({name:"height",value:n}),this.addPublic({name:"width",value:t}),this.addPublic({name:"url",value:r})}draw(e,n){if(!this.url)return;const r=this.width*n.scale.x,i=this.height*n.scale.y;i<=0||r<=0||P(e,n.position.v2,new t(r,i),this.url,n.rotation.z)}touchingPoint(e,n,r){const i=this.width*r.scale.x,s=this.height*r.scale.y;return e.isInRect(r.position.v2,new t(i,s))}}class W extends L{constructor({zLayer:e=1,colour:n=o(150,150,150),points:r=[t.zero]}){super("GUIPolygon",e),this.colour=o(),this.points=[],this.addPublic({name:"colour",value:n,type:"rgb"}),this.addPublic({name:"points",value:r,type:"v2",array:!0})}draw(e,t){this.points.length<=1||I(e,m(this.points,t.scale.v2),this.colour.hex,!0,t.rotation.z)}touchingPoint(e,t,n){return function(e,t){if(e.length<=1)return!1;let n=[[e[0],e[e.length-1]],[e[0],e[1]]];for(let t=1;t<e.length-1;t++)n.push([e[t],e[t+1]]);let r=0;for(let e of n){if(e[0].y>t.y&&e[1].y>t.y)continue;if(e[0].y<t.y&&e[1].y<t.y)continue;let n=e[0].y<t.y?e[0]:e[1],i=e[0].y>t.y?e[0]:e[1];Object.is(n,i)||n.x+(t.y-n.y)*(i.x-n.x)/(i.y-n.y)<t.x||r++}return r%2==1}(this.points,e)}}class J extends L{constructor({zLayer:e=1,width:t=10,height:n=10,colour:r=o(150,150,150),radius:i=1}){super("GUIRect",e),this.width=0,this.height=0,this.colour=o(),this.radius=0,this.addPublic({name:"height",value:n}),this.addPublic({name:"width",value:t}),this.addPublic({name:"radius",value:Math.min(i,t/2,n/2),description:"Radius of the bod - maxed at (size of smaller dimension)/2",default:0,overrideSet:e=>{const t=Math.min(e,this.width/2,this.height/2);this.setPublic("radius",t)}}),this.addPublic({name:"colour",value:r,type:"rgb"})}draw(e,t){const n=this.width*t.scale.x,r=this.height*t.scale.y;r<=0||n<=0||C(e,n,r,t.position.v2,this.colour.hex,this.radius)}touchingPoint(e,n,r){const i=this.width*r.scale.x,s=this.height*r.scale.y;return e.isInRect(r.position.v2,new t(i,s))}}class Q extends L{constructor({text:e="",fontSize:t=12,font:n="Arial",colour:r=o(0,0,0),alignment:i="center",fill:s=!0,zLayer:a=1}){super("GUIText",a),this.text="",this.fontSize=0,this.font="",this.colour=o(),this.alignment="",this.fill=!1,this.addPublic({name:"text",value:e,default:""}),this.addPublic({name:"fontSize",value:t,description:"In px",default:12}),this.addPublic({name:"font",value:n,default:"Arial"}),this.addPublic({name:"colour",value:r,type:"rgb"}),this.addPublic({name:"alignment",value:i,description:"Center, left or right. Default center",type:"string",default:"center"}),this.addPublic({name:"fill",value:s,description:"Should the text be filled or hollow",type:"boolean",default:!0})}draw(e,n){A(e,this.text,this.fontSize*n.scale.x,this.font,this.colour.rgba,n.position.v2.add(O(e.canvas).scale(.5)).sub(new t(0,this.fontSize*n.scale.x*.5)))}touchingPoint(e,n,r){n.font=`${this.fontSize}px ${this.font}`;const i=n.measureText(this.text);return e.isInRect(r.position.v2,new t(i.width,this.fontSize*r.scale.x))}}class H extends L{constructor({zLayer:e=1,initialText:t="text",fontSize:n=12,font:r="Arial",textColour:i=o(0,0,0),textAlignment:s="center",fillText:a=!0,limiter:c=(e=>e),maxLength:l=100}){super("GUITextBox",e),this.maxLength=0,this.text=new Q({text:t,fontSize:n,colour:i,font:r,alignment:s,fill:a}),this.selected=!1,this.limiter=c,this.addPublic({name:"maxLength",value:l,default:100})}draw(e,t){this.text.draw(e,t)}touchingPoint(e,t,n){return this.text.touchingPoint(e,t,n)}limit(){this.text.text=this.limiter(this.text.text)}keyPress(e){const t=this.text.text;13!==e.keyCode?t.length>=this.maxLength||(this.text.text=`${t}${String.fromCharCode(e.keyCode)}`,this.limit()):this.selected=!1}backspace(){this.text.text=this.text.text.slice(0,-1),this.limit()}get innerText(){return this.text.text}set innerText(e){this.text.text=e}}class K extends h{constructor({zoom:e=1,far:t=1e3,near:n=.1,fov:r=90}={}){super("Camera"),this.zoom=1,this.far=1e3,this.near=.1,this.fov=90,this.addPublic({name:"zoom",value:e,description:"2D only camera zoom - does not affect 3D rendering"}),this.addPublic({name:"far",value:t,description:"The far clipping plane. Does not affect 2D rendering."}),this.addPublic({name:"near",value:n,description:"The near clipping plane. Does not affect 2D rendering."}),this.addPublic({name:"fov",value:r,description:"Field of view - like zoom for 3D"})}json(){return v(this,"Camera")}screenSpaceToWorldSpace(e,t,n){e=e.clone;const r=O(t).scale(.5);return e.set(R(e,1/this.zoom,r)),e.add(n.v2),e.sub(r),e}worldSpaceToScreenSpace(e,t,n){const r=O(t).clone.scale(.5);return n=n.clone.sub(r.v3),R(e.clone.sub(n.v2),this.zoom,r)}}const X=()=>({license:"0000",version:"0.0.0",gameName:"Entropy Engine Game",maxFrameRate:60,timeScale:1,backgroundTint:o.parse("white"),globalGravity:new e(0,0,0),collisionIterations:5,globalVolume:1});class Y{constructor(e,t){this.id=Y.scenes.length,this.name=e,this.settings=t}json(){var e;return{name:this.name,settings:{license:this.settings.license,version:this.settings.version,gameName:this.settings.gameName,maxFrameRate:this.settings.maxFrameRate,timeScale:this.settings.timeScale,backgroundTint:(null===(e=this.settings.backgroundTint)||void 0===e?void 0:e.json)||o.parse("white").json,backgroundImage:this.settings.backgroundImage,globalGravity:this.settings.globalGravity.array,collisionIterations:this.settings.collisionIterations,globalVolume:this.settings.globalVolume}}}get entities(){const e=[],t=[];for(const t of Se.entities)t.transform.isChild()||t.transform.parent===this.id&&e.push(t);for(;e.length>0;){for(let t of e[0].transform.children)e.push(t);t.push(e.shift())}return t}findMainCamera(){for(const e of this.entities)if(e.hasComponent("Camera"))return void(K.main=e);console.error(`\n            No sprites with component of type 'camera' can be found.\n            Make sure that there is at least one sprite in the scene '${Y.activeScene.name}' with a 'Camera' component attached\n        `)}loopThroughScripts(e){for(const t of this.entities)for(const n of t.getComponents("Script"))e(n,t)}broadcast(e,t=[]){this.loopThroughScripts(((n,r)=>{n.runMethod(e,r,t)}))}static loopThroughAllScripts(e){Se.loop((t=>{for(const n of t.getComponents("Script"))e(n,t)}))}static get activeScene(){if(this.scenes.length<1)throw"No scenes found";return Y.sceneByID(Y.active)}static set activeScene(e){Y.active=e.id}static sceneByName(e){const t=Y.scenes.filter((t=>t.name===e));if(!(void 0!==t&&t[0]&&t[0]instanceof Y))throw`Cannot find scene name: ${e}`;return t[0]}static sceneExistsWithID(e){return void 0!==Y.scenes.filter((t=>t.id===e))[0]}static sceneByID(e){const t=Y.scenes.filter((t=>t.id===e))[0];if(void 0===t)throw`Cannot find scene ID: ${e} of type ${typeof e}. Scenes: ${Y.scenes}`;return t}static create(e){const t=new Y(e.name||"Scene",Object.assign(Object.assign({},X()),e.settings));return Y.scenes.push(t),t}static next(e){Y.active++,Y.active>Y.scenes.length-1&&(Y.active=0);for(let t of e)"number"==typeof t.transform.parent&&(t.transform.parent=Y.active);Y.activeScene.findMainCamera()}static previous(e){Y.active--,Y.active<0&&(Y.active=Y.scenes.length-1);for(let t of e)"number"==typeof t.transform.parent&&(t.transform.parent=Y.active);Y.activeScene.findMainCamera()}static get sceneCount(){return Y.scenes.length}}Y.scenes=[],Y.active=0;class Z extends h{constructor({position:t=e.zero,scale:n=new e(1,1,1),rotation:r=e.zero,parent:i=Y.active}={}){super("Transform"),this.position=e.zero,this.scale=new e(1),this.rotation=e.zero,this.parent=0,this.addPublic({name:"position",value:t,type:"v3",overrideGet:()=>{if("number"==typeof this.parent)return this.getPublic("position")||e.zero;const t=this.getPublic("position");return t?t.add(this.parent.position):e.zero},overrideSet:t=>{var n,r;const i=t||e.zero;null!==(n=i.x)&&void 0!==n||(i.x=0),null!==(r=i.y)&&void 0!==r||(i.y=0),this.setPublic("position",i)}}),this.addPublic({name:"rotation",value:r,type:"v3",overrideGet:()=>{if("number"==typeof this.parent)return this.getPublic("rotation")||e.zero;const t=this.getPublic("rotation");return t?t.clone.add(this.parent.rotation):e.zero},overrideSet:t=>{var n,r;const i=t||e.zero;null!==(n=i.x)&&void 0!==n||(i.x=0),null!==(r=i.y)&&void 0!==r||(i.y=0),this.setPublic("rotation",i)}}),this.addPublic({name:"scale",value:n,type:"v3",overrideGet:()=>{if("number"==typeof this.parent)return this.getPublic("scale")||new e(1);const t=this.getPublic("scale");return t?t.add(this.parent.scale):e.zero},overrideSet:t=>{var n,r;const i=t||e.zero;null!==(n=i.x)&&void 0!==n||(i.x=1),null!==(r=i.y)&&void 0!==r||(i.y=1),this.setPublic("scale",i)}}),this.addPublic({name:"parent",value:i,type:"Transform"})}setParentDirty(e){var t;if(e instanceof Z||"number"==typeof e)if("number"!=typeof e){if(this.recursiveChildren.includes(e.sprite))for(const e of this.children)e.transform.parent=this.parent;this.parent=e}else this.parent=e;else null!==(t=this.parent)&&void 0!==t||(this.parent=Y.active)}json(){let e={type:"",name:""};return this.parent instanceof Z?(e.type="Transform",e.name=this.parent.sprite.name):(e.type="Scene",e.name=this.parent.toString()),{type:"Transform",position:this.position.array,scale:this.scale.array,rotation:this.rotation.array,parent:e}}Update(){}get localRotation(){return this.getPublic("rotation")||new e(1)}set localRotation(e){this.setPublic("rotation",e)}get localPosition(){return this.getPublic("position")||e.zero}set localPosition(e){this.setPublic("position",e)}get localScale(){return this.getPublic("scale")||e.zero}set localScale(e){this.setPublic("position",e)}detachFromParent(){this.parent=Y.active}get children(){let e=[];for(let t of Se.entities)Object.is(t.transform.parent,this)&&e.push(t);return e}get recursiveChildren(){const e=this.children,t=[];for(;e.length>0;){for(let t of e[0].transform.children)e.push(t);t.push(e.shift())}return t}get childCount(){let e=0;for(let t of Se.entities)Object.is(t.transform.parent,this)&&e++;return e}makeChildOf(e){this.parent=e}makeParentOf(e){for(const t of e)t.parent=this}isRoot(){return"number"==typeof this.parent}isChild(){return this.parent instanceof Z}get sprite(){return Se.entities.find((e=>Object.is(e.transform,this)))}get root(){return function e(t){return"number"==typeof t.parent?t:e(t.parent)}(this)}get scene(){const e=this.root.parent;if("number"!=typeof e)throw"root is not scene";return Y.sceneByID(e)}get forwards(){return this.rotation}get right(){let e=this.forwards;return new t(e.y,-e.x)}getChild(e){return this.children.find((t=>t.name===e))}}var ee=n(768);class te extends h{constructor({path:e,script:t,name:n}={}){super("Script",n||(e||"").split("/").pop()||"noscript"),this.name="",this.path="",this.methodWarnings={},this.runMethod=(e,t,n=[])=>{var r;if(this.script instanceof ee.ESNamespace){n=[new ee.ESJSBinding(t),...n];const i=null===(r=this.script)||void 0===r?void 0:r.__get__({context:ue},new ee.ESString(e));if(!(i instanceof ee.ESFunction))return void(e in this.methodWarnings||(console.error(`Expected function on '${e}' in script ${this.name}`),this.methodWarnings[e]=!0));i.__call__({context:ue},...n)}else if(this.script){const r=this.script[e];if("function"!=typeof r)return;r(t,...n)}else console.error(`Cannot run method '${e}' - script not defined`)},e&&(this.path=e),this.name=n||this.path.split("/").pop()||"noscript",this.script=t}jsonPublic(){let n=[];for(let r of this.public){const i={};let s=r;for(const n in r)"value"===n&&(s[n]instanceof t||s[n]instanceof e)?i[n]=s[n].array:i[n]=s[n];n.push(i)}return n}json(){return{type:"Script",path:"scripts.js",name:this.name,public:this.jsonPublic()}}Update(){}}class ne{constructor(e){this.points=e}move(e){for(const t of this.points)t.add(e)}}class re{constructor(e,t,n){this.points=[e,t,n]}move(e){for(const t of this.points)t.add(e)}apply(e){for(let t=0;t<3;t++)this.points[t]=e(this.points[t].clone)}get clone(){return new re(...this.points.map((e=>e.clone)))}get triangleV2(){return new ne([this.points[0].v2,this.points[1].v2,this.points[2].v2])}get json(){let e=[];for(const t of this.points)e.push(t.array);return e}}class ie{constructor(e){this.triangles=e}move(e){for(const t of this.triangles)t.move(e)}}class se{constructor(e){this.triangles=e}move(e){for(const t of this.triangles)t.move(e)}get json(){let e=[];for(const t of this.triangles)e.push(t.json);return e}get clone(){return new se(this.triangles.map((e=>e.clone)))}static fromArray(t){let n=new se([]);for(let r of t){const t=[];for(let n of r)t.push(e.fromArray(n));n.triangles.push(new re(...t))}return n}static get cube(){return new se([new re(new e(0,0,0),new e(0,1,0),new e(1,1,0)),new re(new e(0,0,0),new e(1,1,0),new e(1,0,0)),new re(new e(1,0,0),new e(1,1,0),new e(1,1,1)),new re(new e(1,0,0),new e(1,1,1),new e(1,0,1)),new re(new e(1,0,1),new e(1,1,1),new e(0,1,1)),new re(new e(1,0,1),new e(0,1,1),new e(0,0,1)),new re(new e(0,0,1),new e(0,1,1),new e(0,1,0)),new re(new e(0,0,1),new e(0,1,0),new e(0,0,0)),new re(new e(0,1,0),new e(0,1,1),new e(1,1,1)),new re(new e(0,1,0),new e(1,1,1),new e(1,1,0)),new re(new e(1,0,1),new e(0,0,1),new e(0,0,0)),new re(new e(1,0,1),new e(0,0,0),new e(1,0,0))])}}function oe(e,n){let r=e.getBoundingClientRect();const i=new t(n.pageX-r.left-scrollX,r.height-(n.pageY-r.top-scrollY)),s=new t(e.width/r.width,e.height/r.height);return i.mul(s),i}const ae={listen:(e,t)=>{document.addEventListener(e,t)},mouseDown:!1,cursorPosition:t.zero,cursorPosWorldSpace:t.zero};function ce(e,t){ae.cursorPosition=oe(t,e),ae.cursorPosWorldSpace=function(e,t){const n=oe(e,t);return K.main.getComponent("Camera").screenSpaceToWorldSpace(n,e,K.main.transform.position)}(t,e)}document.addEventListener("keydown",(e=>{ae[e.key]=!0})),document.addEventListener("keyup",(e=>{ae[e.key]=!1})),document.addEventListener("keypress",(e=>{Se.loop((t=>{if(!t.hasComponent("GUIElement","GUITextBox"))return;const n=t.getComponent("GUIElement","GUITextBox");n.selected&&n.keyPress(e)}))})),document.addEventListener("keydown",(e=>{8===e.keyCode&&Se.loop((e=>{if(!e.hasComponent("GUIElement","GUITextBox"))return;const t=e.getComponent("GUIElement","GUITextBox");t.selected&&t.backspace()}))}));var le=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};let ue,he=!1;function _e(){return le(this,void 0,void 0,(function*(){if(he)return;he=!0;let e=yield ee.init({print:console.log,input:(e,t)=>t(ee.wrap(prompt(ee.str(e)))),libs:{ee:[{CircleCollider:p,RectCollider:f,Script:te,TriangleV2:ne,TriangleV3:re,MeshV2:ie,MeshV3:se,Body:S,CircleRenderer:G,ImageRenderer2D:U,RectRenderer:F,GUIBox:z,GUIText:Q,GUITextBox:H,GUIRect:J,GUICircle:V,GUIPolygon:W,GUIImage:q,Camera:K,Transform:Z,input:ae},!0]}});e instanceof ee.Error?console.log("Error initialing EntropyScript runtime: ",e.str):e&&(ee.setGlobalContext(e),ue=e)}))}const pe=Math.floor(200001*Math.random());function fe(e){return le(this,void 0,void 0,(function*(){he||(yield _e());const t=yield fetch(`${e}?${pe}`).catch((t=>{console.log(`Error fetching script at ${e}: ${t}`)}));if(!t)return console.log(`Error fetching script at ${e}: No response received`);const n=yield t.text().catch((t=>{console.log(`Error fetching script at ${e}: ${t}`)}));if("string"!=typeof n)return console.log(`Error fetching script at ${e}`);const r=new ee.Context;r.parent=ue,r.path=e,r.set("__main__",new ee.ESBoolean,{isConstant:!0,forceThroughConst:!0,global:!0});const i=new ee.ESNamespace(new ee.ESString(e),{}),s=ee.run(n,{env:r,fileName:e,currentDir:e,measurePerformance:!1});return s.error?console.log(s.error.str):(i.__value__=r.getSymbolTableAsDict(),new te({script:i,path:e,name:e}))}))}var de=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};const ve={CircleCollider:p,RectCollider:f,Body:S,CircleRenderer:G,RectRenderer:F,ImageRenderer2D:U,GUIBox:z,GUIText:Q,GUITextBox:H,GUIRect:J,GUICircle:V,GUIPolygon:W,GUIImage:q,Camera:K};function me(n,r,i){if("object"!=typeof(s=r[n])||"number"!=typeof s.r||"number"!=typeof s.g||"number"!=typeof s.b){var s;Array.isArray(r[n])?function(e){return"object"==typeof e&&!!Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}(r[n])?i[n]=t.fromArray(r[n]):function(e){return"object"==typeof e&&!!Array.isArray(e)&&3===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]}(r[n])?i[n]=e.fromArray(r[n]):i[n]=r[n]:i[n]=r[n]}else{const e=r[n];i[n]=c(e.r,e.g,e.b,e.a)}}function ye(n){return de(this,void 0,void 0,(function*(){let r;if("Script"===n.type)return function(n){return de(this,void 0,void 0,(function*(){const r=n.path,i=yield fe(r);if(i)try{if(Array.isArray(n.public))for(let r of n.public){if(!i.hasPublic(r.name))continue;let n=r.value;"v2"===r.type?n=t.fromArray(r.value):"v3"===r.type&&(n=e.fromArray(r.value)),i.setPublic(r.name,n)}return i}catch(e){throw`Error initialising script '${r}': ${e}`}}))}(n);const i=ve[n.type];if(!i)throw`No component of type '${n.type}' found`;r=new i({});for(let e in n)n.hasOwnProperty(e)&&"type"!==e&&"subType"!==e&&me(e,n,r);return r}))}function ge(t){var n,r,i,s;return de(this,void 0,void 0,(function*(){const o=null!==(n=t.name)&&void 0!==n?n:`entity ${Se.entities.length}`,a=null!==(r=t.tag)&&void 0!==r?r:"entity",c=null!==(i=t.Static)&&void 0!==i&&i,l=null!==(s=t.components)&&void 0!==s?s:[];let u=[];const h=t.transform,{parentInfo:_,transform:p}=function(t){let n=t.parent;const r=new Z({});return t.position&&(r.position=e.fromArray(t.position)),t.scale&&(r.scale=e.fromArray(t.scale)),t.rotation&&(r.rotation=e.fromArray(t.rotation)),{parentInfo:n,transform:r}}(h||{});for(let e of l){const t=yield ye(e);t&&u.push(t)}return{entity:new Se({name:o,components:u,transform:p,tag:a,Static:c}),parentInfo:_}}))}function we(e,t){var n;let r;"Transform"===e.type?r=null===(n=Se.find(e.name))||void 0===n?void 0:n.transform:"Scene"===e.type&&(r=Y.sceneByID(parseInt(e.name)).id),null==r&&(r=Y.active),null==t||t.makeChildOf(r)}function be(e){var t;return de(this,void 0,void 0,(function*(){let n={};if(Array.isArray(e)){for(let t of e){let e=yield ge(t);n[e.entity.name]=e.parentInfo,Se.entities.push(e.entity)}for(let e in n)n[e]&&we(n[e],null===(t=Se.find(e))||void 0===t?void 0:t.transform)}else console.error("Cannot initialise entities from JSON ",e)}))}function xe(e){var t;for(let n of e){const e=X(),r=null!==(t=n.settings)&&void 0!==t?t:{};for(let t of Object.keys(r))me(t,n.settings||{},e);Y.create({name:n.name,settings:e})}}Math.floor(200001*Math.random());class Se{constructor(e){var t,n,r,i,s;this.getComponent=(e,t="")=>{if(!(this instanceof Se))throw`Running getComponent method in invalid context. this: ${this}`;if("transform"===e.toLowerCase())return this.transform;let n=this.components.find((n=>n.type===e&&(n.subtype===t||""===t)||n.subtype===e));if(void 0===n&&(n=this.getComponents("Script").find((n=>n.subtype===t||n.subtype===e))),void 0===n)throw`Cannot find component of type ${e} on entity ${this.name}`;return n},this.getSceneID=()=>this.sceneID,this.getClone=()=>{return e=this,t=void 0,r=function*(){const{entity:e,parentInfo:t}=yield ge(this.json());return we(t,e.transform),e},new((n=void 0)||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}));var e,t,n,r},this.addComponent=e=>{if("transform"===e.type)return!1;for(const t of this.components){if("GUIElement"===t.type){if("Renderer"!==e.type)continue;if(!["Renderer","Body","Camera"].includes(e.type))continue}if("GUIElement"===e.type&&["Renderer","Body","Camera","Collider"].includes(t.type))return!1;t.type===e.type&&t.subtype===e.subtype&&this.components.splice(this.components.indexOf(t),1)}return this.components.push(e),!0},this.add=this.addComponent,this.hasComponent=(e,t="")=>{if("transform"===e.toLowerCase())return!0;for(let n of this.components){if(n.type===e&&(n.subtype===t||""===t))return!0;if(n.subtype===e)return!0}return!1},this.getComponents=(e,t="")=>{let n=[];for(const r of this.components)r.type!==e||r.subtype!==t&&""!==t||n.push(r);return n},this.generateID=()=>{let e=0,t=Se.entities.map((e=>e.id));for(;t.indexOf(e)>-1;)e=Math.floor(Math.random()*Math.pow(10,5));return e},this.delete=()=>{for(let e=0;e<Se.entities.length;e++){const t=Se.entities[e];Object.is(t,this)&&delete Se.entities.splice(e,1)[0]}},this.json=()=>({name:this.name,tag:this.tag,Static:this.Static,transform:this.transform.json(),components:this.components.map((e=>e.json()))}),this.tag=null!==(t=e.tag)&&void 0!==t?t:"entity",this.name=null!==(n=e.name)&&void 0!==n?n:"new entity",this.components=null!==(r=e.components)&&void 0!==r?r:[],this.transform=null!==(i=e.transform)&&void 0!==i?i:new Z({}),this.Static=null!==(s=e.Static)&&void 0!==s&&s,this.id=this.generateID()}get sceneID(){let e=this.transform;for(;"number"!=typeof e;)e=e.parent;return e}static newEntity(e){const t=new Se(e);return Se.entities.push(t),t}static add(e){Se.entities.push(e)}static find(e=""){const t=Se.entities.find((t=>t.name===e));if(t)return t}static findWithTag(e){let t=[];return Se.loop((n=>{n.tag===e&&t.push(n)})),t}static loop(e){for(const t of Se.entities)e(t)}}Se.entities=[],Se.new=Se.newEntity;function Te(e){return n=this,r=void 0,s=function*(){const n=B(e),r=.1*e.width,i=O(e);function s(){E(n,t.zero,i.x,i.y,"#EEEEEE",0),A(n,"made with",r/2.5,"Nunito","rgb(60, 60, 60)",new t(e.width/2-r/1.6,e.height/2+.5*r)),A(n,"Entropy Engine",r,"Nunito","rgb(0, 0, 0)",new t(e.width/2,e.height/2-.5*r))}E(n,t.zero,i.x,i.y,"#EEEEEE",0),s(),yield d(500);const o=performance.now();for(;performance.now()-o<1e3&&n.globalAlpha>0;)n.globalAlpha-=.005,s(),yield d(1);n.globalAlpha=1},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}c((s=s.apply(n,r||[])).next())}));var n,r,i,s}const Ce=new class{constructor(){this.systems=[]}sortByOrder(){Ce.systems=Ce.systems.sort(((e,t)=>e.order-t.order))}getByName(e){for(let t of Ce.systems)if(t.name===e)return t}Start(e,t){Ce.sortByOrder();for(let n of Ce.systems)n.Start(e,t)}Update(e,t){for(let n of Ce.systems)n.Update(e,t)}};function ke(e){const t=B(e);t.beginPath(),t.clearRect(0,0,e.width,e.height),t.fill()}function Ee(e,n,r){function i(r){let i=n||o.parse("white");i=i.clone,i.alpha=r,E(e,t.zero,e.canvas.width,e.canvas.height,i.rgba)}if(r)try{P(e,t.zero,O(e.canvas),r)}catch(e){i(.1)}else i(1)}function Ie(e,t,n,r,i=K.main){const s=O(t.render),o=s.clone.scale(.5);if(ke(t.background),ke(t.render),ke(t.GUI),ke(t.render),Ee(B(t.background),n,r),!e)return;if(!i)return void console.error(`Camera was not passed to renderAll. Main camera is '${K.main.name}'`);const a=i.getComponent("Camera");if(!a)return;const c=i.transform.position.clone.sub(s.clone.scale(.5).v3);if(c){e=e.filter((e=>e.hasComponent("Renderer")||e.hasComponent("GUIElement")));for(let n of function(e){const t=e.sort(((e,t)=>e.transform.position.z-t.transform.position.z));let n=[],r=[];for(let e of t)e.hasComponent("GUIElement")?r.push(e):n.push(e);return[...n,...r]}(e)){if(n.hasComponent("GUIElement")){n.getComponent("GUIElement").draw(B(t.GUI),n.transform);continue}const e=n.transform.position.clone.sub(c);n.getComponent("Renderer").draw({position:e,transform:n.transform,ctx:B(t.render),zoom:a.zoom,center:o,camera:a,cameraSprite:i})}}}function Ae(e,n,r,i,s,o){const a=r.getComponent("Camera"),c=r.getComponent("Camera").zoom;e.beginPath(),e.strokeStyle=i;let l=a.worldSpaceToScreenSpace(o.position.clone.v2.add(s.offset),n,r.transform.position);if(s instanceof f){const n=new t(s.width,s.height),r=o.scale.v2.mul(n);r.scale(c);const i=l.clone;l=l.clone.sub(r.clone.scale(.5)),T(e,i,o.rotation.z,(()=>{e.rect(l.x,l.y,r.x,r.y),e.stroke()}))}else s instanceof p&&(e.arc(l.x,l.y,s.radius*o.scale.x*c,0,2*Math.PI),e.stroke())}function Pe(e,n,r,i){const s=r.getComponent("Camera");for(const o of i){if(!o.hasComponent("Camera"))continue;let i=s.worldSpaceToScreenSpace(o.transform.position.v2,n,r.transform.position);i.sub(new t(2)),P(e,i,new t(80,40),"https://entropyengine.dev/svg/camera.png",0)}}function Oe(e,n,r,i,s){const o=O(n),a=r.getComponent("Camera"),c=i.getComponent("Camera"),l=c.screenSpaceToWorldSpace(new t(0,0),n,i.transform.position),u=c.screenSpaceToWorldSpace(o,n,i.transform.position),h=a.worldSpaceToScreenSpace(l,n,r.transform.position),_=a.worldSpaceToScreenSpace(u,n,r.transform.position),p=Math.abs(h.y-_.y),f=Math.abs(h.x-_.x);E(e,h,1,p,s,0),E(e,new t(_.x,h.y),1,p,s,0),E(e,h,f,1,s,0),E(e,new t(h.x,_.y),f,1,s,0)}function Re(e,n,r,i){!function(e,n,r,i){const{step:s,min:o,max:a}=function(e,n,r){const i=r.getComponent("Camera"),s=i.zoom,o=O(n);let a=Math.floor(Math.log(s)/Math.LN10+1e-9),c=1/Math.pow(10,a)*50;const l=i.screenSpaceToWorldSpace(new t(0,0),n,r.transform.position),u=i.screenSpaceToWorldSpace(o,n,r.transform.position);(u.x-l.x)/c<5&&(c/=2);const h=e=>Math.ceil(e/c)*c;return l.apply(h),u.apply(h),{step:c,min:l,max:u,zoom:s}}(0,n,r),c=O(n),l=r.getComponent("Camera");for(let u=o.y;u<a.y;u+=s){const s=l.worldSpaceToScreenSpace(new t(0,u),n,r.transform.position);s.x=-1,E(e,s,c.x+2,1,i,0)}for(let u=o.x;u<a.x;u+=s){const s=l.worldSpaceToScreenSpace(new t(u,0),n,r.transform.position);s.y=-1,E(e,s,1,c.y+2,i,0)}}(n,e,r,"rgba(150, 150, 150, 0.3)"),function(e,n,r,i,s){k(e,r.getComponent("Camera").worldSpaceToScreenSpace(t.zero,n,r.transform.position),2,"rgba(150, 150, 150, 0.6)")}(n,e,r),function(e,t,n,r,i){for(const r of i)r.hasComponent("Collider")&&Ae(e,t,n,"rgba(255, 230, 0, 0.6)",r.getComponent("Collider"),r.transform)}(n,e,r,0,i),Pe(n,e,r,i)}function Ne(e,t,n,r){r.hasComponent("Collider")&&Ae(t,e,n,"rgba(21,229,21,0.76)",r.getComponent("Collider"),r.transform)}Ce.systems.push({name:"Physics",order:0,engine:i.Engine.create(),runner:i.Runner.create(),Start:function(e){for(let t of e.entities){if(!t.hasComponent("Body"))continue;if(!t.hasComponent("Collider"))continue;let e=t.getComponent("Collider"),n=t.getComponent("Body");this.updateMBodyOptions(e,t,n,!0),i.World.addBody(this.engine.world,e.MatterBody)}},updateMBodyOptions:(e,t,n,r=!1)=>{const s=e.MatterBody,o=t.transform;s.position=i.Vector.create(o.position.x,o.position.y),s.angle=o.rotation.z,s.isStatic=t.Static,s.isSensor=!e.solid,s.friction=n.friction,s.velocity=i.Vector.create(n.velocity.x,n.velocity.y),s.frictionAir=n.airResistance,s.mass=n.mass,s.restitution=Math.max(Math.min(n.bounciness,1),0);let a=[];if(e instanceof f){const t=e.width*o.scale.x,n=e.height*o.scale.y;a=i.Bodies.rectangle(o.position.x,o.position.y,t,n).vertices}else{if(!(e instanceof p))throw Error("Unknown Collider type");{const t=e.radius*o.scale.x;a=i.Bodies.circle(o.position.x,o.position.y,t).vertices}}for(let e of a)e.body=s;s.vertices=a,s.bounds=i.Bounds.create(s.vertices),t.Static&&(s.velocity=i.Vector.create(0,0),s.force=i.Vector.create(0,0),s.positionPrev=s.position),r&&(s.positionPrev=s.position)},callCollides:function(e,t){for(const n of e.getComponents("script"))n.runMethod("onCollision",e,[new ee.ESJSBinding(t)])},updateScripts:function(e){const t=[];for(let[n]of e)t.push(n);for(let[n,r]of e){const s=[...t];let o=s.indexOf(n);if(-1===o)throw Error();s.splice(o,1);let a=i.Query.collides(n,s);if(a.length>0)for(let t of a){let i=t.bodyB;Object.is(i,n)&&(i=t.bodyA);const s=e.find((([e])=>Object.is(e,i)));if(void 0===s)throw Error();this.callCollides(r,s[1])}}},Update:function(t){const n=[];this.time||(this.time=performance.now());for(let e of t.entities){if(!e.hasComponent("Collider"))continue;let t=e.getComponent("Collider");if(e.hasComponent("Body")){let n=e.getComponent("Body");this.updateMBodyOptions(t,e,n)}n.push([t.MatterBody,e])}this.engine.gravity.x=t.settings.globalGravity.x,this.engine.gravity.y=t.settings.globalGravity.y,i.Runner.tick(this.runner,this.engine,performance.now());for(let n of t.entities){if(!n.hasComponent("Body")||!n.hasComponent("Collider"))continue;let t=n.getComponent("Collider").MatterBody,r=n.getComponent("Body");n?(n.transform.rotation.z=t.angle,n.transform.position.set(new e(t.position.x,t.position.y,0)),r.velocity.set(new e(t.velocity.x,t.velocity.y,0))):console.error("EEInstance not attached to Matter.Body instance")}this.updateScripts(n)}}),Ce.systems.push({name:"Renderer",Start:(e,t)=>{N(t.render),N(t.input),N(t.GUI),ke(t.GUI),ke(t.input),ke(t.render)},Update:(e,t)=>{Ie(e.entities,t,e.settings.backgroundTint,e.settings.backgroundImage)},order:10}),Ce.systems.push({name:"Scripts",Start:e=>{e.broadcast("Start",[])},Update:e=>{e.broadcast("Update",[])},order:0});var Me=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};function $e({canvasContainerID:e="entropy-engine",performanceDebug:n=0}={}){let r=!1;const i="EE-"!==(s="").substr(0,3)||12!==s.length?0:1;var s;const o=function(e){var n,r;let i=document.getElementById(e);i||(i=document.body.appendChild(document.createElement("div"))),new t((null===(n=i.parentElement)||void 0===n?void 0:n.clientWidth)||0,null===(r=i.parentElement)||void 0===r?void 0:r.clientHeight),i.innerHTML=" ",i.style.width="100%",i.style.height="100%";const s=i.appendChild(document.createElement("canvas")),o=i.appendChild(document.createElement("canvas")),a=i.appendChild(document.createElement("canvas")),c=i.appendChild(document.createElement("canvas"));s.id="EntropyEngine-GUI-Layer",o.id="EntropyEngine-render-Layer",c.id="EntropyEngine-background-Layer",a.id="EntropyEngine-input-Layer";const l={GUI:s,input:a,render:o,background:c};return $(l),l}(e),{GUI:a}=o;function c(){return Me(this,void 0,void 0,(function*(){Ce.Update(Y.activeScene,o),window.requestAnimationFrame(c)}))}return function(e,t){const n=e.input,r=n.parentElement;if(!r)throw"no parent to canvas";new ResizeObserver((()=>{$(e)})).observe(r),n.addEventListener("mousemove",(e=>{t()&&(ce(e,n),Se.loop((e=>{if(e.sceneID===Y.active)for(const t of e.components){if("GUIElement"!==t.type)return;const r=t;r.hovered=r.touchingPoint(ae.cursorPosition,B(n),e.transform)}})))}),!1),n.addEventListener("mousedown",(e=>{t()&&(ae.mouseDown=!0,ce(e,n),Y.activeScene.loopThroughScripts(((t,r)=>{if(r.sceneID!==Y.active)return;if(!r.hasComponent("Collider"))return;let i=r.getComponent("Collider");const s=oe(n,e);i.overlapsPoint(r.transform,s)})))}),!1),n.addEventListener("keydown",(e=>{ce(e,n)})),n.addEventListener("keyup",(e=>{ce(e,n)})),n.addEventListener("mouseup",(e=>{t()&&(ae.mouseDown=!1,ce(e,n),Y.activeScene.loopThroughScripts(((t,r)=>{if(r.sceneID===Y.active)if(r.hasComponent("Collider")){let i=r.getComponent("Collider");const s=oe(n,e);if(!i.overlapsPoint(r.transform,s))return;t.runMethod("onMouseUp",r,[])}else if(r.hasComponent("GUIElement")){const e=r.getComponent("GUIElement");if(e.hovered&&t.runMethod("onClick",r,[]),"GUITextBox"!==e.subtype)return;let n=e;n.selected=n.hovered}})))}),!1)}(o,(()=>r)),{run:function(){return Me(this,void 0,void 0,(function*(){$(o),yield function(){return Me(this,void 0,void 0,(function*(){i<2&&(B(o.GUI).transform(1,0,0,-1,0,o.GUI.height),yield Te(a)),yield _e(),Y.activeScene.findMainCamera(),Ce.Start(Y.activeScene,o),r=!0}))}(),$(o),window.requestAnimationFrame(c)}))}}}function Be(e,t={}){return Me(this,void 0,void 0,(function*(){yield _e();const n=yield fetch(e,x),r=yield n.json();for(let e of Object.keys(r))["entities","scenes"].includes(e)||(t[e]=r[e]);t.shouldInitEES=!1,xe(r.scenes);const i=$e(t);return yield be(r.entities),yield i.run(),i}))}})(),r})()}));
//# sourceMappingURL=0.0.10.js.map